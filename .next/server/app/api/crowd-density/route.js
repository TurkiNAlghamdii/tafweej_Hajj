"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/crowd-density/route";
exports.ids = ["app/api/crowd-density/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcrowd-density%2Froute&page=%2Fapi%2Fcrowd-density%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcrowd-density%2Froute.ts&appDir=C%3A%5CUsers%5Calghm%5COneDrive%5CDesktop%5CGitHub%5Ctafweej_Hajj%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Calghm%5COneDrive%5CDesktop%5CGitHub%5Ctafweej_Hajj&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcrowd-density%2Froute&page=%2Fapi%2Fcrowd-density%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcrowd-density%2Froute.ts&appDir=C%3A%5CUsers%5Calghm%5COneDrive%5CDesktop%5CGitHub%5Ctafweej_Hajj%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Calghm%5COneDrive%5CDesktop%5CGitHub%5Ctafweej_Hajj&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_alghm_OneDrive_Desktop_GitHub_tafweej_Hajj_src_app_api_crowd_density_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/crowd-density/route.ts */ \"(rsc)/./src/app/api/crowd-density/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/crowd-density/route\",\n        pathname: \"/api/crowd-density\",\n        filename: \"route\",\n        bundlePath: \"app/api/crowd-density/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\alghm\\\\OneDrive\\\\Desktop\\\\GitHub\\\\tafweej_Hajj\\\\src\\\\app\\\\api\\\\crowd-density\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_alghm_OneDrive_Desktop_GitHub_tafweej_Hajj_src_app_api_crowd_density_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/crowd-density/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZjcm93ZC1kZW5zaXR5JTJGcm91dGUmcGFnZT0lMkZhcGklMkZjcm93ZC1kZW5zaXR5JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGY3Jvd2QtZGVuc2l0eSUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNhbGdobSU1Q09uZURyaXZlJTVDRGVza3RvcCU1Q0dpdEh1YiU1Q3RhZndlZWpfSGFqaiU1Q3NyYyU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q1VzZXJzJTVDYWxnaG0lNUNPbmVEcml2ZSU1Q0Rlc2t0b3AlNUNHaXRIdWIlNUN0YWZ3ZWVqX0hhamomaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ2lEO0FBQzlIO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaGFqai1uYXZpZ2F0b3IvP2I0NTkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcYWxnaG1cXFxcT25lRHJpdmVcXFxcRGVza3RvcFxcXFxHaXRIdWJcXFxcdGFmd2Vlal9IYWpqXFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXGNyb3dkLWRlbnNpdHlcXFxccm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2Nyb3dkLWRlbnNpdHkvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9jcm93ZC1kZW5zaXR5XCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9jcm93ZC1kZW5zaXR5L3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiQzpcXFxcVXNlcnNcXFxcYWxnaG1cXFxcT25lRHJpdmVcXFxcRGVza3RvcFxcXFxHaXRIdWJcXFxcdGFmd2Vlal9IYWpqXFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXGNyb3dkLWRlbnNpdHlcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2Nyb3dkLWRlbnNpdHkvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcrowd-density%2Froute&page=%2Fapi%2Fcrowd-density%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcrowd-density%2Froute.ts&appDir=C%3A%5CUsers%5Calghm%5COneDrive%5CDesktop%5CGitHub%5Ctafweej_Hajj%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Calghm%5COneDrive%5CDesktop%5CGitHub%5Ctafweej_Hajj&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/crowd-density/route.ts":
/*!********************************************!*\
  !*** ./src/app/api/crowd-density/route.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_supabase__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/supabase */ \"(rsc)/./src/lib/supabase.ts\");\n/* harmony import */ var _lib_crowdSensors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/crowdSensors */ \"(rsc)/./src/lib/crowdSensors.ts\");\n\n\n\n// GET handler to fetch crowd density data\nasync function GET(request) {\n    try {\n        // Log environment variables (masked for security)\n        console.log(\"Supabase URL available:\", !!process.env.NEXT_PUBLIC_SUPABASE_URL);\n        console.log(\"Supabase Anon Key available:\", !!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY);\n        console.log(\"Supabase Service Role Key available:\", !!process.env.SUPABASE_SERVICE_ROLE_KEY);\n        console.log(\"supabaseAdmin client available:\", !!_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin);\n        // Extract the force parameter from the URL\n        const { searchParams } = new URL(request.url);\n        const forceRefresh = searchParams.get(\"force\") === \"true\";\n        // If supabaseAdmin is not available, skip database and use direct calculation\n        if (!_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin) {\n            console.log(\"No supabaseAdmin client, using direct calculation\");\n            const calculatedData = await (0,_lib_crowdSensors__WEBPACK_IMPORTED_MODULE_2__.calculateRealisticCrowdDensities)();\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(calculatedData);\n        }\n        try {\n            // If force refresh is requested, generate new data\n            if (forceRefresh) {\n                console.log(\"Force refresh requested, generating new crowd density data\");\n                const result = await (0,_lib_crowdSensors__WEBPACK_IMPORTED_MODULE_2__.updateCrowdDensityData)();\n                // If we got data directly from updateCrowdDensityData, use it\n                if (result.data) {\n                    console.log(\"Using data returned directly from updateCrowdDensityData\");\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(result.data);\n                }\n                if (\"error\" in result) {\n                    console.error(\"Error in updateCrowdDensityData during force refresh:\", result.error);\n                    // Use direct calculation instead\n                    const calculatedData = await (0,_lib_crowdSensors__WEBPACK_IMPORTED_MODULE_2__.calculateRealisticCrowdDensities)();\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(calculatedData);\n                }\n                console.log(\"Fetching fresh data after forced update\");\n                try {\n                    const { data: freshData, error: fetchError } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"crowd_density\").select(\"*\").order(\"updated_at\", {\n                        ascending: false\n                    });\n                    if (fetchError) {\n                        throw fetchError;\n                    }\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(freshData);\n                } catch (dbErr) {\n                    console.error(\"DB error after force refresh, using direct calculation:\", dbErr);\n                    const calculatedData = await (0,_lib_crowdSensors__WEBPACK_IMPORTED_MODULE_2__.calculateRealisticCrowdDensities)();\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(calculatedData);\n                }\n            }\n            // First check if data exists in database\n            try {\n                const { data, error } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"crowd_density\").select(\"*\").order(\"updated_at\", {\n                    ascending: false\n                });\n                if (error) {\n                    throw error;\n                }\n                // If we have data and it was updated in the last 5 minutes, use it\n                const fiveMinutesAgo = new Date(Date.now() - 5 * 60 * 1000).toISOString();\n                const hasRecentData = data && data.length > 0 && data[0].updated_at > fiveMinutesAgo;\n                if (hasRecentData) {\n                    console.log(\"Using recent data from database\");\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(data);\n                }\n            } catch (dbErr) {\n                console.error(\"Error querying database:\", dbErr);\n            // Continue to calculating new data\n            }\n            // Otherwise, generate new data\n            console.log(\"Generating new crowd density data\");\n            try {\n                const result = await (0,_lib_crowdSensors__WEBPACK_IMPORTED_MODULE_2__.updateCrowdDensityData)();\n                // If we got data directly from updateCrowdDensityData, use it\n                if (result.data) {\n                    console.log(\"Using data returned directly from updateCrowdDensityData\");\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(result.data);\n                }\n                if (\"error\" in result) {\n                    throw new Error(`Failed to update crowd density data: ${result.error}`);\n                }\n                // Fetch the newly inserted data\n                const { data: freshData, error: fetchError } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"crowd_density\").select(\"*\").order(\"updated_at\", {\n                    ascending: false\n                });\n                if (fetchError) {\n                    throw fetchError;\n                }\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(freshData);\n            } catch (updateErr) {\n                console.error(\"Error during data update:\", updateErr);\n                // Use direct calculation as fallback\n                const calculatedData = await (0,_lib_crowdSensors__WEBPACK_IMPORTED_MODULE_2__.calculateRealisticCrowdDensities)();\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(calculatedData);\n            }\n        } catch (supabaseErr) {\n            console.error(\"Supabase operation error:\", supabaseErr);\n            // If database operations fail, return calculated data directly\n            const calculatedData = await (0,_lib_crowdSensors__WEBPACK_IMPORTED_MODULE_2__.calculateRealisticCrowdDensities)();\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(calculatedData);\n        }\n    } catch (mainError) {\n        console.error(\"Main error handler caught:\", mainError);\n        // Final fallback - always return calculated data if all else fails\n        try {\n            const calculatedData = await (0,_lib_crowdSensors__WEBPACK_IMPORTED_MODULE_2__.calculateRealisticCrowdDensities)();\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(calculatedData);\n        } catch (calcError) {\n            console.error(\"Even calculation failed:\", calcError);\n            // Return empty array instead of an error to ensure JSON is returned\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json([]);\n        }\n    }\n}\n// POST handler to update crowd density data\nasync function POST(request) {\n    try {\n        console.log(\"POST request to crowd-density API\");\n        // If supabaseAdmin is not available, just recalculate directly\n        if (!_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin) {\n            console.log(\"No supabaseAdmin client, calculating directly\");\n            try {\n                // Get request body\n                const body = await request.json();\n                // Check if it's a recalculation request\n                if (body.recalculate === true) {\n                    const result = await (0,_lib_crowdSensors__WEBPACK_IMPORTED_MODULE_2__.updateCrowdDensityData)();\n                    // Use data from the result if available\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        success: true,\n                        message: result.message || \"Crowd density data recalculated directly (no DB)\",\n                        count: result.count || 0\n                    });\n                }\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Manual entry not supported without database\"\n                }, {\n                    status: 400\n                });\n            } catch (err) {\n                console.error(\"Error parsing request or calculating density:\", err);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Error processing request\"\n                }, {\n                    status: 400\n                });\n            }\n        }\n        try {\n            // Get request body\n            const body = await request.json();\n            // Check if it's a recalculation request\n            if (body.recalculate === true) {\n                console.log(\"Recalculation request received\");\n                try {\n                    const result = await (0,_lib_crowdSensors__WEBPACK_IMPORTED_MODULE_2__.updateCrowdDensityData)();\n                    // If we have data directly in the result, report success\n                    if (result.data) {\n                        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                            success: true,\n                            message: result.message || \"Crowd density data recalculated\",\n                            count: result.count || result.data.length\n                        });\n                    }\n                    if (\"error\" in result) {\n                        throw new Error(`Failed to recalculate: ${result.error}`);\n                    }\n                    console.log(\"Recalculation successful:\", result);\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        success: true,\n                        message: \"Crowd density data recalculated\",\n                        count: result.count || 0\n                    });\n                } catch (recalcErr) {\n                    console.error(\"Recalculation error:\", recalcErr);\n                    // Return success with direct calculation\n                    const calculatedData = await (0,_lib_crowdSensors__WEBPACK_IMPORTED_MODULE_2__.calculateRealisticCrowdDensities)();\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        success: true,\n                        message: \"Used direct calculation (DB update failed)\",\n                        count: calculatedData.length\n                    });\n                }\n            }\n            // Otherwise handle manual entry\n            console.log(\"Manual entry request received\");\n            // Validate request body\n            if (!body.location_name || !body.coordinates || !body.density_level) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Missing required fields\"\n                }, {\n                    status: 400\n                });\n            }\n            // Update or insert crowd density data\n            try {\n                const { data, error } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"crowd_density\").upsert({\n                    location_name: body.location_name,\n                    coordinates: body.coordinates,\n                    density_level: body.density_level,\n                    updated_at: new Date().toISOString(),\n                    crowd_size: body.crowd_size || null,\n                    occupancy_percentage: body.occupancy_percentage || null,\n                    meta_data: body.meta_data || null\n                }).select();\n                if (error) {\n                    throw error;\n                }\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(data);\n            } catch (upsertErr) {\n                console.error(\"Error during upsert operation:\", upsertErr);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Database update failed, but request was valid\"\n                }, {\n                    status: 500\n                });\n            }\n        } catch (bodyErr) {\n            console.error(\"Error parsing request body:\", bodyErr);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Invalid request format\"\n            }, {\n                status: 400\n            });\n        }\n    } catch (mainErr) {\n        console.error(\"Unhandled error in POST handler:\", mainErr);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Server error processing request\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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MEIsUUFBUTtZQUFJO1FBRWxCO0lBQ0YsRUFBRSxPQUFPWSxTQUFTO1FBQ2hCdEQsUUFBUWdCLEtBQUssQ0FBQyxvQ0FBb0NzQztRQUNsRCxPQUFPNUQscURBQVlBLENBQUNtQixJQUFJLENBQ3RCO1lBQUVHLE9BQU87UUFBa0MsR0FDM0M7WUFBRTBCLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaGFqai1uYXZpZ2F0b3IvLi9zcmMvYXBwL2FwaS9jcm93ZC1kZW5zaXR5L3JvdXRlLnRzPzFkMGMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBzdXBhYmFzZUFkbWluIH0gZnJvbSAnQC9saWIvc3VwYWJhc2UnO1xyXG5pbXBvcnQgeyB1cGRhdGVDcm93ZERlbnNpdHlEYXRhLCBjYWxjdWxhdGVSZWFsaXN0aWNDcm93ZERlbnNpdGllcyB9IGZyb20gJ0AvbGliL2Nyb3dkU2Vuc29ycyc7XHJcblxyXG4vLyBHRVQgaGFuZGxlciB0byBmZXRjaCBjcm93ZCBkZW5zaXR5IGRhdGFcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBSZXF1ZXN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIExvZyBlbnZpcm9ubWVudCB2YXJpYWJsZXMgKG1hc2tlZCBmb3Igc2VjdXJpdHkpXHJcbiAgICBjb25zb2xlLmxvZygnU3VwYWJhc2UgVVJMIGF2YWlsYWJsZTonLCAhIXByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCk7XHJcbiAgICBjb25zb2xlLmxvZygnU3VwYWJhc2UgQW5vbiBLZXkgYXZhaWxhYmxlOicsICEhcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkpO1xyXG4gICAgY29uc29sZS5sb2coJ1N1cGFiYXNlIFNlcnZpY2UgUm9sZSBLZXkgYXZhaWxhYmxlOicsICEhcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSk7XHJcbiAgICBjb25zb2xlLmxvZygnc3VwYWJhc2VBZG1pbiBjbGllbnQgYXZhaWxhYmxlOicsICEhc3VwYWJhc2VBZG1pbik7XHJcblxyXG4gICAgLy8gRXh0cmFjdCB0aGUgZm9yY2UgcGFyYW1ldGVyIGZyb20gdGhlIFVSTFxyXG4gICAgY29uc3QgeyBzZWFyY2hQYXJhbXMgfSA9IG5ldyBVUkwocmVxdWVzdC51cmwpO1xyXG4gICAgY29uc3QgZm9yY2VSZWZyZXNoID0gc2VhcmNoUGFyYW1zLmdldCgnZm9yY2UnKSA9PT0gJ3RydWUnO1xyXG5cclxuICAgIC8vIElmIHN1cGFiYXNlQWRtaW4gaXMgbm90IGF2YWlsYWJsZSwgc2tpcCBkYXRhYmFzZSBhbmQgdXNlIGRpcmVjdCBjYWxjdWxhdGlvblxyXG4gICAgaWYgKCFzdXBhYmFzZUFkbWluKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdObyBzdXBhYmFzZUFkbWluIGNsaWVudCwgdXNpbmcgZGlyZWN0IGNhbGN1bGF0aW9uJyk7XHJcbiAgICAgIGNvbnN0IGNhbGN1bGF0ZWREYXRhID0gYXdhaXQgY2FsY3VsYXRlUmVhbGlzdGljQ3Jvd2REZW5zaXRpZXMoKTtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKGNhbGN1bGF0ZWREYXRhKTtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBJZiBmb3JjZSByZWZyZXNoIGlzIHJlcXVlc3RlZCwgZ2VuZXJhdGUgbmV3IGRhdGFcclxuICAgICAgaWYgKGZvcmNlUmVmcmVzaCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdGb3JjZSByZWZyZXNoIHJlcXVlc3RlZCwgZ2VuZXJhdGluZyBuZXcgY3Jvd2QgZGVuc2l0eSBkYXRhJyk7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXBkYXRlQ3Jvd2REZW5zaXR5RGF0YSgpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIElmIHdlIGdvdCBkYXRhIGRpcmVjdGx5IGZyb20gdXBkYXRlQ3Jvd2REZW5zaXR5RGF0YSwgdXNlIGl0XHJcbiAgICAgICAgaWYgKHJlc3VsdC5kYXRhKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnVXNpbmcgZGF0YSByZXR1cm5lZCBkaXJlY3RseSBmcm9tIHVwZGF0ZUNyb3dkRGVuc2l0eURhdGEnKTtcclxuICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGlmICgnZXJyb3InIGluIHJlc3VsdCkge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gdXBkYXRlQ3Jvd2REZW5zaXR5RGF0YSBkdXJpbmcgZm9yY2UgcmVmcmVzaDonLCByZXN1bHQuZXJyb3IpO1xyXG4gICAgICAgICAgLy8gVXNlIGRpcmVjdCBjYWxjdWxhdGlvbiBpbnN0ZWFkXHJcbiAgICAgICAgICBjb25zdCBjYWxjdWxhdGVkRGF0YSA9IGF3YWl0IGNhbGN1bGF0ZVJlYWxpc3RpY0Nyb3dkRGVuc2l0aWVzKCk7XHJcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oY2FsY3VsYXRlZERhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBjb25zb2xlLmxvZygnRmV0Y2hpbmcgZnJlc2ggZGF0YSBhZnRlciBmb3JjZWQgdXBkYXRlJyk7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGNvbnN0IHsgZGF0YTogZnJlc2hEYXRhLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgICAgICAuZnJvbSgnY3Jvd2RfZGVuc2l0eScpXHJcbiAgICAgICAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAgICAgICAub3JkZXIoJ3VwZGF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgaWYgKGZldGNoRXJyb3IpIHtcclxuICAgICAgICAgICAgdGhyb3cgZmV0Y2hFcnJvcjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIFxyXG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKGZyZXNoRGF0YSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZGJFcnIpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0RCIGVycm9yIGFmdGVyIGZvcmNlIHJlZnJlc2gsIHVzaW5nIGRpcmVjdCBjYWxjdWxhdGlvbjonLCBkYkVycik7XHJcbiAgICAgICAgICBjb25zdCBjYWxjdWxhdGVkRGF0YSA9IGF3YWl0IGNhbGN1bGF0ZVJlYWxpc3RpY0Nyb3dkRGVuc2l0aWVzKCk7XHJcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oY2FsY3VsYXRlZERhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gRmlyc3QgY2hlY2sgaWYgZGF0YSBleGlzdHMgaW4gZGF0YWJhc2VcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgICAgICAuZnJvbSgnY3Jvd2RfZGVuc2l0eScpXHJcbiAgICAgICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgICAgIC5vcmRlcigndXBkYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcclxuXHJcbiAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIElmIHdlIGhhdmUgZGF0YSBhbmQgaXQgd2FzIHVwZGF0ZWQgaW4gdGhlIGxhc3QgNSBtaW51dGVzLCB1c2UgaXRcclxuICAgICAgICBjb25zdCBmaXZlTWludXRlc0FnbyA9IG5ldyBEYXRlKERhdGUubm93KCkgLSA1ICogNjAgKiAxMDAwKS50b0lTT1N0cmluZygpO1xyXG4gICAgICAgIGNvbnN0IGhhc1JlY2VudERhdGEgPSBkYXRhICYmIGRhdGEubGVuZ3RoID4gMCAmJiBkYXRhWzBdLnVwZGF0ZWRfYXQgPiBmaXZlTWludXRlc0FnbztcclxuXHJcbiAgICAgICAgaWYgKGhhc1JlY2VudERhdGEpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdVc2luZyByZWNlbnQgZGF0YSBmcm9tIGRhdGFiYXNlJyk7XHJcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGNhdGNoIChkYkVycikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHF1ZXJ5aW5nIGRhdGFiYXNlOicsIGRiRXJyKTtcclxuICAgICAgICAvLyBDb250aW51ZSB0byBjYWxjdWxhdGluZyBuZXcgZGF0YVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBPdGhlcndpc2UsIGdlbmVyYXRlIG5ldyBkYXRhXHJcbiAgICAgIGNvbnNvbGUubG9nKCdHZW5lcmF0aW5nIG5ldyBjcm93ZCBkZW5zaXR5IGRhdGEnKTtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1cGRhdGVDcm93ZERlbnNpdHlEYXRhKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gSWYgd2UgZ290IGRhdGEgZGlyZWN0bHkgZnJvbSB1cGRhdGVDcm93ZERlbnNpdHlEYXRhLCB1c2UgaXRcclxuICAgICAgICBpZiAocmVzdWx0LmRhdGEpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdVc2luZyBkYXRhIHJldHVybmVkIGRpcmVjdGx5IGZyb20gdXBkYXRlQ3Jvd2REZW5zaXR5RGF0YScpO1xyXG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHJlc3VsdC5kYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKCdlcnJvcicgaW4gcmVzdWx0KSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byB1cGRhdGUgY3Jvd2QgZGVuc2l0eSBkYXRhOiAke3Jlc3VsdC5lcnJvcn1gKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gRmV0Y2ggdGhlIG5ld2x5IGluc2VydGVkIGRhdGFcclxuICAgICAgICBjb25zdCB7IGRhdGE6IGZyZXNoRGF0YSwgZXJyb3I6IGZldGNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgICAgIC5mcm9tKCdjcm93ZF9kZW5zaXR5JylcclxuICAgICAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAgICAgLm9yZGVyKCd1cGRhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgaWYgKGZldGNoRXJyb3IpIHtcclxuICAgICAgICAgIHRocm93IGZldGNoRXJyb3I7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihmcmVzaERhdGEpO1xyXG4gICAgICB9IGNhdGNoICh1cGRhdGVFcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkdXJpbmcgZGF0YSB1cGRhdGU6JywgdXBkYXRlRXJyKTtcclxuICAgICAgICAvLyBVc2UgZGlyZWN0IGNhbGN1bGF0aW9uIGFzIGZhbGxiYWNrXHJcbiAgICAgICAgY29uc3QgY2FsY3VsYXRlZERhdGEgPSBhd2FpdCBjYWxjdWxhdGVSZWFsaXN0aWNDcm93ZERlbnNpdGllcygpO1xyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihjYWxjdWxhdGVkRGF0YSk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKHN1cGFiYXNlRXJyKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1N1cGFiYXNlIG9wZXJhdGlvbiBlcnJvcjonLCBzdXBhYmFzZUVycik7XHJcbiAgICAgIC8vIElmIGRhdGFiYXNlIG9wZXJhdGlvbnMgZmFpbCwgcmV0dXJuIGNhbGN1bGF0ZWQgZGF0YSBkaXJlY3RseVxyXG4gICAgICBjb25zdCBjYWxjdWxhdGVkRGF0YSA9IGF3YWl0IGNhbGN1bGF0ZVJlYWxpc3RpY0Nyb3dkRGVuc2l0aWVzKCk7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihjYWxjdWxhdGVkRGF0YSk7XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAobWFpbkVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdNYWluIGVycm9yIGhhbmRsZXIgY2F1Z2h0OicsIG1haW5FcnJvcik7XHJcbiAgICAvLyBGaW5hbCBmYWxsYmFjayAtIGFsd2F5cyByZXR1cm4gY2FsY3VsYXRlZCBkYXRhIGlmIGFsbCBlbHNlIGZhaWxzXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBjYWxjdWxhdGVkRGF0YSA9IGF3YWl0IGNhbGN1bGF0ZVJlYWxpc3RpY0Nyb3dkRGVuc2l0aWVzKCk7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihjYWxjdWxhdGVkRGF0YSk7XHJcbiAgICB9IGNhdGNoIChjYWxjRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXZlbiBjYWxjdWxhdGlvbiBmYWlsZWQ6JywgY2FsY0Vycm9yKTtcclxuICAgICAgLy8gUmV0dXJuIGVtcHR5IGFycmF5IGluc3RlYWQgb2YgYW4gZXJyb3IgdG8gZW5zdXJlIEpTT04gaXMgcmV0dXJuZWRcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFtdKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbi8vIFBPU1QgaGFuZGxlciB0byB1cGRhdGUgY3Jvd2QgZGVuc2l0eSBkYXRhXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcclxuICB0cnkge1xyXG4gICAgY29uc29sZS5sb2coJ1BPU1QgcmVxdWVzdCB0byBjcm93ZC1kZW5zaXR5IEFQSScpO1xyXG4gICAgXHJcbiAgICAvLyBJZiBzdXBhYmFzZUFkbWluIGlzIG5vdCBhdmFpbGFibGUsIGp1c3QgcmVjYWxjdWxhdGUgZGlyZWN0bHlcclxuICAgIGlmICghc3VwYWJhc2VBZG1pbikge1xyXG4gICAgICBjb25zb2xlLmxvZygnTm8gc3VwYWJhc2VBZG1pbiBjbGllbnQsIGNhbGN1bGF0aW5nIGRpcmVjdGx5Jyk7XHJcbiAgICAgIFxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIC8vIEdldCByZXF1ZXN0IGJvZHlcclxuICAgICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhIHJlY2FsY3VsYXRpb24gcmVxdWVzdFxyXG4gICAgICAgIGlmIChib2R5LnJlY2FsY3VsYXRlID09PSB0cnVlKSB7XHJcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1cGRhdGVDcm93ZERlbnNpdHlEYXRhKCk7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIFVzZSBkYXRhIGZyb20gdGhlIHJlc3VsdCBpZiBhdmFpbGFibGVcclxuICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6IHJlc3VsdC5tZXNzYWdlIHx8ICdDcm93ZCBkZW5zaXR5IGRhdGEgcmVjYWxjdWxhdGVkIGRpcmVjdGx5IChubyBEQiknLFxyXG4gICAgICAgICAgICBjb3VudDogcmVzdWx0LmNvdW50IHx8IDBcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBtZXNzYWdlOiAnTWFudWFsIGVudHJ5IG5vdCBzdXBwb3J0ZWQgd2l0aG91dCBkYXRhYmFzZSdcclxuICAgICAgICB9LCB7IHN0YXR1czogNDAwIH0pO1xyXG4gICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwYXJzaW5nIHJlcXVlc3Qgb3IgY2FsY3VsYXRpbmcgZGVuc2l0eTonLCBlcnIpO1xyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIG1lc3NhZ2U6ICdFcnJvciBwcm9jZXNzaW5nIHJlcXVlc3QnXHJcbiAgICAgICAgfSwgeyBzdGF0dXM6IDQwMCB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIEdldCByZXF1ZXN0IGJvZHlcclxuICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xyXG4gICAgICBcclxuICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhIHJlY2FsY3VsYXRpb24gcmVxdWVzdFxyXG4gICAgICBpZiAoYm9keS5yZWNhbGN1bGF0ZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdSZWNhbGN1bGF0aW9uIHJlcXVlc3QgcmVjZWl2ZWQnKTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXBkYXRlQ3Jvd2REZW5zaXR5RGF0YSgpO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAvLyBJZiB3ZSBoYXZlIGRhdGEgZGlyZWN0bHkgaW4gdGhlIHJlc3VsdCwgcmVwb3J0IHN1Y2Nlc3NcclxuICAgICAgICAgIGlmIChyZXN1bHQuZGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xyXG4gICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2UgfHwgJ0Nyb3dkIGRlbnNpdHkgZGF0YSByZWNhbGN1bGF0ZWQnLFxyXG4gICAgICAgICAgICAgIGNvdW50OiByZXN1bHQuY291bnQgfHwgcmVzdWx0LmRhdGEubGVuZ3RoXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBpZiAoJ2Vycm9yJyBpbiByZXN1bHQpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gcmVjYWxjdWxhdGU6ICR7cmVzdWx0LmVycm9yfWApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnUmVjYWxjdWxhdGlvbiBzdWNjZXNzZnVsOicsIHJlc3VsdCk7XHJcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnQ3Jvd2QgZGVuc2l0eSBkYXRhIHJlY2FsY3VsYXRlZCcsXHJcbiAgICAgICAgICAgIGNvdW50OiAocmVzdWx0IGFzIGFueSkuY291bnQgfHwgMFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBjYXRjaCAocmVjYWxjRXJyKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZWNhbGN1bGF0aW9uIGVycm9yOicsIHJlY2FsY0Vycik7XHJcbiAgICAgICAgICAvLyBSZXR1cm4gc3VjY2VzcyB3aXRoIGRpcmVjdCBjYWxjdWxhdGlvblxyXG4gICAgICAgICAgY29uc3QgY2FsY3VsYXRlZERhdGEgPSBhd2FpdCBjYWxjdWxhdGVSZWFsaXN0aWNDcm93ZERlbnNpdGllcygpO1xyXG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1VzZWQgZGlyZWN0IGNhbGN1bGF0aW9uIChEQiB1cGRhdGUgZmFpbGVkKScsXHJcbiAgICAgICAgICAgIGNvdW50OiBjYWxjdWxhdGVkRGF0YS5sZW5ndGhcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gT3RoZXJ3aXNlIGhhbmRsZSBtYW51YWwgZW50cnlcclxuICAgICAgY29uc29sZS5sb2coJ01hbnVhbCBlbnRyeSByZXF1ZXN0IHJlY2VpdmVkJyk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBWYWxpZGF0ZSByZXF1ZXN0IGJvZHlcclxuICAgICAgaWYgKCFib2R5LmxvY2F0aW9uX25hbWUgfHwgIWJvZHkuY29vcmRpbmF0ZXMgfHwgIWJvZHkuZGVuc2l0eV9sZXZlbCkge1xyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICAgIHsgZXJyb3I6ICdNaXNzaW5nIHJlcXVpcmVkIGZpZWxkcycgfSxcclxuICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFVwZGF0ZSBvciBpbnNlcnQgY3Jvd2QgZGVuc2l0eSBkYXRhXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgICAgLmZyb20oJ2Nyb3dkX2RlbnNpdHknKVxyXG4gICAgICAgICAgLnVwc2VydCh7XHJcbiAgICAgICAgICAgIGxvY2F0aW9uX25hbWU6IGJvZHkubG9jYXRpb25fbmFtZSxcclxuICAgICAgICAgICAgY29vcmRpbmF0ZXM6IGJvZHkuY29vcmRpbmF0ZXMsXHJcbiAgICAgICAgICAgIGRlbnNpdHlfbGV2ZWw6IGJvZHkuZGVuc2l0eV9sZXZlbCxcclxuICAgICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgICAgICBjcm93ZF9zaXplOiBib2R5LmNyb3dkX3NpemUgfHwgbnVsbCxcclxuICAgICAgICAgICAgb2NjdXBhbmN5X3BlcmNlbnRhZ2U6IGJvZHkub2NjdXBhbmN5X3BlcmNlbnRhZ2UgfHwgbnVsbCxcclxuICAgICAgICAgICAgbWV0YV9kYXRhOiBib2R5Lm1ldGFfZGF0YSB8fCBudWxsXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLnNlbGVjdCgpO1xyXG5cclxuICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKGRhdGEpO1xyXG4gICAgICB9IGNhdGNoICh1cHNlcnRFcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkdXJpbmcgdXBzZXJ0IG9wZXJhdGlvbjonLCB1cHNlcnRFcnIpO1xyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICAgIHsgZXJyb3I6ICdEYXRhYmFzZSB1cGRhdGUgZmFpbGVkLCBidXQgcmVxdWVzdCB3YXMgdmFsaWQnIH0sXHJcbiAgICAgICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChib2R5RXJyKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHBhcnNpbmcgcmVxdWVzdCBib2R5OicsIGJvZHlFcnIpO1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogJ0ludmFsaWQgcmVxdWVzdCBmb3JtYXQnIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAobWFpbkVycikge1xyXG4gICAgY29uc29sZS5lcnJvcignVW5oYW5kbGVkIGVycm9yIGluIFBPU1QgaGFuZGxlcjonLCBtYWluRXJyKTtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgeyBlcnJvcjogJ1NlcnZlciBlcnJvciBwcm9jZXNzaW5nIHJlcXVlc3QnIH0sXHJcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgKTtcclxuICB9XHJcbn0gIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsInN1cGFiYXNlQWRtaW4iLCJ1cGRhdGVDcm93ZERlbnNpdHlEYXRhIiwiY2FsY3VsYXRlUmVhbGlzdGljQ3Jvd2REZW5zaXRpZXMiLCJHRVQiLCJyZXF1ZXN0IiwiY29uc29sZSIsImxvZyIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJzZWFyY2hQYXJhbXMiLCJVUkwiLCJ1cmwiLCJmb3JjZVJlZnJlc2giLCJnZXQiLCJjYWxjdWxhdGVkRGF0YSIsImpzb24iLCJyZXN1bHQiLCJkYXRhIiwiZXJyb3IiLCJmcmVzaERhdGEiLCJmZXRjaEVycm9yIiwiZnJvbSIsInNlbGVjdCIsIm9yZGVyIiwiYXNjZW5kaW5nIiwiZGJFcnIiLCJmaXZlTWludXRlc0FnbyIsIkRhdGUiLCJub3ciLCJ0b0lTT1N0cmluZyIsImhhc1JlY2VudERhdGEiLCJsZW5ndGgiLCJ1cGRhdGVkX2F0IiwiRXJyb3IiLCJ1cGRhdGVFcnIiLCJzdXBhYmFzZUVyciIsIm1haW5FcnJvciIsImNhbGNFcnJvciIsIlBPU1QiLCJib2R5IiwicmVjYWxjdWxhdGUiLCJzdWNjZXNzIiwibWVzc2FnZSIsImNvdW50Iiwic3RhdHVzIiwiZXJyIiwicmVjYWxjRXJyIiwibG9jYXRpb25fbmFtZSIsImNvb3JkaW5hdGVzIiwiZGVuc2l0eV9sZXZlbCIsInVwc2VydCIsImNyb3dkX3NpemUiLCJvY2N1cGFuY3lfcGVyY2VudGFnZSIsIm1ldGFfZGF0YSIsInVwc2VydEVyciIsImJvZHlFcnIiLCJtYWluRXJyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/crowd-density/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/crowdSensors.ts":
/*!*********************************!*\
  !*** ./src/lib/crowdSensors.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   calculateRealisticCrowdDensities: () => (/* binding */ calculateRealisticCrowdDensities),\n/* harmony export */   updateCrowdDensityData: () => (/* binding */ updateCrowdDensityData)\n/* harmony export */ });\n/* harmony import */ var _supabase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./supabase */ \"(rsc)/./src/lib/supabase.ts\");\n// Simulated crowd density sensor network for Hajj sites\n\n// Total pilgrims range: 250,000 - 350,000\nconst TOTAL_PILGRIMS_MIN = 250000;\nconst TOTAL_PILGRIMS_MAX = 350000;\nconst TOTAL_PILGRIMS_AVG = Math.floor((TOTAL_PILGRIMS_MIN + TOTAL_PILGRIMS_MAX) / 2);\n// Define physical space characteristics for each location\nconst LOCATION_SIZES = {\n    \"Masjid al-Haram\": {\n        areaInSquareMeters: 356800,\n        capacity: 120000,\n        sections: [\n            {\n                id: \"mataf\",\n                name: \"Mataf Area\",\n                percentage: 0.15\n            },\n            {\n                id: \"ground\",\n                name: \"Ground Floor\",\n                percentage: 0.45\n            },\n            {\n                id: \"first\",\n                name: \"First Floor\",\n                percentage: 0.25\n            },\n            {\n                id: \"roof\",\n                name: \"Roof Area\",\n                percentage: 0.15\n            }\n        ]\n    },\n    \"Mina\": {\n        areaInSquareMeters: 812000,\n        capacity: 240000,\n        sections: [\n            {\n                id: \"tents-a\",\n                name: \"Tents Area A\",\n                percentage: 0.3\n            },\n            {\n                id: \"tents-b\",\n                name: \"Tents Area B\",\n                percentage: 0.3\n            },\n            {\n                id: \"tents-c\",\n                name: \"Tents Area C\",\n                percentage: 0.3\n            },\n            {\n                id: \"services\",\n                name: \"Services Area\",\n                percentage: 0.1\n            }\n        ]\n    },\n    \"Jamaraat Bridge\": {\n        areaInSquareMeters: 52000,\n        capacity: 100000,\n        sections: [\n            {\n                id: \"lower\",\n                name: \"Lower Level\",\n                percentage: 0.3\n            },\n            {\n                id: \"middle\",\n                name: \"Middle Level\",\n                percentage: 0.4\n            },\n            {\n                id: \"upper\",\n                name: \"Upper Level\",\n                percentage: 0.3\n            }\n        ]\n    },\n    \"Arafat\": {\n        areaInSquareMeters: 1456000,\n        capacity: 300000,\n        sections: [\n            {\n                id: \"jabal\",\n                name: \"Jabal al-Rahmah\",\n                percentage: 0.2\n            },\n            {\n                id: \"nimrah\",\n                name: \"Nimrah\",\n                percentage: 0.3\n            },\n            {\n                id: \"uranah\",\n                name: \"Uranah\",\n                percentage: 0.25\n            },\n            {\n                id: \"other\",\n                name: \"Other Areas\",\n                percentage: 0.25\n            }\n        ]\n    },\n    \"Muzdalifah\": {\n        areaInSquareMeters: 623000,\n        capacity: 250000,\n        sections: [\n            {\n                id: \"mash\",\n                name: \"Al-Mash'ar al-Haram\",\n                percentage: 0.3\n            },\n            {\n                id: \"north\",\n                name: \"Northern Area\",\n                percentage: 0.35\n            },\n            {\n                id: \"south\",\n                name: \"Southern Area\",\n                percentage: 0.35\n            }\n        ]\n    },\n    // Additional locations\n    \"Mina Entrance Gate 1\": {\n        areaInSquareMeters: 3000,\n        capacity: 15000,\n        sections: [\n            {\n                id: \"entry\",\n                name: \"Entry Points\",\n                percentage: 0.4\n            },\n            {\n                id: \"security\",\n                name: \"Security Check\",\n                percentage: 0.3\n            },\n            {\n                id: \"waiting\",\n                name: \"Waiting Area\",\n                percentage: 0.3\n            }\n        ]\n    },\n    \"Tent City Section A\": {\n        areaInSquareMeters: 120000,\n        capacity: 80000,\n        sections: [\n            {\n                id: \"a1\",\n                name: \"Block A1\",\n                percentage: 0.25\n            },\n            {\n                id: \"a2\",\n                name: \"Block A2\",\n                percentage: 0.25\n            },\n            {\n                id: \"a3\",\n                name: \"Block A3\",\n                percentage: 0.25\n            },\n            {\n                id: \"a4\",\n                name: \"Block A4\",\n                percentage: 0.25\n            }\n        ]\n    },\n    \"Jamarat Central Access\": {\n        areaInSquareMeters: 8000,\n        capacity: 30000,\n        sections: [\n            {\n                id: \"entry\",\n                name: \"Entry Zone\",\n                percentage: 0.4\n            },\n            {\n                id: \"corridor\",\n                name: \"Main Corridor\",\n                percentage: 0.4\n            },\n            {\n                id: \"exit\",\n                name: \"Exit Zone\",\n                percentage: 0.2\n            }\n        ]\n    }\n};\n// Calculate the sum of all location capacities to verify against total pilgrims\nconst TOTAL_CAPACITY = Object.values(LOCATION_SIZES).reduce((sum, location)=>sum + location.capacity, 0);\n// Define density threshold levels (people per square meter)\n// Adjusted for the pilgrims count of 250,000-350,000\nconst DENSITY_THRESHOLDS = {\n    low: 0.3,\n    medium: 0.8,\n    high: 1.5\n};\n// Time-based modifiers for various Hajj periods - increase/decrease multiplier\nconst TIME_MODIFIERS = {\n    beforePrayer: 2.0,\n    duringPrayer: 2.5,\n    afterPrayer: 1.8,\n    jamarat: 3.0,\n    tawaf: 2.5,\n    sayee: 2.0,\n    night: 0.7,\n    earlyMorning: 0.8,\n    hajjDay: 3.0\n};\n// Weather impacts on crowd behavior\nconst WEATHER_MODIFIERS = {\n    hot: 0.9,\n    rain: 0.7,\n    pleasant: 1.2\n};\n// Function to get realistic crowd densities based on various factors\nasync function calculateRealisticCrowdDensities() {\n    const now = new Date();\n    const hour = now.getHours();\n    const locations = Object.keys(LOCATION_SIZES);\n    // Determine current factors affecting density\n    let timeModifier = 1.0;\n    // Time of day adjustments\n    if (hour >= 22 || hour < 4) {\n        timeModifier = TIME_MODIFIERS.night;\n    } else if (hour >= 4 && hour < 6) {\n        timeModifier = TIME_MODIFIERS.earlyMorning;\n    } else if ([\n        5,\n        12,\n        15,\n        18,\n        20\n    ].includes(hour)) {\n        // Prayer times\n        timeModifier = TIME_MODIFIERS.duringPrayer;\n    } else if ([\n        6,\n        13,\n        16,\n        19,\n        21\n    ].includes(hour)) {\n        // After prayer\n        timeModifier = TIME_MODIFIERS.afterPrayer;\n    } else if ([\n        4,\n        11,\n        14,\n        17,\n        19\n    ].includes(hour)) {\n        // Before prayer\n        timeModifier = TIME_MODIFIERS.beforePrayer;\n    }\n    // Special time adjustments for specific locations\n    const jamarat_hours = [\n        6,\n        7,\n        8,\n        13,\n        14,\n        15,\n        16\n    ];\n    const tawaf_hours = [\n        5,\n        6,\n        7,\n        21,\n        22,\n        23\n    ];\n    // Hajj day simulation (based on month/day/hour)\n    // For demo purposes, we'll simulate one day of the week as Hajj day\n    const isHajjDay = now.getDay() === 5; // Friday for demo purposes\n    // For demo purposes, force \"Hajj day\" behavior when minutes are divisible by 3\n    const forcedHajjDay = now.getMinutes() % 3 === 0;\n    // Weather simulation (simplified)\n    // For demo, we'll base it on time of day in Mecca which is typically hot midday\n    let weatherModifier = 1.0;\n    if (hour >= 11 && hour <= 15) {\n        weatherModifier = WEATHER_MODIFIERS.hot;\n    } else if (hour >= 16 && hour <= 18) {\n        weatherModifier = WEATHER_MODIFIERS.pleasant;\n    }\n    // Determine current total pilgrim count - varies within the range\n    // Use minute of the hour to create some natural variation\n    const pilgrimVariation = now.getMinutes() / 60 * (TOTAL_PILGRIMS_MAX - TOTAL_PILGRIMS_MIN);\n    const currentTotalPilgrims = TOTAL_PILGRIMS_MIN + Math.floor(pilgrimVariation);\n    // Generate realistic crowd density for each location\n    const densityData = locations.map((locationName, index)=>{\n        const locationData = LOCATION_SIZES[locationName];\n        // Apply location-specific modifiers\n        let locationTimeModifier = timeModifier;\n        if (locationName === \"Jamaraat Bridge\" && jamarat_hours.includes(hour)) {\n            locationTimeModifier = TIME_MODIFIERS.jamarat;\n        } else if (locationName === \"Masjid al-Haram\" && tawaf_hours.includes(hour)) {\n            locationTimeModifier = TIME_MODIFIERS.tawaf;\n        } else if (locationName === \"Arafat\" && (isHajjDay || forcedHajjDay)) {\n            locationTimeModifier = TIME_MODIFIERS.hajjDay;\n        }\n        // Use deterministic calculations for density based on location and time\n        // instead of fully random to ensure consistent patterns\n        let baseOccupancyPercentage;\n        // Calculate location's portion of total pilgrims\n        const locationCapacityRatio = locationData.capacity / TOTAL_CAPACITY;\n        const baseExpectedPilgrims = currentTotalPilgrims * locationCapacityRatio;\n        // Each location has different baseline crowd patterns\n        switch(locationName){\n            case \"Masjid al-Haram\":\n                // Masjid al-Haram is consistently busier\n                baseOccupancyPercentage = 0.7 + hour % 3 * 0.1;\n                break;\n            case \"Jamaraat Bridge\":\n                // Jamarat is extremely busy during specific hours\n                if (jamarat_hours.includes(hour)) {\n                    baseOccupancyPercentage = 0.9;\n                } else {\n                    baseOccupancyPercentage = 0.5;\n                }\n                break;\n            case \"Mina\":\n                // Mina varies significantly by day\n                baseOccupancyPercentage = isHajjDay || forcedHajjDay ? 0.95 : 0.6;\n                break;\n            case \"Arafat\":\n                // Arafat is extremely busy on Hajj day, empty otherwise\n                baseOccupancyPercentage = isHajjDay || forcedHajjDay ? 0.98 : 0.3;\n                break;\n            case \"Muzdalifah\":\n                // Muzdalifah is busy in the evening\n                baseOccupancyPercentage = hour >= 18 && hour <= 23 ? 0.85 : 0.4;\n                break;\n            default:\n                // Use minutes/seconds as a seed for other locations to get variation\n                baseOccupancyPercentage = 0.4 + now.getMinutes() % 10 / 10;\n        }\n        // DEMO: For demonstration purposes, ensure we have a mix of all density levels\n        // Force some locations to specific density levels\n        if (index % 5 === 0) {\n            // Every 5th location (by order) is forced to high density\n            baseOccupancyPercentage = 0.9;\n            locationTimeModifier = 2.0;\n        } else if (index % 5 === 1) {\n            // Every 5th+1 location is forced to medium density\n            baseOccupancyPercentage = 0.7;\n            locationTimeModifier = 1.5;\n        } else if (index % 5 === 2) {\n            // Every 5th+2 location is forced to critical density\n            baseOccupancyPercentage = 1.0;\n            locationTimeModifier = 2.5;\n        } else if (index % 5 === 3) {\n            // Every 5th+3 location is forced to low density\n            baseOccupancyPercentage = 0.4;\n            locationTimeModifier = 1.0;\n        }\n        // Every 5th+4 location uses the natural calculation\n        // Apply all modifiers\n        const modifiedOccupancy = baseOccupancyPercentage * locationTimeModifier * weatherModifier;\n        // Add slight randomness (5% instead of 10% for more consistency)\n        const finalOccupancy = modifiedOccupancy * (0.95 + Math.random() * 0.1);\n        // Calculate actual crowd size based on occupancy percentage and capacity\n        const crowdSize = Math.floor(finalOccupancy * locationData.capacity);\n        // Calculate density (people per square meter)\n        const density = crowdSize / locationData.areaInSquareMeters;\n        // Determine density level based on thresholds\n        let densityLevel;\n        if (density <= DENSITY_THRESHOLDS.low) {\n            densityLevel = \"low\";\n        } else if (density <= DENSITY_THRESHOLDS.medium) {\n            densityLevel = \"medium\";\n        } else if (density <= DENSITY_THRESHOLDS.high) {\n            densityLevel = \"high\";\n        } else {\n            densityLevel = \"critical\";\n        }\n        // Generate section-specific data\n        const sectionData = locationData.sections.map((section)=>{\n            // Each section has slightly different occupancy\n            const sectionVariation = 0.9 + Math.random() * 0.2; // 90-110% of location average\n            const sectionDensity = density * sectionVariation;\n            // Determine section density level\n            let sectionDensityLevel;\n            if (sectionDensity <= DENSITY_THRESHOLDS.low) {\n                sectionDensityLevel = \"low\";\n            } else if (sectionDensity <= DENSITY_THRESHOLDS.medium) {\n                sectionDensityLevel = \"medium\";\n            } else if (sectionDensity <= DENSITY_THRESHOLDS.high) {\n                sectionDensityLevel = \"high\";\n            } else {\n                sectionDensityLevel = \"critical\";\n            }\n            return {\n                id: section.id,\n                name: section.name,\n                density: sectionDensity.toFixed(2),\n                density_level: sectionDensityLevel,\n                crowd_size: Math.floor(crowdSize * section.percentage)\n            };\n        });\n        // Add some randomness to the exact coordinates to represent different areas\n        const baseCoordinates = getBaseCoordinates(locationName);\n        const coordinates = {\n            lng: baseCoordinates.lng + (Math.random() * 0.0005 - 0.00025),\n            lat: baseCoordinates.lat + (Math.random() * 0.0005 - 0.00025)\n        };\n        return {\n            location_name: locationName,\n            coordinates: coordinates,\n            density: density.toFixed(2),\n            density_level: densityLevel,\n            crowd_size: crowdSize,\n            capacity: locationData.capacity,\n            occupancy_percentage: (finalOccupancy * 100).toFixed(1),\n            sections: sectionData,\n            timestamp: new Date().toISOString(),\n            meta_data: {\n                density: parseFloat(density.toFixed(2)),\n                capacity: locationData.capacity,\n                sections: sectionData,\n                current_total_pilgrims: currentTotalPilgrims\n            }\n        };\n    });\n    // Debug information about total pilgrim distribution\n    const totalCrowdSize = densityData.reduce((sum, location)=>sum + location.crowd_size, 0);\n    console.log(`Total pilgrims currently distributed: ${totalCrowdSize} (target: ${currentTotalPilgrims})`);\n    return densityData;\n}\n// Function to update database with calculated density\nasync function updateCrowdDensityData() {\n    try {\n        console.log(\"Starting updateCrowdDensityData\");\n        const densityData = await calculateRealisticCrowdDensities();\n        console.log(`Generated ${densityData.length} density data points`);\n        // Log density levels for debugging\n        console.log(\"Current density levels:\");\n        densityData.forEach((location)=>{\n            console.log(`${location.location_name}: ${location.density_level} (${location.density})`);\n        });\n        if (!_supabase__WEBPACK_IMPORTED_MODULE_0__.supabaseAdmin) {\n            console.log(\"Supabase admin client not available, returning calculated data directly\");\n            return {\n                success: true,\n                count: densityData.length,\n                data: densityData,\n                message: \"Database connection not available, using calculated data\"\n            };\n        }\n        // Clear existing data and insert new data\n        try {\n            console.log(\"Attempting to clear existing data\");\n            const { error: deleteError } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabaseAdmin.from(\"crowd_density\").delete().neq(\"id\", 0); // Delete all records\n            if (deleteError) {\n                console.error(\"Error clearing existing data:\", deleteError);\n                return {\n                    success: true,\n                    error: deleteError,\n                    data: densityData,\n                    count: densityData.length,\n                    message: \"Failed to clear existing data, but returning calculated data\"\n                };\n            }\n            // Insert new data\n            console.log(\"Preparing data for insertion\");\n            const upsertData = densityData.map((location)=>({\n                    location_name: location.location_name,\n                    coordinates: location.coordinates,\n                    density_level: location.density_level,\n                    updated_at: new Date().toISOString(),\n                    crowd_size: location.crowd_size,\n                    occupancy_percentage: location.occupancy_percentage,\n                    meta_data: {\n                        density: location.density,\n                        capacity: location.capacity,\n                        sections: location.sections,\n                        current_total_pilgrims: location.meta_data.current_total_pilgrims\n                    }\n                }));\n            console.log(\"Attempting to insert data into Supabase\");\n            const { error: insertError } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabaseAdmin.from(\"crowd_density\").insert(upsertData);\n            if (insertError) {\n                console.error(\"Error inserting crowd density data:\", insertError);\n                return {\n                    success: true,\n                    error: insertError,\n                    data: densityData,\n                    count: densityData.length,\n                    message: \"Failed to insert data, but returning calculated data\"\n                };\n            }\n            console.log(\"Successfully updated crowd density data\");\n            return {\n                success: true,\n                count: densityData.length,\n                data: densityData\n            };\n        } catch (dbError) {\n            console.error(\"Database operation error:\", dbError);\n            return {\n                success: true,\n                error: dbError,\n                data: densityData,\n                count: densityData.length,\n                message: \"Database error, but returning calculated data\"\n            };\n        }\n    } catch (error) {\n        console.error(\"Error in updateCrowdDensityData:\", error);\n        // Try to return calculated data directly as a fallback\n        try {\n            const directData = await calculateRealisticCrowdDensities();\n            return {\n                success: true,\n                error,\n                data: directData,\n                count: directData.length,\n                message: \"Error occurred but returning direct calculation\"\n            };\n        } catch (calcError) {\n            console.error(\"Failed even direct calculation:\", calcError);\n            return {\n                error: \"Complete calculation failure\"\n            };\n        }\n    }\n}\n// Helper function to get base coordinates for each location\nfunction getBaseCoordinates(locationName) {\n    const coordinatesMap = {\n        \"Masjid al-Haram\": {\n            lng: 39.826174,\n            lat: 21.422487\n        },\n        \"Mina\": {\n            lng: 39.892966,\n            lat: 21.413249\n        },\n        \"Jamaraat Bridge\": {\n            lng: 39.873485,\n            lat: 21.42365\n        },\n        \"Arafat\": {\n            lng: 39.984687,\n            lat: 21.355461\n        },\n        \"Muzdalifah\": {\n            lng: 39.936322,\n            lat: 21.383082\n        },\n        \"Mina Entrance Gate 1\": {\n            lng: 39.887235,\n            lat: 21.411856\n        },\n        \"Tent City Section A\": {\n            lng: 39.889124,\n            lat: 21.414501\n        },\n        \"Jamarat Central Access\": {\n            lng: 39.871952,\n            lat: 21.423850\n        }\n    };\n    return coordinatesMap[locationName] || {\n        lng: 39.826174,\n        lat: 21.422487\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixjQUFjLENBQUN2RCxhQUFhLElBQUk7UUFBRXdCLEtBQUs7UUFBV0MsS0FBSztJQUFVO0FBQzFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaGFqai1uYXZpZ2F0b3IvLi9zcmMvbGliL2Nyb3dkU2Vuc29ycy50cz9iZDRlIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFNpbXVsYXRlZCBjcm93ZCBkZW5zaXR5IHNlbnNvciBuZXR3b3JrIGZvciBIYWpqIHNpdGVzXG5pbXBvcnQgeyBzdXBhYmFzZUFkbWluIH0gZnJvbSAnLi9zdXBhYmFzZSc7XG5cbi8vIERlZmluZSB0eXBlcyBmb3Igb3VyIGxvY2F0aW9ucyBkYXRhXG50eXBlIExvY2F0aW9uU2VjdGlvbiA9IHtcbiAgaWQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBwZXJjZW50YWdlOiBudW1iZXI7XG59O1xuXG50eXBlIExvY2F0aW9uRGF0YSA9IHtcbiAgYXJlYUluU3F1YXJlTWV0ZXJzOiBudW1iZXI7XG4gIGNhcGFjaXR5OiBudW1iZXI7XG4gIHNlY3Rpb25zOiBMb2NhdGlvblNlY3Rpb25bXTtcbn07XG5cbnR5cGUgQ29vcmRpbmF0ZXMgPSB7XG4gIGxuZzogbnVtYmVyO1xuICBsYXQ6IG51bWJlcjtcbn07XG5cbnR5cGUgRGVuc2l0eUxldmVsID0gJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJyB8ICdjcml0aWNhbCc7XG5cbi8vIFRvdGFsIHBpbGdyaW1zIHJhbmdlOiAyNTAsMDAwIC0gMzUwLDAwMFxuY29uc3QgVE9UQUxfUElMR1JJTVNfTUlOID0gMjUwMDAwO1xuY29uc3QgVE9UQUxfUElMR1JJTVNfTUFYID0gMzUwMDAwO1xuY29uc3QgVE9UQUxfUElMR1JJTVNfQVZHID0gTWF0aC5mbG9vcigoVE9UQUxfUElMR1JJTVNfTUlOICsgVE9UQUxfUElMR1JJTVNfTUFYKSAvIDIpO1xuXG4vLyBEZWZpbmUgcGh5c2ljYWwgc3BhY2UgY2hhcmFjdGVyaXN0aWNzIGZvciBlYWNoIGxvY2F0aW9uXG5jb25zdCBMT0NBVElPTl9TSVpFUzogUmVjb3JkPHN0cmluZywgTG9jYXRpb25EYXRhPiA9IHtcbiAgJ01hc2ppZCBhbC1IYXJhbSc6IHtcbiAgICBhcmVhSW5TcXVhcmVNZXRlcnM6IDM1NjgwMCwgLy8gVG90YWwgYXJlYSBpbmNsdWRpbmcgZXhwYW5kZWQgcGFydHNcbiAgICBjYXBhY2l0eTogMTIwMDAwLCAvLyBNYXhpbXVtIGNhcGFjaXR5IGFkanVzdGVkIGZvciBwaWxncmltcyBjb3VudFxuICAgIHNlY3Rpb25zOiBbXG4gICAgICB7IGlkOiAnbWF0YWYnLCBuYW1lOiAnTWF0YWYgQXJlYScsIHBlcmNlbnRhZ2U6IDAuMTUgfSxcbiAgICAgIHsgaWQ6ICdncm91bmQnLCBuYW1lOiAnR3JvdW5kIEZsb29yJywgcGVyY2VudGFnZTogMC40NSB9LFxuICAgICAgeyBpZDogJ2ZpcnN0JywgbmFtZTogJ0ZpcnN0IEZsb29yJywgcGVyY2VudGFnZTogMC4yNSB9LFxuICAgICAgeyBpZDogJ3Jvb2YnLCBuYW1lOiAnUm9vZiBBcmVhJywgcGVyY2VudGFnZTogMC4xNSB9XG4gICAgXVxuICB9LFxuICAnTWluYSc6IHtcbiAgICBhcmVhSW5TcXVhcmVNZXRlcnM6IDgxMjAwMCxcbiAgICBjYXBhY2l0eTogMjQwMDAwLCAvLyBBZGp1c3RlZCBmb3IgcGlsZ3JpbXMgY291bnRcbiAgICBzZWN0aW9uczogW1xuICAgICAgeyBpZDogJ3RlbnRzLWEnLCBuYW1lOiAnVGVudHMgQXJlYSBBJywgcGVyY2VudGFnZTogMC4zIH0sXG4gICAgICB7IGlkOiAndGVudHMtYicsIG5hbWU6ICdUZW50cyBBcmVhIEInLCBwZXJjZW50YWdlOiAwLjMgfSxcbiAgICAgIHsgaWQ6ICd0ZW50cy1jJywgbmFtZTogJ1RlbnRzIEFyZWEgQycsIHBlcmNlbnRhZ2U6IDAuMyB9LFxuICAgICAgeyBpZDogJ3NlcnZpY2VzJywgbmFtZTogJ1NlcnZpY2VzIEFyZWEnLCBwZXJjZW50YWdlOiAwLjEgfVxuICAgIF1cbiAgfSxcbiAgJ0phbWFyYWF0IEJyaWRnZSc6IHtcbiAgICBhcmVhSW5TcXVhcmVNZXRlcnM6IDUyMDAwLFxuICAgIGNhcGFjaXR5OiAxMDAwMDAsIC8vIEhvdXJseSBjYXBhY2l0eSBhZGp1c3RlZFxuICAgIHNlY3Rpb25zOiBbXG4gICAgICB7IGlkOiAnbG93ZXInLCBuYW1lOiAnTG93ZXIgTGV2ZWwnLCBwZXJjZW50YWdlOiAwLjMgfSxcbiAgICAgIHsgaWQ6ICdtaWRkbGUnLCBuYW1lOiAnTWlkZGxlIExldmVsJywgcGVyY2VudGFnZTogMC40IH0sXG4gICAgICB7IGlkOiAndXBwZXInLCBuYW1lOiAnVXBwZXIgTGV2ZWwnLCBwZXJjZW50YWdlOiAwLjMgfVxuICAgIF1cbiAgfSxcbiAgJ0FyYWZhdCc6IHtcbiAgICBhcmVhSW5TcXVhcmVNZXRlcnM6IDE0NTYwMDAsXG4gICAgY2FwYWNpdHk6IDMwMDAwMCwgLy8gQWRqdXN0ZWQgZm9yIHBpbGdyaW1zIGNvdW50XG4gICAgc2VjdGlvbnM6IFtcbiAgICAgIHsgaWQ6ICdqYWJhbCcsIG5hbWU6ICdKYWJhbCBhbC1SYWhtYWgnLCBwZXJjZW50YWdlOiAwLjIgfSxcbiAgICAgIHsgaWQ6ICduaW1yYWgnLCBuYW1lOiAnTmltcmFoJywgcGVyY2VudGFnZTogMC4zIH0sXG4gICAgICB7IGlkOiAndXJhbmFoJywgbmFtZTogJ1VyYW5haCcsIHBlcmNlbnRhZ2U6IDAuMjUgfSxcbiAgICAgIHsgaWQ6ICdvdGhlcicsIG5hbWU6ICdPdGhlciBBcmVhcycsIHBlcmNlbnRhZ2U6IDAuMjUgfVxuICAgIF1cbiAgfSxcbiAgJ011emRhbGlmYWgnOiB7XG4gICAgYXJlYUluU3F1YXJlTWV0ZXJzOiA2MjMwMDAsXG4gICAgY2FwYWNpdHk6IDI1MDAwMCwgLy8gQWRqdXN0ZWQgZm9yIHBpbGdyaW1zIGNvdW50XG4gICAgc2VjdGlvbnM6IFtcbiAgICAgIHsgaWQ6ICdtYXNoJywgbmFtZTogJ0FsLU1hc2hcXCdhciBhbC1IYXJhbScsIHBlcmNlbnRhZ2U6IDAuMyB9LFxuICAgICAgeyBpZDogJ25vcnRoJywgbmFtZTogJ05vcnRoZXJuIEFyZWEnLCBwZXJjZW50YWdlOiAwLjM1IH0sXG4gICAgICB7IGlkOiAnc291dGgnLCBuYW1lOiAnU291dGhlcm4gQXJlYScsIHBlcmNlbnRhZ2U6IDAuMzUgfVxuICAgIF1cbiAgfSxcbiAgLy8gQWRkaXRpb25hbCBsb2NhdGlvbnNcbiAgJ01pbmEgRW50cmFuY2UgR2F0ZSAxJzoge1xuICAgIGFyZWFJblNxdWFyZU1ldGVyczogMzAwMCxcbiAgICBjYXBhY2l0eTogMTUwMDAsIC8vIEhvdXJseSBjYXBhY2l0eVxuICAgIHNlY3Rpb25zOiBbXG4gICAgICB7IGlkOiAnZW50cnknLCBuYW1lOiAnRW50cnkgUG9pbnRzJywgcGVyY2VudGFnZTogMC40IH0sXG4gICAgICB7IGlkOiAnc2VjdXJpdHknLCBuYW1lOiAnU2VjdXJpdHkgQ2hlY2snLCBwZXJjZW50YWdlOiAwLjMgfSxcbiAgICAgIHsgaWQ6ICd3YWl0aW5nJywgbmFtZTogJ1dhaXRpbmcgQXJlYScsIHBlcmNlbnRhZ2U6IDAuMyB9XG4gICAgXVxuICB9LFxuICAnVGVudCBDaXR5IFNlY3Rpb24gQSc6IHtcbiAgICBhcmVhSW5TcXVhcmVNZXRlcnM6IDEyMDAwMCxcbiAgICBjYXBhY2l0eTogODAwMDAsIC8vIEFkanVzdGVkIGZvciBwaWxncmltcyBjb3VudFxuICAgIHNlY3Rpb25zOiBbXG4gICAgICB7IGlkOiAnYTEnLCBuYW1lOiAnQmxvY2sgQTEnLCBwZXJjZW50YWdlOiAwLjI1IH0sXG4gICAgICB7IGlkOiAnYTInLCBuYW1lOiAnQmxvY2sgQTInLCBwZXJjZW50YWdlOiAwLjI1IH0sXG4gICAgICB7IGlkOiAnYTMnLCBuYW1lOiAnQmxvY2sgQTMnLCBwZXJjZW50YWdlOiAwLjI1IH0sXG4gICAgICB7IGlkOiAnYTQnLCBuYW1lOiAnQmxvY2sgQTQnLCBwZXJjZW50YWdlOiAwLjI1IH1cbiAgICBdXG4gIH0sXG4gICdKYW1hcmF0IENlbnRyYWwgQWNjZXNzJzoge1xuICAgIGFyZWFJblNxdWFyZU1ldGVyczogODAwMCxcbiAgICBjYXBhY2l0eTogMzAwMDAsIC8vIEhvdXJseSBjYXBhY2l0eVxuICAgIHNlY3Rpb25zOiBbXG4gICAgICB7IGlkOiAnZW50cnknLCBuYW1lOiAnRW50cnkgWm9uZScsIHBlcmNlbnRhZ2U6IDAuNCB9LFxuICAgICAgeyBpZDogJ2NvcnJpZG9yJywgbmFtZTogJ01haW4gQ29ycmlkb3InLCBwZXJjZW50YWdlOiAwLjQgfSxcbiAgICAgIHsgaWQ6ICdleGl0JywgbmFtZTogJ0V4aXQgWm9uZScsIHBlcmNlbnRhZ2U6IDAuMiB9XG4gICAgXVxuICB9LFxufTtcblxuLy8gQ2FsY3VsYXRlIHRoZSBzdW0gb2YgYWxsIGxvY2F0aW9uIGNhcGFjaXRpZXMgdG8gdmVyaWZ5IGFnYWluc3QgdG90YWwgcGlsZ3JpbXNcbmNvbnN0IFRPVEFMX0NBUEFDSVRZID0gT2JqZWN0LnZhbHVlcyhMT0NBVElPTl9TSVpFUykucmVkdWNlKFxuICAoc3VtLCBsb2NhdGlvbikgPT4gc3VtICsgbG9jYXRpb24uY2FwYWNpdHksIFxuICAwXG4pO1xuXG4vLyBEZWZpbmUgZGVuc2l0eSB0aHJlc2hvbGQgbGV2ZWxzIChwZW9wbGUgcGVyIHNxdWFyZSBtZXRlcilcbi8vIEFkanVzdGVkIGZvciB0aGUgcGlsZ3JpbXMgY291bnQgb2YgMjUwLDAwMC0zNTAsMDAwXG5jb25zdCBERU5TSVRZX1RIUkVTSE9MRFMgPSB7XG4gIGxvdzogMC4zLCAvLyAwLTAuMyBwZW9wbGUgcGVyIHNxdWFyZSBtZXRlciAtIGNvbWZvcnRhYmxlIG1vdmVtZW50XG4gIG1lZGl1bTogMC44LCAvLyAwLjMtMC44IHBlb3BsZSBwZXIgc3F1YXJlIG1ldGVyIC0gbW9kZXJhdGUgZGVuc2l0eVxuICBoaWdoOiAxLjUsIC8vIDAuOC0xLjUgcGVvcGxlIHBlciBzcXVhcmUgbWV0ZXIgLSBoaWdoIGRlbnNpdHkgYnV0IG1hbmFnZWFibGVcbiAgLy8gQWJvdmUgMS41IGlzIGNvbnNpZGVyZWQgY3JpdGljYWwgLSBkaWZmaWN1bHQgbW92ZW1lbnRcbn07XG5cbi8vIFRpbWUtYmFzZWQgbW9kaWZpZXJzIGZvciB2YXJpb3VzIEhhamogcGVyaW9kcyAtIGluY3JlYXNlL2RlY3JlYXNlIG11bHRpcGxpZXJcbmNvbnN0IFRJTUVfTU9ESUZJRVJTID0ge1xuICBiZWZvcmVQcmF5ZXI6IDIuMCwgLy8gQmVmb3JlIHByYXllciB0aW1lc1xuICBkdXJpbmdQcmF5ZXI6IDIuNSwgLy8gRHVyaW5nIHByYXllciB0aW1lcyBpbiBNYXNqaWQgYWwtSGFyYW1cbiAgYWZ0ZXJQcmF5ZXI6IDEuOCwgLy8gQWZ0ZXIgcHJheWVyIGRpc3BlcnNhbFxuICBqYW1hcmF0OiAzLjAsIC8vIER1cmluZyBzdG9uaW5nIHJpdHVhbCB0aW1lc1xuICB0YXdhZjogMi41LCAvLyBEdXJpbmcgcGVhayBUYXdhZiBob3Vyc1xuICBzYXllZTogMi4wLCAvLyBEdXJpbmcgcGVhayBTYSdlZSBob3Vyc1xuICBuaWdodDogMC43LCAvLyBMYXRlIG5pZ2h0IGhvdXJzXG4gIGVhcmx5TW9ybmluZzogMC44LCAvLyBFYXJseSBtb3JuaW5nIGhvdXJzXG4gIGhhampEYXk6IDMuMCwgLy8gTWFpbiBIYWpqIGRheSBhdCBBcmFmYXRcbn07XG5cbi8vIFdlYXRoZXIgaW1wYWN0cyBvbiBjcm93ZCBiZWhhdmlvclxuY29uc3QgV0VBVEhFUl9NT0RJRklFUlMgPSB7XG4gIGhvdDogMC45LCAvLyBWZXJ5IGhvdCB3ZWF0aGVyIHJlZHVjZXMgb3V0ZG9vciBkZW5zaXRpZXNcbiAgcmFpbjogMC43LCAvLyBSYWluIHJlZHVjZXMgb3V0ZG9vciBkZW5zaXRpZXMgXG4gIHBsZWFzYW50OiAxLjIsIC8vIFBsZWFzYW50IHdlYXRoZXIgaW5jcmVhc2VzIG1vdmVtZW50XG59O1xuXG4vLyBGdW5jdGlvbiB0byBnZXQgcmVhbGlzdGljIGNyb3dkIGRlbnNpdGllcyBiYXNlZCBvbiB2YXJpb3VzIGZhY3RvcnNcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjYWxjdWxhdGVSZWFsaXN0aWNDcm93ZERlbnNpdGllcygpIHtcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgY29uc3QgaG91ciA9IG5vdy5nZXRIb3VycygpO1xuICBjb25zdCBsb2NhdGlvbnMgPSBPYmplY3Qua2V5cyhMT0NBVElPTl9TSVpFUyk7XG4gIFxuICAvLyBEZXRlcm1pbmUgY3VycmVudCBmYWN0b3JzIGFmZmVjdGluZyBkZW5zaXR5XG4gIGxldCB0aW1lTW9kaWZpZXIgPSAxLjA7XG4gIFxuICAvLyBUaW1lIG9mIGRheSBhZGp1c3RtZW50c1xuICBpZiAoaG91ciA+PSAyMiB8fCBob3VyIDwgNCkge1xuICAgIHRpbWVNb2RpZmllciA9IFRJTUVfTU9ESUZJRVJTLm5pZ2h0O1xuICB9IGVsc2UgaWYgKGhvdXIgPj0gNCAmJiBob3VyIDwgNikge1xuICAgIHRpbWVNb2RpZmllciA9IFRJTUVfTU9ESUZJRVJTLmVhcmx5TW9ybmluZztcbiAgfSBlbHNlIGlmIChbNSwgMTIsIDE1LCAxOCwgMjBdLmluY2x1ZGVzKGhvdXIpKSB7XG4gICAgLy8gUHJheWVyIHRpbWVzXG4gICAgdGltZU1vZGlmaWVyID0gVElNRV9NT0RJRklFUlMuZHVyaW5nUHJheWVyO1xuICB9IGVsc2UgaWYgKFs2LCAxMywgMTYsIDE5LCAyMV0uaW5jbHVkZXMoaG91cikpIHtcbiAgICAvLyBBZnRlciBwcmF5ZXJcbiAgICB0aW1lTW9kaWZpZXIgPSBUSU1FX01PRElGSUVSUy5hZnRlclByYXllcjtcbiAgfSBlbHNlIGlmIChbNCwgMTEsIDE0LCAxNywgMTldLmluY2x1ZGVzKGhvdXIpKSB7XG4gICAgLy8gQmVmb3JlIHByYXllclxuICAgIHRpbWVNb2RpZmllciA9IFRJTUVfTU9ESUZJRVJTLmJlZm9yZVByYXllcjtcbiAgfVxuICBcbiAgLy8gU3BlY2lhbCB0aW1lIGFkanVzdG1lbnRzIGZvciBzcGVjaWZpYyBsb2NhdGlvbnNcbiAgY29uc3QgamFtYXJhdF9ob3VycyA9IFs2LCA3LCA4LCAxMywgMTQsIDE1LCAxNl07XG4gIGNvbnN0IHRhd2FmX2hvdXJzID0gWzUsIDYsIDcsIDIxLCAyMiwgMjNdO1xuICBcbiAgLy8gSGFqaiBkYXkgc2ltdWxhdGlvbiAoYmFzZWQgb24gbW9udGgvZGF5L2hvdXIpXG4gIC8vIEZvciBkZW1vIHB1cnBvc2VzLCB3ZSdsbCBzaW11bGF0ZSBvbmUgZGF5IG9mIHRoZSB3ZWVrIGFzIEhhamogZGF5XG4gIGNvbnN0IGlzSGFqakRheSA9IG5vdy5nZXREYXkoKSA9PT0gNTsgLy8gRnJpZGF5IGZvciBkZW1vIHB1cnBvc2VzXG4gIFxuICAvLyBGb3IgZGVtbyBwdXJwb3NlcywgZm9yY2UgXCJIYWpqIGRheVwiIGJlaGF2aW9yIHdoZW4gbWludXRlcyBhcmUgZGl2aXNpYmxlIGJ5IDNcbiAgY29uc3QgZm9yY2VkSGFqakRheSA9IG5vdy5nZXRNaW51dGVzKCkgJSAzID09PSAwO1xuICBcbiAgLy8gV2VhdGhlciBzaW11bGF0aW9uIChzaW1wbGlmaWVkKVxuICAvLyBGb3IgZGVtbywgd2UnbGwgYmFzZSBpdCBvbiB0aW1lIG9mIGRheSBpbiBNZWNjYSB3aGljaCBpcyB0eXBpY2FsbHkgaG90IG1pZGRheVxuICBsZXQgd2VhdGhlck1vZGlmaWVyID0gMS4wO1xuICBpZiAoaG91ciA+PSAxMSAmJiBob3VyIDw9IDE1KSB7XG4gICAgd2VhdGhlck1vZGlmaWVyID0gV0VBVEhFUl9NT0RJRklFUlMuaG90O1xuICB9IGVsc2UgaWYgKGhvdXIgPj0gMTYgJiYgaG91ciA8PSAxOCkge1xuICAgIHdlYXRoZXJNb2RpZmllciA9IFdFQVRIRVJfTU9ESUZJRVJTLnBsZWFzYW50O1xuICB9XG4gIFxuICAvLyBEZXRlcm1pbmUgY3VycmVudCB0b3RhbCBwaWxncmltIGNvdW50IC0gdmFyaWVzIHdpdGhpbiB0aGUgcmFuZ2VcbiAgLy8gVXNlIG1pbnV0ZSBvZiB0aGUgaG91ciB0byBjcmVhdGUgc29tZSBuYXR1cmFsIHZhcmlhdGlvblxuICBjb25zdCBwaWxncmltVmFyaWF0aW9uID0gKG5vdy5nZXRNaW51dGVzKCkgLyA2MCkgKiAoVE9UQUxfUElMR1JJTVNfTUFYIC0gVE9UQUxfUElMR1JJTVNfTUlOKTtcbiAgY29uc3QgY3VycmVudFRvdGFsUGlsZ3JpbXMgPSBUT1RBTF9QSUxHUklNU19NSU4gKyBNYXRoLmZsb29yKHBpbGdyaW1WYXJpYXRpb24pO1xuICBcbiAgLy8gR2VuZXJhdGUgcmVhbGlzdGljIGNyb3dkIGRlbnNpdHkgZm9yIGVhY2ggbG9jYXRpb25cbiAgY29uc3QgZGVuc2l0eURhdGEgPSBsb2NhdGlvbnMubWFwKChsb2NhdGlvbk5hbWUsIGluZGV4KSA9PiB7XG4gICAgY29uc3QgbG9jYXRpb25EYXRhID0gTE9DQVRJT05fU0laRVNbbG9jYXRpb25OYW1lXTtcbiAgICBcbiAgICAvLyBBcHBseSBsb2NhdGlvbi1zcGVjaWZpYyBtb2RpZmllcnNcbiAgICBsZXQgbG9jYXRpb25UaW1lTW9kaWZpZXIgPSB0aW1lTW9kaWZpZXI7XG4gICAgXG4gICAgaWYgKGxvY2F0aW9uTmFtZSA9PT0gJ0phbWFyYWF0IEJyaWRnZScgJiYgamFtYXJhdF9ob3Vycy5pbmNsdWRlcyhob3VyKSkge1xuICAgICAgbG9jYXRpb25UaW1lTW9kaWZpZXIgPSBUSU1FX01PRElGSUVSUy5qYW1hcmF0O1xuICAgIH0gZWxzZSBpZiAobG9jYXRpb25OYW1lID09PSAnTWFzamlkIGFsLUhhcmFtJyAmJiB0YXdhZl9ob3Vycy5pbmNsdWRlcyhob3VyKSkge1xuICAgICAgbG9jYXRpb25UaW1lTW9kaWZpZXIgPSBUSU1FX01PRElGSUVSUy50YXdhZjtcbiAgICB9IGVsc2UgaWYgKGxvY2F0aW9uTmFtZSA9PT0gJ0FyYWZhdCcgJiYgKGlzSGFqakRheSB8fCBmb3JjZWRIYWpqRGF5KSkge1xuICAgICAgbG9jYXRpb25UaW1lTW9kaWZpZXIgPSBUSU1FX01PRElGSUVSUy5oYWpqRGF5O1xuICAgIH1cbiAgICBcbiAgICAvLyBVc2UgZGV0ZXJtaW5pc3RpYyBjYWxjdWxhdGlvbnMgZm9yIGRlbnNpdHkgYmFzZWQgb24gbG9jYXRpb24gYW5kIHRpbWVcbiAgICAvLyBpbnN0ZWFkIG9mIGZ1bGx5IHJhbmRvbSB0byBlbnN1cmUgY29uc2lzdGVudCBwYXR0ZXJuc1xuICAgIGxldCBiYXNlT2NjdXBhbmN5UGVyY2VudGFnZTtcbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgbG9jYXRpb24ncyBwb3J0aW9uIG9mIHRvdGFsIHBpbGdyaW1zXG4gICAgY29uc3QgbG9jYXRpb25DYXBhY2l0eVJhdGlvID0gbG9jYXRpb25EYXRhLmNhcGFjaXR5IC8gVE9UQUxfQ0FQQUNJVFk7XG4gICAgY29uc3QgYmFzZUV4cGVjdGVkUGlsZ3JpbXMgPSBjdXJyZW50VG90YWxQaWxncmltcyAqIGxvY2F0aW9uQ2FwYWNpdHlSYXRpbztcbiAgICBcbiAgICAvLyBFYWNoIGxvY2F0aW9uIGhhcyBkaWZmZXJlbnQgYmFzZWxpbmUgY3Jvd2QgcGF0dGVybnNcbiAgICBzd2l0Y2ggKGxvY2F0aW9uTmFtZSkge1xuICAgICAgY2FzZSAnTWFzamlkIGFsLUhhcmFtJzpcbiAgICAgICAgLy8gTWFzamlkIGFsLUhhcmFtIGlzIGNvbnNpc3RlbnRseSBidXNpZXJcbiAgICAgICAgYmFzZU9jY3VwYW5jeVBlcmNlbnRhZ2UgPSAwLjcgKyAoaG91ciAlIDMpICogMC4xO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ0phbWFyYWF0IEJyaWRnZSc6XG4gICAgICAgIC8vIEphbWFyYXQgaXMgZXh0cmVtZWx5IGJ1c3kgZHVyaW5nIHNwZWNpZmljIGhvdXJzXG4gICAgICAgIGlmIChqYW1hcmF0X2hvdXJzLmluY2x1ZGVzKGhvdXIpKSB7XG4gICAgICAgICAgYmFzZU9jY3VwYW5jeVBlcmNlbnRhZ2UgPSAwLjk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYmFzZU9jY3VwYW5jeVBlcmNlbnRhZ2UgPSAwLjU7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdNaW5hJzpcbiAgICAgICAgLy8gTWluYSB2YXJpZXMgc2lnbmlmaWNhbnRseSBieSBkYXlcbiAgICAgICAgYmFzZU9jY3VwYW5jeVBlcmNlbnRhZ2UgPSAoaXNIYWpqRGF5IHx8IGZvcmNlZEhhampEYXkpID8gMC45NSA6IDAuNjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdBcmFmYXQnOlxuICAgICAgICAvLyBBcmFmYXQgaXMgZXh0cmVtZWx5IGJ1c3kgb24gSGFqaiBkYXksIGVtcHR5IG90aGVyd2lzZVxuICAgICAgICBiYXNlT2NjdXBhbmN5UGVyY2VudGFnZSA9IChpc0hhampEYXkgfHwgZm9yY2VkSGFqakRheSkgPyAwLjk4IDogMC4zO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ011emRhbGlmYWgnOlxuICAgICAgICAvLyBNdXpkYWxpZmFoIGlzIGJ1c3kgaW4gdGhlIGV2ZW5pbmdcbiAgICAgICAgYmFzZU9jY3VwYW5jeVBlcmNlbnRhZ2UgPSAoaG91ciA+PSAxOCAmJiBob3VyIDw9IDIzKSA/IDAuODUgOiAwLjQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgLy8gVXNlIG1pbnV0ZXMvc2Vjb25kcyBhcyBhIHNlZWQgZm9yIG90aGVyIGxvY2F0aW9ucyB0byBnZXQgdmFyaWF0aW9uXG4gICAgICAgIGJhc2VPY2N1cGFuY3lQZXJjZW50YWdlID0gMC40ICsgKG5vdy5nZXRNaW51dGVzKCkgJSAxMCkgLyAxMDtcbiAgICB9XG4gICAgXG4gICAgLy8gREVNTzogRm9yIGRlbW9uc3RyYXRpb24gcHVycG9zZXMsIGVuc3VyZSB3ZSBoYXZlIGEgbWl4IG9mIGFsbCBkZW5zaXR5IGxldmVsc1xuICAgIC8vIEZvcmNlIHNvbWUgbG9jYXRpb25zIHRvIHNwZWNpZmljIGRlbnNpdHkgbGV2ZWxzXG4gICAgaWYgKGluZGV4ICUgNSA9PT0gMCkge1xuICAgICAgLy8gRXZlcnkgNXRoIGxvY2F0aW9uIChieSBvcmRlcikgaXMgZm9yY2VkIHRvIGhpZ2ggZGVuc2l0eVxuICAgICAgYmFzZU9jY3VwYW5jeVBlcmNlbnRhZ2UgPSAwLjk7XG4gICAgICBsb2NhdGlvblRpbWVNb2RpZmllciA9IDIuMDtcbiAgICB9IGVsc2UgaWYgKGluZGV4ICUgNSA9PT0gMSkge1xuICAgICAgLy8gRXZlcnkgNXRoKzEgbG9jYXRpb24gaXMgZm9yY2VkIHRvIG1lZGl1bSBkZW5zaXR5XG4gICAgICBiYXNlT2NjdXBhbmN5UGVyY2VudGFnZSA9IDAuNztcbiAgICAgIGxvY2F0aW9uVGltZU1vZGlmaWVyID0gMS41O1xuICAgIH0gZWxzZSBpZiAoaW5kZXggJSA1ID09PSAyKSB7XG4gICAgICAvLyBFdmVyeSA1dGgrMiBsb2NhdGlvbiBpcyBmb3JjZWQgdG8gY3JpdGljYWwgZGVuc2l0eVxuICAgICAgYmFzZU9jY3VwYW5jeVBlcmNlbnRhZ2UgPSAxLjA7XG4gICAgICBsb2NhdGlvblRpbWVNb2RpZmllciA9IDIuNTtcbiAgICB9IGVsc2UgaWYgKGluZGV4ICUgNSA9PT0gMykge1xuICAgICAgLy8gRXZlcnkgNXRoKzMgbG9jYXRpb24gaXMgZm9yY2VkIHRvIGxvdyBkZW5zaXR5XG4gICAgICBiYXNlT2NjdXBhbmN5UGVyY2VudGFnZSA9IDAuNDtcbiAgICAgIGxvY2F0aW9uVGltZU1vZGlmaWVyID0gMS4wO1xuICAgIH1cbiAgICAvLyBFdmVyeSA1dGgrNCBsb2NhdGlvbiB1c2VzIHRoZSBuYXR1cmFsIGNhbGN1bGF0aW9uXG4gICAgXG4gICAgLy8gQXBwbHkgYWxsIG1vZGlmaWVyc1xuICAgIGNvbnN0IG1vZGlmaWVkT2NjdXBhbmN5ID0gYmFzZU9jY3VwYW5jeVBlcmNlbnRhZ2UgKiBsb2NhdGlvblRpbWVNb2RpZmllciAqIHdlYXRoZXJNb2RpZmllcjtcbiAgICBcbiAgICAvLyBBZGQgc2xpZ2h0IHJhbmRvbW5lc3MgKMKxNSUgaW5zdGVhZCBvZiDCsTEwJSBmb3IgbW9yZSBjb25zaXN0ZW5jeSlcbiAgICBjb25zdCBmaW5hbE9jY3VwYW5jeSA9IG1vZGlmaWVkT2NjdXBhbmN5ICogKDAuOTUgKyBNYXRoLnJhbmRvbSgpICogMC4xKTtcbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgYWN0dWFsIGNyb3dkIHNpemUgYmFzZWQgb24gb2NjdXBhbmN5IHBlcmNlbnRhZ2UgYW5kIGNhcGFjaXR5XG4gICAgY29uc3QgY3Jvd2RTaXplID0gTWF0aC5mbG9vcihmaW5hbE9jY3VwYW5jeSAqIGxvY2F0aW9uRGF0YS5jYXBhY2l0eSk7XG4gICAgXG4gICAgLy8gQ2FsY3VsYXRlIGRlbnNpdHkgKHBlb3BsZSBwZXIgc3F1YXJlIG1ldGVyKVxuICAgIGNvbnN0IGRlbnNpdHkgPSBjcm93ZFNpemUgLyBsb2NhdGlvbkRhdGEuYXJlYUluU3F1YXJlTWV0ZXJzO1xuICAgIFxuICAgIC8vIERldGVybWluZSBkZW5zaXR5IGxldmVsIGJhc2VkIG9uIHRocmVzaG9sZHNcbiAgICBsZXQgZGVuc2l0eUxldmVsOiBEZW5zaXR5TGV2ZWw7XG4gICAgaWYgKGRlbnNpdHkgPD0gREVOU0lUWV9USFJFU0hPTERTLmxvdykge1xuICAgICAgZGVuc2l0eUxldmVsID0gJ2xvdyc7XG4gICAgfSBlbHNlIGlmIChkZW5zaXR5IDw9IERFTlNJVFlfVEhSRVNIT0xEUy5tZWRpdW0pIHtcbiAgICAgIGRlbnNpdHlMZXZlbCA9ICdtZWRpdW0nO1xuICAgIH0gZWxzZSBpZiAoZGVuc2l0eSA8PSBERU5TSVRZX1RIUkVTSE9MRFMuaGlnaCkge1xuICAgICAgZGVuc2l0eUxldmVsID0gJ2hpZ2gnO1xuICAgIH0gZWxzZSB7XG4gICAgICBkZW5zaXR5TGV2ZWwgPSAnY3JpdGljYWwnO1xuICAgIH1cbiAgICBcbiAgICAvLyBHZW5lcmF0ZSBzZWN0aW9uLXNwZWNpZmljIGRhdGFcbiAgICBjb25zdCBzZWN0aW9uRGF0YSA9IGxvY2F0aW9uRGF0YS5zZWN0aW9ucy5tYXAoKHNlY3Rpb246IExvY2F0aW9uU2VjdGlvbikgPT4ge1xuICAgICAgLy8gRWFjaCBzZWN0aW9uIGhhcyBzbGlnaHRseSBkaWZmZXJlbnQgb2NjdXBhbmN5XG4gICAgICBjb25zdCBzZWN0aW9uVmFyaWF0aW9uID0gMC45ICsgTWF0aC5yYW5kb20oKSAqIDAuMjsgLy8gOTAtMTEwJSBvZiBsb2NhdGlvbiBhdmVyYWdlXG4gICAgICBjb25zdCBzZWN0aW9uRGVuc2l0eSA9IGRlbnNpdHkgKiBzZWN0aW9uVmFyaWF0aW9uO1xuICAgICAgXG4gICAgICAvLyBEZXRlcm1pbmUgc2VjdGlvbiBkZW5zaXR5IGxldmVsXG4gICAgICBsZXQgc2VjdGlvbkRlbnNpdHlMZXZlbDogRGVuc2l0eUxldmVsO1xuICAgICAgaWYgKHNlY3Rpb25EZW5zaXR5IDw9IERFTlNJVFlfVEhSRVNIT0xEUy5sb3cpIHtcbiAgICAgICAgc2VjdGlvbkRlbnNpdHlMZXZlbCA9ICdsb3cnO1xuICAgICAgfSBlbHNlIGlmIChzZWN0aW9uRGVuc2l0eSA8PSBERU5TSVRZX1RIUkVTSE9MRFMubWVkaXVtKSB7XG4gICAgICAgIHNlY3Rpb25EZW5zaXR5TGV2ZWwgPSAnbWVkaXVtJztcbiAgICAgIH0gZWxzZSBpZiAoc2VjdGlvbkRlbnNpdHkgPD0gREVOU0lUWV9USFJFU0hPTERTLmhpZ2gpIHtcbiAgICAgICAgc2VjdGlvbkRlbnNpdHlMZXZlbCA9ICdoaWdoJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNlY3Rpb25EZW5zaXR5TGV2ZWwgPSAnY3JpdGljYWwnO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpZDogc2VjdGlvbi5pZCxcbiAgICAgICAgbmFtZTogc2VjdGlvbi5uYW1lLFxuICAgICAgICBkZW5zaXR5OiBzZWN0aW9uRGVuc2l0eS50b0ZpeGVkKDIpLFxuICAgICAgICBkZW5zaXR5X2xldmVsOiBzZWN0aW9uRGVuc2l0eUxldmVsLFxuICAgICAgICBjcm93ZF9zaXplOiBNYXRoLmZsb29yKGNyb3dkU2l6ZSAqIHNlY3Rpb24ucGVyY2VudGFnZSksXG4gICAgICB9O1xuICAgIH0pO1xuICAgIFxuICAgIC8vIEFkZCBzb21lIHJhbmRvbW5lc3MgdG8gdGhlIGV4YWN0IGNvb3JkaW5hdGVzIHRvIHJlcHJlc2VudCBkaWZmZXJlbnQgYXJlYXNcbiAgICBjb25zdCBiYXNlQ29vcmRpbmF0ZXMgPSBnZXRCYXNlQ29vcmRpbmF0ZXMobG9jYXRpb25OYW1lKTtcbiAgICBjb25zdCBjb29yZGluYXRlcyA9IHtcbiAgICAgIGxuZzogYmFzZUNvb3JkaW5hdGVzLmxuZyArIChNYXRoLnJhbmRvbSgpICogMC4wMDA1IC0gMC4wMDAyNSksXG4gICAgICBsYXQ6IGJhc2VDb29yZGluYXRlcy5sYXQgKyAoTWF0aC5yYW5kb20oKSAqIDAuMDAwNSAtIDAuMDAwMjUpXG4gICAgfTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgbG9jYXRpb25fbmFtZTogbG9jYXRpb25OYW1lLFxuICAgICAgY29vcmRpbmF0ZXM6IGNvb3JkaW5hdGVzLFxuICAgICAgZGVuc2l0eTogZGVuc2l0eS50b0ZpeGVkKDIpLFxuICAgICAgZGVuc2l0eV9sZXZlbDogZGVuc2l0eUxldmVsLFxuICAgICAgY3Jvd2Rfc2l6ZTogY3Jvd2RTaXplLFxuICAgICAgY2FwYWNpdHk6IGxvY2F0aW9uRGF0YS5jYXBhY2l0eSxcbiAgICAgIG9jY3VwYW5jeV9wZXJjZW50YWdlOiAoZmluYWxPY2N1cGFuY3kgKiAxMDApLnRvRml4ZWQoMSksXG4gICAgICBzZWN0aW9uczogc2VjdGlvbkRhdGEsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIG1ldGFfZGF0YToge1xuICAgICAgICBkZW5zaXR5OiBwYXJzZUZsb2F0KGRlbnNpdHkudG9GaXhlZCgyKSksXG4gICAgICAgIGNhcGFjaXR5OiBsb2NhdGlvbkRhdGEuY2FwYWNpdHksXG4gICAgICAgIHNlY3Rpb25zOiBzZWN0aW9uRGF0YSxcbiAgICAgICAgY3VycmVudF90b3RhbF9waWxncmltczogY3VycmVudFRvdGFsUGlsZ3JpbXNcbiAgICAgIH1cbiAgICB9O1xuICB9KTtcbiAgXG4gIC8vIERlYnVnIGluZm9ybWF0aW9uIGFib3V0IHRvdGFsIHBpbGdyaW0gZGlzdHJpYnV0aW9uXG4gIGNvbnN0IHRvdGFsQ3Jvd2RTaXplID0gZGVuc2l0eURhdGEucmVkdWNlKChzdW0sIGxvY2F0aW9uKSA9PiBzdW0gKyBsb2NhdGlvbi5jcm93ZF9zaXplLCAwKTtcbiAgY29uc29sZS5sb2coYFRvdGFsIHBpbGdyaW1zIGN1cnJlbnRseSBkaXN0cmlidXRlZDogJHt0b3RhbENyb3dkU2l6ZX0gKHRhcmdldDogJHtjdXJyZW50VG90YWxQaWxncmltc30pYCk7XG4gIFxuICByZXR1cm4gZGVuc2l0eURhdGE7XG59XG5cbi8vIEZ1bmN0aW9uIHRvIHVwZGF0ZSBkYXRhYmFzZSB3aXRoIGNhbGN1bGF0ZWQgZGVuc2l0eVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUNyb3dkRGVuc2l0eURhdGEoKSB7XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coJ1N0YXJ0aW5nIHVwZGF0ZUNyb3dkRGVuc2l0eURhdGEnKTtcbiAgICBjb25zdCBkZW5zaXR5RGF0YSA9IGF3YWl0IGNhbGN1bGF0ZVJlYWxpc3RpY0Nyb3dkRGVuc2l0aWVzKCk7XG4gICAgY29uc29sZS5sb2coYEdlbmVyYXRlZCAke2RlbnNpdHlEYXRhLmxlbmd0aH0gZGVuc2l0eSBkYXRhIHBvaW50c2ApO1xuICAgIFxuICAgIC8vIExvZyBkZW5zaXR5IGxldmVscyBmb3IgZGVidWdnaW5nXG4gICAgY29uc29sZS5sb2coJ0N1cnJlbnQgZGVuc2l0eSBsZXZlbHM6Jyk7XG4gICAgZGVuc2l0eURhdGEuZm9yRWFjaChsb2NhdGlvbiA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhgJHtsb2NhdGlvbi5sb2NhdGlvbl9uYW1lfTogJHtsb2NhdGlvbi5kZW5zaXR5X2xldmVsfSAoJHtsb2NhdGlvbi5kZW5zaXR5fSlgKTtcbiAgICB9KTtcbiAgICBcbiAgICBpZiAoIXN1cGFiYXNlQWRtaW4pIHtcbiAgICAgIGNvbnNvbGUubG9nKCdTdXBhYmFzZSBhZG1pbiBjbGllbnQgbm90IGF2YWlsYWJsZSwgcmV0dXJuaW5nIGNhbGN1bGF0ZWQgZGF0YSBkaXJlY3RseScpO1xuICAgICAgcmV0dXJuIHsgXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsIFxuICAgICAgICBjb3VudDogZGVuc2l0eURhdGEubGVuZ3RoLCBcbiAgICAgICAgZGF0YTogZGVuc2l0eURhdGEsXG4gICAgICAgIG1lc3NhZ2U6ICdEYXRhYmFzZSBjb25uZWN0aW9uIG5vdCBhdmFpbGFibGUsIHVzaW5nIGNhbGN1bGF0ZWQgZGF0YScgXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICAvLyBDbGVhciBleGlzdGluZyBkYXRhIGFuZCBpbnNlcnQgbmV3IGRhdGFcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coJ0F0dGVtcHRpbmcgdG8gY2xlYXIgZXhpc3RpbmcgZGF0YScpO1xuICAgICAgY29uc3QgeyBlcnJvcjogZGVsZXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgICAgLmZyb20oJ2Nyb3dkX2RlbnNpdHknKVxuICAgICAgICAuZGVsZXRlKClcbiAgICAgICAgLm5lcSgnaWQnLCAwKTsgLy8gRGVsZXRlIGFsbCByZWNvcmRzXG4gICAgICBcbiAgICAgIGlmIChkZWxldGVFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjbGVhcmluZyBleGlzdGluZyBkYXRhOicsIGRlbGV0ZUVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgXG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSwgLy8gU3RpbGwgcmV0dXJuIHN1Y2Nlc3Mgd2l0aCB0aGUgY2FsY3VsYXRlZCBkYXRhXG4gICAgICAgICAgZXJyb3I6IGRlbGV0ZUVycm9yLCBcbiAgICAgICAgICBkYXRhOiBkZW5zaXR5RGF0YSxcbiAgICAgICAgICBjb3VudDogZGVuc2l0eURhdGEubGVuZ3RoLFxuICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gY2xlYXIgZXhpc3RpbmcgZGF0YSwgYnV0IHJldHVybmluZyBjYWxjdWxhdGVkIGRhdGEnXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEluc2VydCBuZXcgZGF0YVxuICAgICAgY29uc29sZS5sb2coJ1ByZXBhcmluZyBkYXRhIGZvciBpbnNlcnRpb24nKTtcbiAgICAgIGNvbnN0IHVwc2VydERhdGEgPSBkZW5zaXR5RGF0YS5tYXAobG9jYXRpb24gPT4gKHtcbiAgICAgICAgbG9jYXRpb25fbmFtZTogbG9jYXRpb24ubG9jYXRpb25fbmFtZSxcbiAgICAgICAgY29vcmRpbmF0ZXM6IGxvY2F0aW9uLmNvb3JkaW5hdGVzLFxuICAgICAgICBkZW5zaXR5X2xldmVsOiBsb2NhdGlvbi5kZW5zaXR5X2xldmVsLFxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIGNyb3dkX3NpemU6IGxvY2F0aW9uLmNyb3dkX3NpemUsXG4gICAgICAgIG9jY3VwYW5jeV9wZXJjZW50YWdlOiBsb2NhdGlvbi5vY2N1cGFuY3lfcGVyY2VudGFnZSxcbiAgICAgICAgbWV0YV9kYXRhOiB7XG4gICAgICAgICAgZGVuc2l0eTogbG9jYXRpb24uZGVuc2l0eSxcbiAgICAgICAgICBjYXBhY2l0eTogbG9jYXRpb24uY2FwYWNpdHksXG4gICAgICAgICAgc2VjdGlvbnM6IGxvY2F0aW9uLnNlY3Rpb25zLFxuICAgICAgICAgIGN1cnJlbnRfdG90YWxfcGlsZ3JpbXM6IGxvY2F0aW9uLm1ldGFfZGF0YS5jdXJyZW50X3RvdGFsX3BpbGdyaW1zXG4gICAgICAgIH1cbiAgICAgIH0pKTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ0F0dGVtcHRpbmcgdG8gaW5zZXJ0IGRhdGEgaW50byBTdXBhYmFzZScpO1xuICAgICAgY29uc3QgeyBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgICAgLmZyb20oJ2Nyb3dkX2RlbnNpdHknKVxuICAgICAgICAuaW5zZXJ0KHVwc2VydERhdGEpO1xuICAgICAgXG4gICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW5zZXJ0aW5nIGNyb3dkIGRlbnNpdHkgZGF0YTonLCBpbnNlcnRFcnJvcik7XG4gICAgICAgIHJldHVybiB7IFxuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsIC8vIFN0aWxsIHJldHVybiBzdWNjZXNzIHdpdGggdGhlIGNhbGN1bGF0ZWQgZGF0YVxuICAgICAgICAgIGVycm9yOiBpbnNlcnRFcnJvciwgXG4gICAgICAgICAgZGF0YTogZGVuc2l0eURhdGEsXG4gICAgICAgICAgY291bnQ6IGRlbnNpdHlEYXRhLmxlbmd0aCxcbiAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGluc2VydCBkYXRhLCBidXQgcmV0dXJuaW5nIGNhbGN1bGF0ZWQgZGF0YSdcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ1N1Y2Nlc3NmdWxseSB1cGRhdGVkIGNyb3dkIGRlbnNpdHkgZGF0YScpO1xuICAgICAgcmV0dXJuIHsgXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsIFxuICAgICAgICBjb3VudDogZGVuc2l0eURhdGEubGVuZ3RoLFxuICAgICAgICBkYXRhOiBkZW5zaXR5RGF0YVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChkYkVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdEYXRhYmFzZSBvcGVyYXRpb24gZXJyb3I6JywgZGJFcnJvcik7XG4gICAgICByZXR1cm4geyBcbiAgICAgICAgc3VjY2VzczogdHJ1ZSwgLy8gU3RpbGwgcmV0dXJuIHN1Y2Nlc3Mgd2l0aCB0aGUgY2FsY3VsYXRlZCBkYXRhXG4gICAgICAgIGVycm9yOiBkYkVycm9yLCBcbiAgICAgICAgZGF0YTogZGVuc2l0eURhdGEsXG4gICAgICAgIGNvdW50OiBkZW5zaXR5RGF0YS5sZW5ndGgsXG4gICAgICAgIG1lc3NhZ2U6ICdEYXRhYmFzZSBlcnJvciwgYnV0IHJldHVybmluZyBjYWxjdWxhdGVkIGRhdGEnXG4gICAgICB9O1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB1cGRhdGVDcm93ZERlbnNpdHlEYXRhOicsIGVycm9yKTtcbiAgICAvLyBUcnkgdG8gcmV0dXJuIGNhbGN1bGF0ZWQgZGF0YSBkaXJlY3RseSBhcyBhIGZhbGxiYWNrXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGRpcmVjdERhdGEgPSBhd2FpdCBjYWxjdWxhdGVSZWFsaXN0aWNDcm93ZERlbnNpdGllcygpO1xuICAgICAgcmV0dXJuIHsgXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsIFxuICAgICAgICBlcnJvciwgXG4gICAgICAgIGRhdGE6IGRpcmVjdERhdGEsXG4gICAgICAgIGNvdW50OiBkaXJlY3REYXRhLmxlbmd0aCxcbiAgICAgICAgbWVzc2FnZTogJ0Vycm9yIG9jY3VycmVkIGJ1dCByZXR1cm5pbmcgZGlyZWN0IGNhbGN1bGF0aW9uJyBcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoY2FsY0Vycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgZXZlbiBkaXJlY3QgY2FsY3VsYXRpb246JywgY2FsY0Vycm9yKTtcbiAgICAgIHJldHVybiB7IGVycm9yOiAnQ29tcGxldGUgY2FsY3VsYXRpb24gZmFpbHVyZScgfTtcbiAgICB9XG4gIH1cbn1cblxuLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGdldCBiYXNlIGNvb3JkaW5hdGVzIGZvciBlYWNoIGxvY2F0aW9uXG5mdW5jdGlvbiBnZXRCYXNlQ29vcmRpbmF0ZXMobG9jYXRpb25OYW1lOiBzdHJpbmcpOiBDb29yZGluYXRlcyB7XG4gIGNvbnN0IGNvb3JkaW5hdGVzTWFwOiBSZWNvcmQ8c3RyaW5nLCBDb29yZGluYXRlcz4gPSB7XG4gICAgJ01hc2ppZCBhbC1IYXJhbSc6IHsgbG5nOiAzOS44MjYxNzQsIGxhdDogMjEuNDIyNDg3IH0sXG4gICAgJ01pbmEnOiB7IGxuZzogMzkuODkyOTY2LCBsYXQ6IDIxLjQxMzI0OSB9LFxuICAgICdKYW1hcmFhdCBCcmlkZ2UnOiB7IGxuZzogMzkuODczNDg1LCBsYXQ6IDIxLjQyMzY1IH0sXG4gICAgJ0FyYWZhdCc6IHsgbG5nOiAzOS45ODQ2ODcsIGxhdDogMjEuMzU1NDYxIH0sXG4gICAgJ011emRhbGlmYWgnOiB7IGxuZzogMzkuOTM2MzIyLCBsYXQ6IDIxLjM4MzA4MiB9LFxuICAgICdNaW5hIEVudHJhbmNlIEdhdGUgMSc6IHsgbG5nOiAzOS44ODcyMzUsIGxhdDogMjEuNDExODU2IH0sXG4gICAgJ1RlbnQgQ2l0eSBTZWN0aW9uIEEnOiB7IGxuZzogMzkuODg5MTI0LCBsYXQ6IDIxLjQxNDUwMSB9LFxuICAgICdKYW1hcmF0IENlbnRyYWwgQWNjZXNzJzogeyBsbmc6IDM5Ljg3MTk1MiwgbGF0OiAyMS40MjM4NTAgfVxuICB9O1xuICBcbiAgcmV0dXJuIGNvb3JkaW5hdGVzTWFwW2xvY2F0aW9uTmFtZV0gfHwgeyBsbmc6IDM5LjgyNjE3NCwgbGF0OiAyMS40MjI0ODcgfTtcbn0gIl0sIm5hbWVzIjpbInN1cGFiYXNlQWRtaW4iLCJUT1RBTF9QSUxHUklNU19NSU4iLCJUT1RBTF9QSUxHUklNU19NQVgiLCJUT1RBTF9QSUxHUklNU19BVkciLCJNYXRoIiwiZmxvb3IiLCJMT0NBVElPTl9TSVpFUyIsImFyZWFJblNxdWFyZU1ldGVycyIsImNhcGFjaXR5Iiwic2VjdGlvbnMiLCJpZCIsIm5hbWUiLCJwZXJjZW50YWdlIiwiVE9UQUxfQ0FQQUNJVFkiLCJPYmplY3QiLCJ2YWx1ZXMiLCJyZWR1Y2UiLCJzdW0iLCJsb2NhdGlvbiIsIkRFTlNJVFlfVEhSRVNIT0xEUyIsImxvdyIsIm1lZGl1bSIsImhpZ2giLCJUSU1FX01PRElGSUVSUyIsImJlZm9yZVByYXllciIsImR1cmluZ1ByYXllciIsImFmdGVyUHJheWVyIiwiamFtYXJhdCIsInRhd2FmIiwic2F5ZWUiLCJuaWdodCIsImVhcmx5TW9ybmluZyIsImhhampEYXkiLCJXRUFUSEVSX01PRElGSUVSUyIsImhvdCIsInJhaW4iLCJwbGVhc2FudCIsImNhbGN1bGF0ZVJlYWxpc3RpY0Nyb3dkRGVuc2l0aWVzIiwibm93IiwiRGF0ZSIsImhvdXIiLCJnZXRIb3VycyIsImxvY2F0aW9ucyIsImtleXMiLCJ0aW1lTW9kaWZpZXIiLCJpbmNsdWRlcyIsImphbWFyYXRfaG91cnMiLCJ0YXdhZl9ob3VycyIsImlzSGFqakRheSIsImdldERheSIsImZvcmNlZEhhampEYXkiLCJnZXRNaW51dGVzIiwid2VhdGhlck1vZGlmaWVyIiwicGlsZ3JpbVZhcmlhdGlvbiIsImN1cnJlbnRUb3RhbFBpbGdyaW1zIiwiZGVuc2l0eURhdGEiLCJtYXAiLCJsb2NhdGlvbk5hbWUiLCJpbmRleCIsImxvY2F0aW9uRGF0YSIsImxvY2F0aW9uVGltZU1vZGlmaWVyIiwiYmFzZU9jY3VwYW5jeVBlcmNlbnRhZ2UiLCJsb2NhdGlvbkNhcGFjaXR5UmF0aW8iLCJiYXNlRXhwZWN0ZWRQaWxncmltcyIsIm1vZGlmaWVkT2NjdXBhbmN5IiwiZmluYWxPY2N1cGFuY3kiLCJyYW5kb20iLCJjcm93ZFNpemUiLCJkZW5zaXR5IiwiZGVuc2l0eUxldmVsIiwic2VjdGlvbkRhdGEiLCJzZWN0aW9uIiwic2VjdGlvblZhcmlhdGlvbiIsInNlY3Rpb25EZW5zaXR5Iiwic2VjdGlvbkRlbnNpdHlMZXZlbCIsInRvRml4ZWQiLCJkZW5zaXR5X2xldmVsIiwiY3Jvd2Rfc2l6ZSIsImJhc2VDb29yZGluYXRlcyIsImdldEJhc2VDb29yZGluYXRlcyIsImNvb3JkaW5hdGVzIiwibG5nIiwibGF0IiwibG9jYXRpb25fbmFtZSIsIm9jY3VwYW5jeV9wZXJjZW50YWdlIiwidGltZXN0YW1wIiwidG9JU09TdHJpbmciLCJtZXRhX2RhdGEiLCJwYXJzZUZsb2F0IiwiY3VycmVudF90b3RhbF9waWxncmltcyIsInRvdGFsQ3Jvd2RTaXplIiwiY29uc29sZSIsImxvZyIsInVwZGF0ZUNyb3dkRGVuc2l0eURhdGEiLCJsZW5ndGgiLCJmb3JFYWNoIiwic3VjY2VzcyIsImNvdW50IiwiZGF0YSIsIm1lc3NhZ2UiLCJlcnJvciIsImRlbGV0ZUVycm9yIiwiZnJvbSIsImRlbGV0ZSIsIm5lcSIsInVwc2VydERhdGEiLCJ1cGRhdGVkX2F0IiwiaW5zZXJ0RXJyb3IiLCJpbnNlcnQiLCJkYkVycm9yIiwiZGlyZWN0RGF0YSIsImNhbGNFcnJvciIsImNvb3JkaW5hdGVzTWFwIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/crowdSensors.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/supabase.ts":
/*!*****************************!*\
  !*** ./src/lib/supabase.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   fetchCrowdDensity: () => (/* binding */ fetchCrowdDensity),\n/* harmony export */   fetchSafetyAlerts: () => (/* binding */ fetchSafetyAlerts),\n/* harmony export */   getOptimalRoute: () => (/* binding */ getOptimalRoute),\n/* harmony export */   subscribeToCrowdDensity: () => (/* binding */ subscribeToCrowdDensity),\n/* harmony export */   supabase: () => (/* binding */ supabase),\n/* harmony export */   supabaseAdmin: () => (/* binding */ supabaseAdmin)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n// Environment variables\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || \"https://example.supabase.co\";\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVvd2ttc3Z0cXJzeWJsb2JzYXp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0Mzc2NTgsImV4cCI6MjA2MTAxMzY1OH0.EBQ3Pn9yvN2L6G5HTe5c10bGOF8xs28jQ-plE1g8HOc\";\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY || \"\";\n// Client for client-side and authenticated requests\n// Ensure we have a valid key\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey);\n// Service role client for server-side operations (only used in server components or API routes)\n// Only create if we have a valid service key\nconst supabaseAdmin = supabaseServiceKey && supabaseServiceKey.length > 0 ? (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseServiceKey, {\n    auth: {\n        autoRefreshToken: false,\n        persistSession: false\n    }\n}) : null;\n// Fetch crowd density data\nasync function fetchCrowdDensity() {\n    const { data, error } = await supabase.from(\"crowd_density\").select(\"*\").order(\"updated_at\", {\n        ascending: false\n    });\n    if (error) {\n        console.error(\"Error fetching crowd density:\", error);\n        return [];\n    }\n    return data;\n}\n// Subscribe to crowd density updates\nfunction subscribeToCrowdDensity(callback) {\n    const subscription = supabase.channel(\"crowd_density_updates\").on(\"postgres_changes\", {\n        event: \"*\",\n        schema: \"public\",\n        table: \"crowd_density\"\n    }, (payload)=>{\n        fetchCrowdDensity().then(callback);\n    }).subscribe();\n    return ()=>{\n        supabase.removeChannel(subscription);\n    };\n}\n// Fetch safety alerts\nasync function fetchSafetyAlerts() {\n    const { data, error } = await supabase.from(\"safety_alerts\").select(\"*\").gt(\"expires_at\", new Date().toISOString()).order(\"severity\", {\n        ascending: false\n    });\n    if (error) {\n        console.error(\"Error fetching safety alerts:\", error);\n        return [];\n    }\n    return data;\n}\n// For demo purposes, mock route calculation\nasync function getOptimalRoute(start, destination) {\n    // In a real app, this would call a serverless function or external API\n    // For the prototype, we'll return mock data\n    return {\n        distance: \"2.3 km\",\n        duration: \"30 minutes\",\n        congestion_level: \"medium\",\n        waypoints: []\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3N1cGFiYXNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBcUQ7QUFFckQsd0JBQXdCO0FBQ3hCLE1BQU1DLGNBQWNDLFFBQVFDLEdBQUcsQ0FBQ0Msd0JBQXdCLElBQUk7QUFDNUQsTUFBTUMsa0JBQWtCSCxRQUFRQyxHQUFHLENBQUNHLDZCQUE2QixJQUFJO0FBQ3JFLE1BQU1DLHFCQUFxQkwsUUFBUUMsR0FBRyxDQUFDSyx5QkFBeUIsSUFBSTtBQUVwRSxvREFBb0Q7QUFDcEQsNkJBQTZCO0FBQ3RCLE1BQU1DLFdBQVdULG1FQUFZQSxDQUFDQyxhQUFhSSxpQkFBaUI7QUFFbkUsZ0dBQWdHO0FBQ2hHLDZDQUE2QztBQUN0QyxNQUFNSyxnQkFBZ0JILHNCQUFzQkEsbUJBQW1CSSxNQUFNLEdBQUcsSUFDM0VYLG1FQUFZQSxDQUFDQyxhQUFhTSxvQkFBb0I7SUFDNUNLLE1BQU07UUFDSkMsa0JBQWtCO1FBQ2xCQyxnQkFBZ0I7SUFDbEI7QUFDRixLQUNBLEtBQUs7QUFvQ1QsMkJBQTJCO0FBQ3BCLGVBQWVDO0lBQ3BCLE1BQU0sRUFBRUMsSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNUixTQUMzQlMsSUFBSSxDQUFDLGlCQUNMQyxNQUFNLENBQUMsS0FDUEMsS0FBSyxDQUFDLGNBQWM7UUFBRUMsV0FBVztJQUFNO0lBRTFDLElBQUlKLE9BQU87UUFDVEssUUFBUUwsS0FBSyxDQUFDLGlDQUFpQ0E7UUFDL0MsT0FBTyxFQUFFO0lBQ1g7SUFDQSxPQUFPRDtBQUNUO0FBRUEscUNBQXFDO0FBQzlCLFNBQVNPLHdCQUF3QkMsUUFBd0M7SUFDOUUsTUFBTUMsZUFBZWhCLFNBQ2xCaUIsT0FBTyxDQUFDLHlCQUNSQyxFQUFFLENBQ0Qsb0JBQ0E7UUFBRUMsT0FBTztRQUFLQyxRQUFRO1FBQVVDLE9BQU87SUFBZ0IsR0FDdkQsQ0FBQ0M7UUFDQ2hCLG9CQUFvQmlCLElBQUksQ0FBQ1I7SUFDM0IsR0FFRFMsU0FBUztJQUVaLE9BQU87UUFDTHhCLFNBQVN5QixhQUFhLENBQUNUO0lBQ3pCO0FBQ0Y7QUFFQSxzQkFBc0I7QUFDZixlQUFlVTtJQUNwQixNQUFNLEVBQUVuQixJQUFJLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1SLFNBQzNCUyxJQUFJLENBQUMsaUJBQ0xDLE1BQU0sQ0FBQyxLQUNQaUIsRUFBRSxDQUFDLGNBQWMsSUFBSUMsT0FBT0MsV0FBVyxJQUN2Q2xCLEtBQUssQ0FBQyxZQUFZO1FBQUVDLFdBQVc7SUFBTTtJQUV4QyxJQUFJSixPQUFPO1FBQ1RLLFFBQVFMLEtBQUssQ0FBQyxpQ0FBaUNBO1FBQy9DLE9BQU8sRUFBRTtJQUNYO0lBQ0EsT0FBT0Q7QUFDVDtBQUVBLDRDQUE0QztBQUNyQyxlQUFldUIsZ0JBQWdCQyxLQUFhLEVBQUVDLFdBQW1CO0lBQ3RFLHVFQUF1RTtJQUN2RSw0Q0FBNEM7SUFDNUMsT0FBTztRQUNMQyxVQUFVO1FBQ1ZDLFVBQVU7UUFDVkMsa0JBQWtCO1FBQ2xCQyxXQUFXLEVBRVY7SUFDSDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaGFqai1uYXZpZ2F0b3IvLi9zcmMvbGliL3N1cGFiYXNlLnRzPzA2ZTEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcblxuLy8gRW52aXJvbm1lbnQgdmFyaWFibGVzXG5jb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCB8fCAnaHR0cHM6Ly9leGFtcGxlLnN1cGFiYXNlLmNvJztcbmNvbnN0IHN1cGFiYXNlQW5vbktleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIHx8ICdleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKcGMzTWlPaUp6ZFhCaFltRnpaU0lzSW5KbFppSTZJblZ2ZDJ0dGMzWjBjWEp6ZVdKc2IySnpZWHAzSWl3aWNtOXNaU0k2SW1GdWIyNGlMQ0pwWVhRaU9qRTNORFUwTXpjMk5UZ3NJbVY0Y0NJNk1qQTJNVEF4TXpZMU9IMC5FQlEzUG45eXZOMkw2RzVIVGU1YzEwYkdPRjh4czI4alEtcGxFMWc4SE9jJztcbmNvbnN0IHN1cGFiYXNlU2VydmljZUtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkgfHwgJyc7XG5cbi8vIENsaWVudCBmb3IgY2xpZW50LXNpZGUgYW5kIGF1dGhlbnRpY2F0ZWQgcmVxdWVzdHNcbi8vIEVuc3VyZSB3ZSBoYXZlIGEgdmFsaWQga2V5XG5leHBvcnQgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSk7XG5cbi8vIFNlcnZpY2Ugcm9sZSBjbGllbnQgZm9yIHNlcnZlci1zaWRlIG9wZXJhdGlvbnMgKG9ubHkgdXNlZCBpbiBzZXJ2ZXIgY29tcG9uZW50cyBvciBBUEkgcm91dGVzKVxuLy8gT25seSBjcmVhdGUgaWYgd2UgaGF2ZSBhIHZhbGlkIHNlcnZpY2Uga2V5XG5leHBvcnQgY29uc3Qgc3VwYWJhc2VBZG1pbiA9IHN1cGFiYXNlU2VydmljZUtleSAmJiBzdXBhYmFzZVNlcnZpY2VLZXkubGVuZ3RoID4gMFxuICA/IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VTZXJ2aWNlS2V5LCB7XG4gICAgICBhdXRoOiB7XG4gICAgICAgIGF1dG9SZWZyZXNoVG9rZW46IGZhbHNlLFxuICAgICAgICBwZXJzaXN0U2Vzc2lvbjogZmFsc2VcbiAgICAgIH1cbiAgICB9KVxuICA6IG51bGw7XG5cbi8vIFR5cGVzIGZvciBvdXIgZGF0YWJhc2VcbmV4cG9ydCB0eXBlIENyb3dkRGVuc2l0eSA9IHtcbiAgaWQ6IG51bWJlcjtcbiAgbG9jYXRpb25fbmFtZTogc3RyaW5nO1xuICBjb29yZGluYXRlczogeyBsbmc6IG51bWJlcjsgbGF0OiBudW1iZXIgfTtcbiAgZGVuc2l0eV9sZXZlbDogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJyB8ICdjcml0aWNhbCc7XG4gIHVwZGF0ZWRfYXQ6IHN0cmluZztcbiAgLy8gTmV3IGZpZWxkcyBmb3IgcmVhbGlzdGljIGNyb3dkIGRlbnNpdHlcbiAgY3Jvd2Rfc2l6ZT86IG51bWJlcjtcbiAgb2NjdXBhbmN5X3BlcmNlbnRhZ2U/OiBzdHJpbmc7XG4gIG1ldGFfZGF0YT86IHtcbiAgICBkZW5zaXR5OiBzdHJpbmc7XG4gICAgY2FwYWNpdHk6IG51bWJlcjtcbiAgICBzZWN0aW9uczogQXJyYXk8e1xuICAgICAgaWQ6IHN0cmluZztcbiAgICAgIG5hbWU6IHN0cmluZztcbiAgICAgIGRlbnNpdHk6IHN0cmluZztcbiAgICAgIGRlbnNpdHlfbGV2ZWw6ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCcgfCAnY3JpdGljYWwnO1xuICAgICAgY3Jvd2Rfc2l6ZTogbnVtYmVyO1xuICAgIH0+O1xuICB9O1xufTtcblxuZXhwb3J0IHR5cGUgU2FmZXR5QWxlcnQgPSB7XG4gIGlkOiBudW1iZXI7XG4gIHRpdGxlOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIGxvY2F0aW9uX25hbWU6IHN0cmluZztcbiAgY29vcmRpbmF0ZXM6IHsgbG5nOiBudW1iZXI7IGxhdDogbnVtYmVyIH07XG4gIHNldmVyaXR5OiAnaW5mbycgfCAnd2FybmluZycgfCAnZGFuZ2VyJztcbiAgY3JlYXRlZF9hdDogc3RyaW5nO1xuICBleHBpcmVzX2F0OiBzdHJpbmc7XG59O1xuXG4vLyBGZXRjaCBjcm93ZCBkZW5zaXR5IGRhdGFcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmZXRjaENyb3dkRGVuc2l0eSgpIHtcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbSgnY3Jvd2RfZGVuc2l0eScpXG4gICAgLnNlbGVjdCgnKicpXG4gICAgLm9yZGVyKCd1cGRhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xuXG4gIGlmIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGNyb3dkIGRlbnNpdHk6JywgZXJyb3IpO1xuICAgIHJldHVybiBbXTtcbiAgfVxuICByZXR1cm4gZGF0YSBhcyBDcm93ZERlbnNpdHlbXTtcbn1cblxuLy8gU3Vic2NyaWJlIHRvIGNyb3dkIGRlbnNpdHkgdXBkYXRlc1xuZXhwb3J0IGZ1bmN0aW9uIHN1YnNjcmliZVRvQ3Jvd2REZW5zaXR5KGNhbGxiYWNrOiAoZGF0YTogQ3Jvd2REZW5zaXR5W10pID0+IHZvaWQpIHtcbiAgY29uc3Qgc3Vic2NyaXB0aW9uID0gc3VwYWJhc2VcbiAgICAuY2hhbm5lbCgnY3Jvd2RfZGVuc2l0eV91cGRhdGVzJylcbiAgICAub24oXG4gICAgICAncG9zdGdyZXNfY2hhbmdlcycsXG4gICAgICB7IGV2ZW50OiAnKicsIHNjaGVtYTogJ3B1YmxpYycsIHRhYmxlOiAnY3Jvd2RfZGVuc2l0eScgfSxcbiAgICAgIChwYXlsb2FkKSA9PiB7XG4gICAgICAgIGZldGNoQ3Jvd2REZW5zaXR5KCkudGhlbihjYWxsYmFjayk7XG4gICAgICB9XG4gICAgKVxuICAgIC5zdWJzY3JpYmUoKTtcblxuICByZXR1cm4gKCkgPT4ge1xuICAgIHN1cGFiYXNlLnJlbW92ZUNoYW5uZWwoc3Vic2NyaXB0aW9uKTtcbiAgfTtcbn1cblxuLy8gRmV0Y2ggc2FmZXR5IGFsZXJ0c1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZldGNoU2FmZXR5QWxlcnRzKCkge1xuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCdzYWZldHlfYWxlcnRzJylcbiAgICAuc2VsZWN0KCcqJylcbiAgICAuZ3QoJ2V4cGlyZXNfYXQnLCBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkpXG4gICAgLm9yZGVyKCdzZXZlcml0eScsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcblxuICBpZiAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBzYWZldHkgYWxlcnRzOicsIGVycm9yKTtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgcmV0dXJuIGRhdGEgYXMgU2FmZXR5QWxlcnRbXTtcbn1cblxuLy8gRm9yIGRlbW8gcHVycG9zZXMsIG1vY2sgcm91dGUgY2FsY3VsYXRpb25cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRPcHRpbWFsUm91dGUoc3RhcnQ6IHN0cmluZywgZGVzdGluYXRpb246IHN0cmluZykge1xuICAvLyBJbiBhIHJlYWwgYXBwLCB0aGlzIHdvdWxkIGNhbGwgYSBzZXJ2ZXJsZXNzIGZ1bmN0aW9uIG9yIGV4dGVybmFsIEFQSVxuICAvLyBGb3IgdGhlIHByb3RvdHlwZSwgd2UnbGwgcmV0dXJuIG1vY2sgZGF0YVxuICByZXR1cm4ge1xuICAgIGRpc3RhbmNlOiAnMi4zIGttJyxcbiAgICBkdXJhdGlvbjogJzMwIG1pbnV0ZXMnLFxuICAgIGNvbmdlc3Rpb25fbGV2ZWw6ICdtZWRpdW0nLFxuICAgIHdheXBvaW50czogW1xuICAgICAgLy8gU2ltcGxpZmllZCByb3V0ZSBjb29yZGluYXRlcyB3b3VsZCBnbyBoZXJlXG4gICAgXVxuICB9O1xufSAiXSwibmFtZXMiOlsiY3JlYXRlQ2xpZW50Iiwic3VwYWJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwic3VwYWJhc2VBbm9uS2V5IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJzdXBhYmFzZVNlcnZpY2VLZXkiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwic3VwYWJhc2UiLCJzdXBhYmFzZUFkbWluIiwibGVuZ3RoIiwiYXV0aCIsImF1dG9SZWZyZXNoVG9rZW4iLCJwZXJzaXN0U2Vzc2lvbiIsImZldGNoQ3Jvd2REZW5zaXR5IiwiZGF0YSIsImVycm9yIiwiZnJvbSIsInNlbGVjdCIsIm9yZGVyIiwiYXNjZW5kaW5nIiwiY29uc29sZSIsInN1YnNjcmliZVRvQ3Jvd2REZW5zaXR5IiwiY2FsbGJhY2siLCJzdWJzY3JpcHRpb24iLCJjaGFubmVsIiwib24iLCJldmVudCIsInNjaGVtYSIsInRhYmxlIiwicGF5bG9hZCIsInRoZW4iLCJzdWJzY3JpYmUiLCJyZW1vdmVDaGFubmVsIiwiZmV0Y2hTYWZldHlBbGVydHMiLCJndCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImdldE9wdGltYWxSb3V0ZSIsInN0YXJ0IiwiZGVzdGluYXRpb24iLCJkaXN0YW5jZSIsImR1cmF0aW9uIiwiY29uZ2VzdGlvbl9sZXZlbCIsIndheXBvaW50cyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/supabase.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/next","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcrowd-density%2Froute&page=%2Fapi%2Fcrowd-density%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcrowd-density%2Froute.ts&appDir=C%3A%5CUsers%5Calghm%5COneDrive%5CDesktop%5CGitHub%5Ctafweej_Hajj%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Calghm%5COneDrive%5CDesktop%5CGitHub%5Ctafweej_Hajj&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();