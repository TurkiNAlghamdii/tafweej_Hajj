"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/routes/route";
exports.ids = ["app/api/routes/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Froutes%2Froute&page=%2Fapi%2Froutes%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Froutes%2Froute.ts&appDir=C%3A%5CUsers%5Calghm%5COneDrive%5CDesktop%5CGitHub%5Ctafweej_Hajj%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Calghm%5COneDrive%5CDesktop%5CGitHub%5Ctafweej_Hajj&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Froutes%2Froute&page=%2Fapi%2Froutes%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Froutes%2Froute.ts&appDir=C%3A%5CUsers%5Calghm%5COneDrive%5CDesktop%5CGitHub%5Ctafweej_Hajj%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Calghm%5COneDrive%5CDesktop%5CGitHub%5Ctafweej_Hajj&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_alghm_OneDrive_Desktop_GitHub_tafweej_Hajj_src_app_api_routes_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/routes/route.ts */ \"(rsc)/./src/app/api/routes/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/routes/route\",\n        pathname: \"/api/routes\",\n        filename: \"route\",\n        bundlePath: \"app/api/routes/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\alghm\\\\OneDrive\\\\Desktop\\\\GitHub\\\\tafweej_Hajj\\\\src\\\\app\\\\api\\\\routes\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_alghm_OneDrive_Desktop_GitHub_tafweej_Hajj_src_app_api_routes_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/routes/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZyb3V0ZXMlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnJvdXRlcyUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnJvdXRlcyUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNhbGdobSU1Q09uZURyaXZlJTVDRGVza3RvcCU1Q0dpdEh1YiU1Q3RhZndlZWpfSGFqaiU1Q3NyYyU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q1VzZXJzJTVDYWxnaG0lNUNPbmVEcml2ZSU1Q0Rlc2t0b3AlNUNHaXRIdWIlNUN0YWZ3ZWVqX0hhamomaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQzBDO0FBQ3ZIO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaGFqai1uYXZpZ2F0b3IvPzRiMGUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcYWxnaG1cXFxcT25lRHJpdmVcXFxcRGVza3RvcFxcXFxHaXRIdWJcXFxcdGFmd2Vlal9IYWpqXFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXHJvdXRlc1xcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvcm91dGVzL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvcm91dGVzXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9yb3V0ZXMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxhbGdobVxcXFxPbmVEcml2ZVxcXFxEZXNrdG9wXFxcXEdpdEh1YlxcXFx0YWZ3ZWVqX0hhampcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxccm91dGVzXFxcXHJvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9yb3V0ZXMvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Froutes%2Froute&page=%2Fapi%2Froutes%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Froutes%2Froute.ts&appDir=C%3A%5CUsers%5Calghm%5COneDrive%5CDesktop%5CGitHub%5Ctafweej_Hajj%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Calghm%5COneDrive%5CDesktop%5CGitHub%5Ctafweej_Hajj&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/routes/route.ts":
/*!*************************************!*\
  !*** ./src/app/api/routes/route.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_supabase__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/supabase */ \"(rsc)/./src/lib/supabase.ts\");\n/* harmony import */ var _lib_crowdSensors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/crowdSensors */ \"(rsc)/./src/lib/crowdSensors.ts\");\n\n\n\n// Simple graph representing distances between locations (in km)\nconst DISTANCE_GRAPH = {\n    \"Masjid al-Haram\": {\n        \"Mina\": 6.2,\n        \"Arafat\": 20.5,\n        \"Muzdalifah\": 12.8,\n        \"Jamaraat Bridge\": 7.1\n    },\n    \"Mina\": {\n        \"Masjid al-Haram\": 6.2,\n        \"Arafat\": 14.3,\n        \"Muzdalifah\": 3.5,\n        \"Jamaraat Bridge\": 1.8\n    },\n    \"Arafat\": {\n        \"Masjid al-Haram\": 20.5,\n        \"Mina\": 14.3,\n        \"Muzdalifah\": 8.2,\n        \"Jamaraat Bridge\": 16.1\n    },\n    \"Muzdalifah\": {\n        \"Masjid al-Haram\": 12.8,\n        \"Mina\": 3.5,\n        \"Arafat\": 8.2,\n        \"Jamaraat Bridge\": 5.3\n    },\n    \"Jamaraat Bridge\": {\n        \"Masjid al-Haram\": 7.1,\n        \"Mina\": 1.8,\n        \"Arafat\": 16.1,\n        \"Muzdalifah\": 5.3\n    }\n};\n// Average walking speed in km/h, will be adjusted based on crowd density\nconst AVG_WALKING_SPEED = 4;\n// Calculate route considering crowd density\nasync function calculateRouteWithCrowdDensity(start, destination) {\n    // Get the crowd density data\n    let crowdData;\n    try {\n        // Try to get crowd density from the database\n        if (_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin) {\n            const { data, error } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"crowd_density\").select(\"*\");\n            if (!error && data && data.length > 0) {\n                crowdData = data;\n            } else {\n                // If database access fails, calculate it directly\n                crowdData = await (0,_lib_crowdSensors__WEBPACK_IMPORTED_MODULE_2__.calculateRealisticCrowdDensities)();\n            }\n        } else {\n            // If no database access, calculate it directly\n            crowdData = await (0,_lib_crowdSensors__WEBPACK_IMPORTED_MODULE_2__.calculateRealisticCrowdDensities)();\n        }\n    } catch (error) {\n        console.error(\"Error getting crowd density for route calculation:\", error);\n        // Fallback to calculating it directly\n        crowdData = await (0,_lib_crowdSensors__WEBPACK_IMPORTED_MODULE_2__.calculateRealisticCrowdDensities)();\n    }\n    // Create a map of location to its crowd density\n    const densityMap = new Map();\n    crowdData.forEach((item)=>{\n        densityMap.set(item.location_name, item.density_level);\n    });\n    // Calculate direct distance between start and destination\n    const directDistance = DISTANCE_GRAPH[start]?.[destination] || 0;\n    // If no direct path exists, return an error\n    if (directDistance === 0) {\n        throw new Error(\"No direct route available between these locations\");\n    }\n    // Get the actual density levels from the crowd data\n    const startDensity = densityMap.get(start) || \"low\";\n    const destDensity = densityMap.get(destination) || \"low\";\n    console.log(`Route calculation: ${start} (${startDensity}) to ${destination} (${destDensity})`);\n    // Find all locations on the path (we'll use all available locations)\n    // This is enhanced to consider alternate paths through different locations\n    const allLocations = Object.keys(DISTANCE_GRAPH);\n    // Create a graph where edge weights are affected by crowd density\n    const weightedGraph = {};\n    // Density penalty multipliers - more crowded = higher weight\n    // Adjusted for the 250,000-350,000 pilgrim count range\n    const densityPenalty = {\n        \"low\": 1.0,\n        \"medium\": 1.8,\n        \"high\": 3.0,\n        \"critical\": 5.0\n    };\n    // Build a weighted graph based on crowd density\n    allLocations.forEach((fromLoc)=>{\n        weightedGraph[fromLoc] = {};\n        Object.entries(DISTANCE_GRAPH[fromLoc] || {}).forEach(([toLoc, distance])=>{\n            const toDensity = densityMap.get(toLoc) || \"low\";\n            // Weight is distance * density penalty\n            weightedGraph[fromLoc][toLoc] = distance * densityPenalty[toDensity];\n        });\n    });\n    // Dijkstra's algorithm to find shortest (least crowded) path\n    const findBestPath = (graph, startNode, endNode)=>{\n        // Initialize distances and visited nodes\n        const distances = {};\n        const previous = {};\n        const visited = new Set();\n        const nodes = Object.keys(graph);\n        // Set initial distances to infinity except for start node\n        nodes.forEach((node)=>{\n            distances[node] = Infinity;\n            previous[node] = null;\n        });\n        distances[startNode] = 0;\n        // Find node with smallest distance\n        const findSmallestDistanceNode = ()=>{\n            let smallest = Infinity;\n            let smallestNode = null;\n            for (const node of nodes){\n                if (!visited.has(node) && distances[node] < smallest) {\n                    smallest = distances[node];\n                    smallestNode = node;\n                }\n            }\n            return smallestNode;\n        };\n        // Main algorithm\n        let currentNode = findSmallestDistanceNode();\n        while(currentNode){\n            const distance = distances[currentNode];\n            const neighbors = graph[currentNode];\n            for(const neighbor in neighbors){\n                const newDistance = distance + neighbors[neighbor];\n                if (newDistance < distances[neighbor]) {\n                    distances[neighbor] = newDistance;\n                    previous[neighbor] = currentNode;\n                }\n            }\n            visited.add(currentNode);\n            currentNode = findSmallestDistanceNode();\n        }\n        // Build path from results\n        const path = [];\n        let current = endNode;\n        while(current){\n            path.unshift(current);\n            current = previous[current];\n        }\n        return path.length > 1 ? path : []; // Return empty if no path found\n    };\n    // Find best path considering crowd density\n    const pathNodes = findBestPath(weightedGraph, start, destination);\n    console.log(\"Calculated path through nodes:\", pathNodes);\n    // If no path found, just use direct route\n    if (pathNodes.length <= 1) {\n        console.log(\"No optimal path found, using direct route\");\n        pathNodes.splice(0, pathNodes.length, start, destination);\n    }\n    // Get the actual crowd density levels along our path\n    const locationsOnPath = pathNodes;\n    // Determine worst congestion level on the route\n    const densityLevels = [\n        \"low\",\n        \"medium\",\n        \"high\",\n        \"critical\"\n    ];\n    const densityValues = locationsOnPath.map((loc)=>{\n        const level = densityMap.get(loc) || \"low\";\n        return densityLevels.indexOf(level);\n    });\n    // Take the maximum density value (worst congestion)\n    const maxDensityValue = Math.max(...densityValues);\n    const routeCongestion = densityLevels[maxDensityValue];\n    console.log(`Route congestion determined to be: ${routeCongestion}`);\n    // Adjust walking speed based on crowd density\n    // Updated speeds for the pilgrim range of 250,000-350,000\n    let speedMultiplier = 1.0;\n    switch(routeCongestion){\n        case \"low\":\n            speedMultiplier = 1.0;\n            break;\n        case \"medium\":\n            speedMultiplier = 0.7;\n            break;\n        case \"high\":\n            speedMultiplier = 0.5;\n            break;\n        case \"critical\":\n            speedMultiplier = 0.3;\n            break;\n        default:\n            speedMultiplier = 1.0;\n    }\n    // Calculate total distance along path\n    let totalDistance = 0;\n    for(let i = 0; i < pathNodes.length - 1; i++){\n        const from = pathNodes[i];\n        const to = pathNodes[i + 1];\n        totalDistance += DISTANCE_GRAPH[from]?.[to] || 0;\n    }\n    const adjustedSpeed = AVG_WALKING_SPEED * speedMultiplier;\n    // Calculate duration (in minutes)\n    const durationHours = totalDistance / adjustedSpeed;\n    const durationMinutes = Math.ceil(durationHours * 60);\n    // Generate directions based on crowd density\n    const directions = [];\n    directions.push(`Start at ${start}`);\n    // Add warnings based on actual crowd density\n    const congestedLocations = locationsOnPath.filter((loc)=>{\n        const level = densityMap.get(loc) || \"low\";\n        return level === \"high\" || level === \"critical\";\n    });\n    if (congestedLocations.length > 0) {\n        if (congestedLocations.includes(start) && densityMap.get(start) === \"critical\") {\n            directions.push(`⚠️ Warning: Extremely high crowd density at your starting point (${start})`);\n        } else if (congestedLocations.includes(destination) && densityMap.get(destination) === \"critical\") {\n            directions.push(`⚠️ Warning: Extremely high crowd density at your destination (${destination})`);\n        } else if (routeCongestion === \"critical\") {\n            directions.push(`⚠️ Warning: Extremely high crowd density on this route`);\n        } else {\n            directions.push(`⚠️ Warning: High crowd density detected on this route`);\n        }\n        directions.push(`We've calculated a route that avoids the most crowded areas where possible`);\n        directions.push(`Consider traveling during off-peak hours if possible`);\n    } else {\n        directions.push(`This route avoids high crowd density areas`);\n    }\n    // Add directions for intermediate locations if any\n    for(let i = 0; i < pathNodes.length - 1; i++){\n        const currentLoc = pathNodes[i];\n        const nextLoc = pathNodes[i + 1];\n        const distance = DISTANCE_GRAPH[currentLoc]?.[nextLoc] || 0;\n        const locDensity = densityMap.get(nextLoc) || \"low\";\n        if (i > 0) {\n            directions.push(`Continue to ${nextLoc} (${locDensity} crowd density) - ${distance.toFixed(1)} km`);\n        }\n    }\n    // Add specific directions based on locations and their actual congestion with street names\n    if (pathNodes.length === 2) {\n        if (start === \"Mina\" && destination === \"Jamaraat Bridge\") {\n            directions.push(`Head southwest on Tariq Al-Jaysh Street for 0.5 km`);\n            directions.push(`Turn right onto Al-Jamarat Road and continue for 1.0 km`);\n            directions.push(`Follow the designated pathway along Al-Jamarat Road following the crowd management barriers`);\n            if (densityMap.get(\"Jamaraat Bridge\") === \"high\" || densityMap.get(\"Jamaraat Bridge\") === \"critical\") {\n                directions.push(`At the Jamarat Complex, follow signs for your camp's designated time slot entrance`);\n                directions.push(`Use the Jamarat Bridge Eastern Entrance to avoid the most congested areas`);\n            } else {\n                directions.push(`Continue on Al-Jamarat Road until you reach the Jamarat Complex`);\n            }\n        } else if (start === \"Masjid al-Haram\" && destination === \"Mina\") {\n            directions.push(`Exit Masjid al-Haram through the King Fahd expansion gate (Gate 79)`);\n            directions.push(`Head east on Ibrahim Al Khalil Road for 1.2 km`);\n            directions.push(`Continue onto Makkah-Mina Road for 4.5 km`);\n            if (densityMap.get(\"Masjid al-Haram\") === \"high\" || densityMap.get(\"Masjid al-Haram\") === \"critical\") {\n                directions.push(`Take the covered walkway path on Pedestrian Route 5`);\n                directions.push(`Keep right at the Al-Muaisem junction to avoid heavier crowds`);\n                directions.push(`Follow Mina Street 204 to enter the Mina Valley`);\n            } else {\n                directions.push(`Follow the main pedestrian path along Makkah-Mina Road`);\n                directions.push(`Enter Mina via Street 206`);\n            }\n        } else if (start === \"Masjid al-Haram\" && destination === \"Arafat\") {\n            directions.push(`Exit Masjid al-Haram through the Ajyad Gate (Gate 5)`);\n            directions.push(`Head southeast on Al-Haram Road for 1.5 km`);\n            directions.push(`Continue onto Makkah-Arafat Highway for 14 km`);\n            directions.push(`Follow signs for Arafat Plain on Route 15`);\n            directions.push(`Enter Arafat via Northern Entrance Road`);\n        } else if (start === \"Arafat\" && destination === \"Muzdalifah\") {\n            directions.push(`Exit Arafat via the Western Exit Road`);\n            directions.push(`Head west on Arafat-Muzdalifah Road for 6 km`);\n            directions.push(`Follow the pedestrian pathways marked in green`);\n            directions.push(`Continue straight onto Muzdalifah Valley Road`);\n        } else if (start === \"Muzdalifah\" && destination === \"Mina\") {\n            directions.push(`Head northwest on Muzdalifah Valley Road`);\n            directions.push(`Continue onto Muzdalifah-Mina Connection Road for 2.5 km`);\n            directions.push(`Follow the pedestrian routes marked with yellow signs`);\n            directions.push(`Enter Mina through the Southern Entrance`);\n        } else if (start === \"Jamaraat Bridge\" && destination === \"Masjid al-Haram\") {\n            directions.push(`Exit the Jamarat Complex via the Western Exit`);\n            directions.push(`Head southwest on Al-Jamarat Road for 0.8 km`);\n            directions.push(`Continue onto Mina-Makkah Pedestrian Way for 5 km`);\n            directions.push(`Follow Ibrahim Al-Khalil Road to reach Masjid al-Haram`);\n        } else {\n            // Default directions for any other combination\n            directions.push(`Head toward ${destination} following the main pilgrimage route`);\n            directions.push(`Follow the official signage and crowd management directions`);\n        }\n    }\n    directions.push(`Arrive at ${destination}`);\n    // Additional advice for high congestion routes based on actual data\n    if (routeCongestion === \"high\" || routeCongestion === \"critical\") {\n        directions.push(`Stay hydrated and follow crowd management officials' instructions`);\n        directions.push(`Keep your group together and follow the designated walking paths`);\n    }\n    return {\n        start,\n        destination,\n        distance: `${totalDistance.toFixed(1)} km`,\n        duration: `${durationMinutes} minutes`,\n        congestion_level: routeCongestion,\n        directions,\n        via: pathNodes.length > 2 ? pathNodes.slice(1, -1) : [],\n        pilgrim_count_range: \"250,000-350,000\",\n        adjusted_walking_speed: `${adjustedSpeed.toFixed(1)} km/h`,\n        crowd_impact: speedMultiplier < 0.8 ? \"significant\" : \"moderate\"\n    };\n}\n// GET handler to calculate route between two points\nasync function GET(request) {\n    // Return error if supabaseAdmin is not available\n    if (!_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin) {\n        console.warn(\"Service role key not configured, some features may be limited\");\n    }\n    try {\n        // Get parameters from URL\n        const { searchParams } = new URL(request.url);\n        const start = searchParams.get(\"start\");\n        const destination = searchParams.get(\"destination\");\n        if (!start || !destination) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Missing start or destination parameter\"\n            }, {\n                status: 400\n            });\n        }\n        const routeData = await calculateRouteWithCrowdDensity(start, destination);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(routeData);\n    } catch (error) {\n        console.error(\"Error calculating route:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: error instanceof Error ? error.message : \"Error calculating route\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFLLENBQUMsNEJBQTRCQTtRQUMxQyxPQUFPVixxREFBWUEsQ0FBQ3dHLElBQUksQ0FDdEI7WUFBRTlGLE9BQU9BLGlCQUFpQmEsUUFBUWIsTUFBTWlHLE9BQU8sR0FBRztRQUEwQixHQUM1RTtZQUFFRixRQUFRO1FBQUk7SUFFbEI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2hhamotbmF2aWdhdG9yLy4vc3JjL2FwcC9hcGkvcm91dGVzL3JvdXRlLnRzPzc2ZWIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgc3VwYWJhc2VBZG1pbiB9IGZyb20gJ0AvbGliL3N1cGFiYXNlJztcbmltcG9ydCB7IGNhbGN1bGF0ZVJlYWxpc3RpY0Nyb3dkRGVuc2l0aWVzIH0gZnJvbSAnQC9saWIvY3Jvd2RTZW5zb3JzJztcblxuLy8gU2ltcGxlIGdyYXBoIHJlcHJlc2VudGluZyBkaXN0YW5jZXMgYmV0d2VlbiBsb2NhdGlvbnMgKGluIGttKVxuY29uc3QgRElTVEFOQ0VfR1JBUEg6IFJlY29yZDxzdHJpbmcsIFJlY29yZDxzdHJpbmcsIG51bWJlcj4+ID0ge1xuICAnTWFzamlkIGFsLUhhcmFtJzoge1xuICAgICdNaW5hJzogNi4yLFxuICAgICdBcmFmYXQnOiAyMC41LFxuICAgICdNdXpkYWxpZmFoJzogMTIuOCxcbiAgICAnSmFtYXJhYXQgQnJpZGdlJzogNy4xXG4gIH0sXG4gICdNaW5hJzoge1xuICAgICdNYXNqaWQgYWwtSGFyYW0nOiA2LjIsXG4gICAgJ0FyYWZhdCc6IDE0LjMsXG4gICAgJ011emRhbGlmYWgnOiAzLjUsXG4gICAgJ0phbWFyYWF0IEJyaWRnZSc6IDEuOFxuICB9LFxuICAnQXJhZmF0Jzoge1xuICAgICdNYXNqaWQgYWwtSGFyYW0nOiAyMC41LFxuICAgICdNaW5hJzogMTQuMyxcbiAgICAnTXV6ZGFsaWZhaCc6IDguMixcbiAgICAnSmFtYXJhYXQgQnJpZGdlJzogMTYuMVxuICB9LFxuICAnTXV6ZGFsaWZhaCc6IHtcbiAgICAnTWFzamlkIGFsLUhhcmFtJzogMTIuOCxcbiAgICAnTWluYSc6IDMuNSxcbiAgICAnQXJhZmF0JzogOC4yLFxuICAgICdKYW1hcmFhdCBCcmlkZ2UnOiA1LjNcbiAgfSxcbiAgJ0phbWFyYWF0IEJyaWRnZSc6IHtcbiAgICAnTWFzamlkIGFsLUhhcmFtJzogNy4xLFxuICAgICdNaW5hJzogMS44LFxuICAgICdBcmFmYXQnOiAxNi4xLFxuICAgICdNdXpkYWxpZmFoJzogNS4zXG4gIH1cbn07XG5cbi8vIEF2ZXJhZ2Ugd2Fsa2luZyBzcGVlZCBpbiBrbS9oLCB3aWxsIGJlIGFkanVzdGVkIGJhc2VkIG9uIGNyb3dkIGRlbnNpdHlcbmNvbnN0IEFWR19XQUxLSU5HX1NQRUVEID0gNDtcblxuLy8gQ2FsY3VsYXRlIHJvdXRlIGNvbnNpZGVyaW5nIGNyb3dkIGRlbnNpdHlcbmFzeW5jIGZ1bmN0aW9uIGNhbGN1bGF0ZVJvdXRlV2l0aENyb3dkRGVuc2l0eShzdGFydDogc3RyaW5nLCBkZXN0aW5hdGlvbjogc3RyaW5nKSB7XG4gIC8vIEdldCB0aGUgY3Jvd2QgZGVuc2l0eSBkYXRhXG4gIGxldCBjcm93ZERhdGE7XG4gIFxuICB0cnkge1xuICAgIC8vIFRyeSB0byBnZXQgY3Jvd2QgZGVuc2l0eSBmcm9tIHRoZSBkYXRhYmFzZVxuICAgIGlmIChzdXBhYmFzZUFkbWluKSB7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAgIC5mcm9tKCdjcm93ZF9kZW5zaXR5JylcbiAgICAgICAgLnNlbGVjdCgnKicpO1xuICAgICAgXG4gICAgICBpZiAoIWVycm9yICYmIGRhdGEgJiYgZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNyb3dkRGF0YSA9IGRhdGE7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBJZiBkYXRhYmFzZSBhY2Nlc3MgZmFpbHMsIGNhbGN1bGF0ZSBpdCBkaXJlY3RseVxuICAgICAgICBjcm93ZERhdGEgPSBhd2FpdCBjYWxjdWxhdGVSZWFsaXN0aWNDcm93ZERlbnNpdGllcygpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBJZiBubyBkYXRhYmFzZSBhY2Nlc3MsIGNhbGN1bGF0ZSBpdCBkaXJlY3RseVxuICAgICAgY3Jvd2REYXRhID0gYXdhaXQgY2FsY3VsYXRlUmVhbGlzdGljQ3Jvd2REZW5zaXRpZXMoKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyBjcm93ZCBkZW5zaXR5IGZvciByb3V0ZSBjYWxjdWxhdGlvbjonLCBlcnJvcik7XG4gICAgLy8gRmFsbGJhY2sgdG8gY2FsY3VsYXRpbmcgaXQgZGlyZWN0bHlcbiAgICBjcm93ZERhdGEgPSBhd2FpdCBjYWxjdWxhdGVSZWFsaXN0aWNDcm93ZERlbnNpdGllcygpO1xuICB9XG5cbiAgLy8gQ3JlYXRlIGEgbWFwIG9mIGxvY2F0aW9uIHRvIGl0cyBjcm93ZCBkZW5zaXR5XG4gIGNvbnN0IGRlbnNpdHlNYXAgPSBuZXcgTWFwKCk7XG4gIGNyb3dkRGF0YS5mb3JFYWNoKChpdGVtOiBhbnkpID0+IHtcbiAgICBkZW5zaXR5TWFwLnNldChpdGVtLmxvY2F0aW9uX25hbWUsIGl0ZW0uZGVuc2l0eV9sZXZlbCk7XG4gIH0pO1xuXG4gIC8vIENhbGN1bGF0ZSBkaXJlY3QgZGlzdGFuY2UgYmV0d2VlbiBzdGFydCBhbmQgZGVzdGluYXRpb25cbiAgY29uc3QgZGlyZWN0RGlzdGFuY2UgPSBESVNUQU5DRV9HUkFQSFtzdGFydF0/LltkZXN0aW5hdGlvbl0gfHwgMDtcbiAgXG4gIC8vIElmIG5vIGRpcmVjdCBwYXRoIGV4aXN0cywgcmV0dXJuIGFuIGVycm9yXG4gIGlmIChkaXJlY3REaXN0YW5jZSA9PT0gMCkge1xuICAgIHRocm93IG5ldyBFcnJvcignTm8gZGlyZWN0IHJvdXRlIGF2YWlsYWJsZSBiZXR3ZWVuIHRoZXNlIGxvY2F0aW9ucycpO1xuICB9XG5cbiAgLy8gR2V0IHRoZSBhY3R1YWwgZGVuc2l0eSBsZXZlbHMgZnJvbSB0aGUgY3Jvd2QgZGF0YVxuICBjb25zdCBzdGFydERlbnNpdHkgPSBkZW5zaXR5TWFwLmdldChzdGFydCkgfHwgJ2xvdyc7XG4gIGNvbnN0IGRlc3REZW5zaXR5ID0gZGVuc2l0eU1hcC5nZXQoZGVzdGluYXRpb24pIHx8ICdsb3cnO1xuICBcbiAgY29uc29sZS5sb2coYFJvdXRlIGNhbGN1bGF0aW9uOiAke3N0YXJ0fSAoJHtzdGFydERlbnNpdHl9KSB0byAke2Rlc3RpbmF0aW9ufSAoJHtkZXN0RGVuc2l0eX0pYCk7XG4gIFxuICAvLyBGaW5kIGFsbCBsb2NhdGlvbnMgb24gdGhlIHBhdGggKHdlJ2xsIHVzZSBhbGwgYXZhaWxhYmxlIGxvY2F0aW9ucylcbiAgLy8gVGhpcyBpcyBlbmhhbmNlZCB0byBjb25zaWRlciBhbHRlcm5hdGUgcGF0aHMgdGhyb3VnaCBkaWZmZXJlbnQgbG9jYXRpb25zXG4gIGNvbnN0IGFsbExvY2F0aW9ucyA9IE9iamVjdC5rZXlzKERJU1RBTkNFX0dSQVBIKTtcbiAgXG4gIC8vIENyZWF0ZSBhIGdyYXBoIHdoZXJlIGVkZ2Ugd2VpZ2h0cyBhcmUgYWZmZWN0ZWQgYnkgY3Jvd2QgZGVuc2l0eVxuICBjb25zdCB3ZWlnaHRlZEdyYXBoOiBSZWNvcmQ8c3RyaW5nLCBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiA9IHt9O1xuICBcbiAgLy8gRGVuc2l0eSBwZW5hbHR5IG11bHRpcGxpZXJzIC0gbW9yZSBjcm93ZGVkID0gaGlnaGVyIHdlaWdodFxuICAvLyBBZGp1c3RlZCBmb3IgdGhlIDI1MCwwMDAtMzUwLDAwMCBwaWxncmltIGNvdW50IHJhbmdlXG4gIGNvbnN0IGRlbnNpdHlQZW5hbHR5ID0ge1xuICAgICdsb3cnOiAxLjAsXG4gICAgJ21lZGl1bSc6IDEuOCxcbiAgICAnaGlnaCc6IDMuMCxcbiAgICAnY3JpdGljYWwnOiA1LjBcbiAgfTtcbiAgXG4gIC8vIEJ1aWxkIGEgd2VpZ2h0ZWQgZ3JhcGggYmFzZWQgb24gY3Jvd2QgZGVuc2l0eVxuICBhbGxMb2NhdGlvbnMuZm9yRWFjaChmcm9tTG9jID0+IHtcbiAgICB3ZWlnaHRlZEdyYXBoW2Zyb21Mb2NdID0ge307XG4gICAgXG4gICAgT2JqZWN0LmVudHJpZXMoRElTVEFOQ0VfR1JBUEhbZnJvbUxvY10gfHwge30pLmZvckVhY2goKFt0b0xvYywgZGlzdGFuY2VdKSA9PiB7XG4gICAgICBjb25zdCB0b0RlbnNpdHkgPSBkZW5zaXR5TWFwLmdldCh0b0xvYykgfHwgJ2xvdyc7XG4gICAgICAvLyBXZWlnaHQgaXMgZGlzdGFuY2UgKiBkZW5zaXR5IHBlbmFsdHlcbiAgICAgIHdlaWdodGVkR3JhcGhbZnJvbUxvY11bdG9Mb2NdID0gZGlzdGFuY2UgKiBkZW5zaXR5UGVuYWx0eVt0b0RlbnNpdHkgYXMga2V5b2YgdHlwZW9mIGRlbnNpdHlQZW5hbHR5XTtcbiAgICB9KTtcbiAgfSk7XG4gIFxuICAvLyBEaWprc3RyYSdzIGFsZ29yaXRobSB0byBmaW5kIHNob3J0ZXN0IChsZWFzdCBjcm93ZGVkKSBwYXRoXG4gIGNvbnN0IGZpbmRCZXN0UGF0aCA9IChncmFwaDogUmVjb3JkPHN0cmluZywgUmVjb3JkPHN0cmluZywgbnVtYmVyPj4sIHN0YXJ0Tm9kZTogc3RyaW5nLCBlbmROb2RlOiBzdHJpbmcpID0+IHtcbiAgICAvLyBJbml0aWFsaXplIGRpc3RhbmNlcyBhbmQgdmlzaXRlZCBub2Rlc1xuICAgIGNvbnN0IGRpc3RhbmNlczogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9O1xuICAgIGNvbnN0IHByZXZpb3VzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmcgfCBudWxsPiA9IHt9O1xuICAgIGNvbnN0IHZpc2l0ZWQgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgICBjb25zdCBub2RlcyA9IE9iamVjdC5rZXlzKGdyYXBoKTtcbiAgICBcbiAgICAvLyBTZXQgaW5pdGlhbCBkaXN0YW5jZXMgdG8gaW5maW5pdHkgZXhjZXB0IGZvciBzdGFydCBub2RlXG4gICAgbm9kZXMuZm9yRWFjaChub2RlID0+IHtcbiAgICAgIGRpc3RhbmNlc1tub2RlXSA9IEluZmluaXR5O1xuICAgICAgcHJldmlvdXNbbm9kZV0gPSBudWxsO1xuICAgIH0pO1xuICAgIGRpc3RhbmNlc1tzdGFydE5vZGVdID0gMDtcbiAgICBcbiAgICAvLyBGaW5kIG5vZGUgd2l0aCBzbWFsbGVzdCBkaXN0YW5jZVxuICAgIGNvbnN0IGZpbmRTbWFsbGVzdERpc3RhbmNlTm9kZSA9ICgpID0+IHtcbiAgICAgIGxldCBzbWFsbGVzdCA9IEluZmluaXR5O1xuICAgICAgbGV0IHNtYWxsZXN0Tm9kZSA9IG51bGw7XG4gICAgICBcbiAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBub2Rlcykge1xuICAgICAgICBpZiAoIXZpc2l0ZWQuaGFzKG5vZGUpICYmIGRpc3RhbmNlc1tub2RlXSA8IHNtYWxsZXN0KSB7XG4gICAgICAgICAgc21hbGxlc3QgPSBkaXN0YW5jZXNbbm9kZV07XG4gICAgICAgICAgc21hbGxlc3ROb2RlID0gbm9kZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gc21hbGxlc3ROb2RlO1xuICAgIH07XG4gICAgXG4gICAgLy8gTWFpbiBhbGdvcml0aG1cbiAgICBsZXQgY3VycmVudE5vZGUgPSBmaW5kU21hbGxlc3REaXN0YW5jZU5vZGUoKTtcbiAgICBcbiAgICB3aGlsZSAoY3VycmVudE5vZGUpIHtcbiAgICAgIGNvbnN0IGRpc3RhbmNlID0gZGlzdGFuY2VzW2N1cnJlbnROb2RlXTtcbiAgICAgIGNvbnN0IG5laWdoYm9ycyA9IGdyYXBoW2N1cnJlbnROb2RlXTtcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCBuZWlnaGJvciBpbiBuZWlnaGJvcnMpIHtcbiAgICAgICAgY29uc3QgbmV3RGlzdGFuY2UgPSBkaXN0YW5jZSArIG5laWdoYm9yc1tuZWlnaGJvcl07XG4gICAgICAgIFxuICAgICAgICBpZiAobmV3RGlzdGFuY2UgPCBkaXN0YW5jZXNbbmVpZ2hib3JdKSB7XG4gICAgICAgICAgZGlzdGFuY2VzW25laWdoYm9yXSA9IG5ld0Rpc3RhbmNlO1xuICAgICAgICAgIHByZXZpb3VzW25laWdoYm9yXSA9IGN1cnJlbnROb2RlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIHZpc2l0ZWQuYWRkKGN1cnJlbnROb2RlKTtcbiAgICAgIGN1cnJlbnROb2RlID0gZmluZFNtYWxsZXN0RGlzdGFuY2VOb2RlKCk7XG4gICAgfVxuICAgIFxuICAgIC8vIEJ1aWxkIHBhdGggZnJvbSByZXN1bHRzXG4gICAgY29uc3QgcGF0aCA9IFtdO1xuICAgIGxldCBjdXJyZW50ID0gZW5kTm9kZTtcbiAgICBcbiAgICB3aGlsZSAoY3VycmVudCkge1xuICAgICAgcGF0aC51bnNoaWZ0KGN1cnJlbnQpO1xuICAgICAgY3VycmVudCA9IHByZXZpb3VzW2N1cnJlbnRdIGFzIHN0cmluZztcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHBhdGgubGVuZ3RoID4gMSA/IHBhdGggOiBbXTsgLy8gUmV0dXJuIGVtcHR5IGlmIG5vIHBhdGggZm91bmRcbiAgfTtcbiAgXG4gIC8vIEZpbmQgYmVzdCBwYXRoIGNvbnNpZGVyaW5nIGNyb3dkIGRlbnNpdHlcbiAgY29uc3QgcGF0aE5vZGVzID0gZmluZEJlc3RQYXRoKHdlaWdodGVkR3JhcGgsIHN0YXJ0LCBkZXN0aW5hdGlvbik7XG4gIGNvbnNvbGUubG9nKFwiQ2FsY3VsYXRlZCBwYXRoIHRocm91Z2ggbm9kZXM6XCIsIHBhdGhOb2Rlcyk7XG4gIFxuICAvLyBJZiBubyBwYXRoIGZvdW5kLCBqdXN0IHVzZSBkaXJlY3Qgcm91dGVcbiAgaWYgKHBhdGhOb2Rlcy5sZW5ndGggPD0gMSkge1xuICAgIGNvbnNvbGUubG9nKFwiTm8gb3B0aW1hbCBwYXRoIGZvdW5kLCB1c2luZyBkaXJlY3Qgcm91dGVcIik7XG4gICAgcGF0aE5vZGVzLnNwbGljZSgwLCBwYXRoTm9kZXMubGVuZ3RoLCBzdGFydCwgZGVzdGluYXRpb24pO1xuICB9XG4gIFxuICAvLyBHZXQgdGhlIGFjdHVhbCBjcm93ZCBkZW5zaXR5IGxldmVscyBhbG9uZyBvdXIgcGF0aFxuICBjb25zdCBsb2NhdGlvbnNPblBhdGggPSBwYXRoTm9kZXM7XG4gIFxuICAvLyBEZXRlcm1pbmUgd29yc3QgY29uZ2VzdGlvbiBsZXZlbCBvbiB0aGUgcm91dGVcbiAgY29uc3QgZGVuc2l0eUxldmVscyA9IFsnbG93JywgJ21lZGl1bScsICdoaWdoJywgJ2NyaXRpY2FsJ107XG4gIGNvbnN0IGRlbnNpdHlWYWx1ZXMgPSBsb2NhdGlvbnNPblBhdGgubWFwKGxvYyA9PiB7XG4gICAgY29uc3QgbGV2ZWwgPSBkZW5zaXR5TWFwLmdldChsb2MpIHx8ICdsb3cnO1xuICAgIHJldHVybiBkZW5zaXR5TGV2ZWxzLmluZGV4T2YobGV2ZWwpO1xuICB9KTtcbiAgXG4gIC8vIFRha2UgdGhlIG1heGltdW0gZGVuc2l0eSB2YWx1ZSAod29yc3QgY29uZ2VzdGlvbilcbiAgY29uc3QgbWF4RGVuc2l0eVZhbHVlID0gTWF0aC5tYXgoLi4uZGVuc2l0eVZhbHVlcyk7XG4gIGNvbnN0IHJvdXRlQ29uZ2VzdGlvbiA9IGRlbnNpdHlMZXZlbHNbbWF4RGVuc2l0eVZhbHVlXTtcbiAgXG4gIGNvbnNvbGUubG9nKGBSb3V0ZSBjb25nZXN0aW9uIGRldGVybWluZWQgdG8gYmU6ICR7cm91dGVDb25nZXN0aW9ufWApO1xuXG4gIC8vIEFkanVzdCB3YWxraW5nIHNwZWVkIGJhc2VkIG9uIGNyb3dkIGRlbnNpdHlcbiAgLy8gVXBkYXRlZCBzcGVlZHMgZm9yIHRoZSBwaWxncmltIHJhbmdlIG9mIDI1MCwwMDAtMzUwLDAwMFxuICBsZXQgc3BlZWRNdWx0aXBsaWVyID0gMS4wO1xuICBzd2l0Y2ggKHJvdXRlQ29uZ2VzdGlvbikge1xuICAgIGNhc2UgJ2xvdyc6XG4gICAgICBzcGVlZE11bHRpcGxpZXIgPSAxLjA7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdtZWRpdW0nOlxuICAgICAgc3BlZWRNdWx0aXBsaWVyID0gMC43O1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnaGlnaCc6XG4gICAgICBzcGVlZE11bHRpcGxpZXIgPSAwLjU7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdjcml0aWNhbCc6XG4gICAgICBzcGVlZE11bHRpcGxpZXIgPSAwLjM7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgc3BlZWRNdWx0aXBsaWVyID0gMS4wO1xuICB9XG4gIFxuICAvLyBDYWxjdWxhdGUgdG90YWwgZGlzdGFuY2UgYWxvbmcgcGF0aFxuICBsZXQgdG90YWxEaXN0YW5jZSA9IDA7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcGF0aE5vZGVzLmxlbmd0aCAtIDE7IGkrKykge1xuICAgIGNvbnN0IGZyb20gPSBwYXRoTm9kZXNbaV07XG4gICAgY29uc3QgdG8gPSBwYXRoTm9kZXNbaSArIDFdO1xuICAgIHRvdGFsRGlzdGFuY2UgKz0gRElTVEFOQ0VfR1JBUEhbZnJvbV0/Llt0b10gfHwgMDtcbiAgfVxuICBcbiAgY29uc3QgYWRqdXN0ZWRTcGVlZCA9IEFWR19XQUxLSU5HX1NQRUVEICogc3BlZWRNdWx0aXBsaWVyO1xuICBcbiAgLy8gQ2FsY3VsYXRlIGR1cmF0aW9uIChpbiBtaW51dGVzKVxuICBjb25zdCBkdXJhdGlvbkhvdXJzID0gdG90YWxEaXN0YW5jZSAvIGFkanVzdGVkU3BlZWQ7XG4gIGNvbnN0IGR1cmF0aW9uTWludXRlcyA9IE1hdGguY2VpbChkdXJhdGlvbkhvdXJzICogNjApO1xuICBcbiAgLy8gR2VuZXJhdGUgZGlyZWN0aW9ucyBiYXNlZCBvbiBjcm93ZCBkZW5zaXR5XG4gIGNvbnN0IGRpcmVjdGlvbnMgPSBbXTtcbiAgZGlyZWN0aW9ucy5wdXNoKGBTdGFydCBhdCAke3N0YXJ0fWApO1xuICBcbiAgLy8gQWRkIHdhcm5pbmdzIGJhc2VkIG9uIGFjdHVhbCBjcm93ZCBkZW5zaXR5XG4gIGNvbnN0IGNvbmdlc3RlZExvY2F0aW9ucyA9IGxvY2F0aW9uc09uUGF0aC5maWx0ZXIobG9jID0+IHtcbiAgICBjb25zdCBsZXZlbCA9IGRlbnNpdHlNYXAuZ2V0KGxvYykgfHwgJ2xvdyc7XG4gICAgcmV0dXJuIGxldmVsID09PSAnaGlnaCcgfHwgbGV2ZWwgPT09ICdjcml0aWNhbCc7XG4gIH0pO1xuICBcbiAgaWYgKGNvbmdlc3RlZExvY2F0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgaWYgKGNvbmdlc3RlZExvY2F0aW9ucy5pbmNsdWRlcyhzdGFydCkgJiYgZGVuc2l0eU1hcC5nZXQoc3RhcnQpID09PSAnY3JpdGljYWwnKSB7XG4gICAgICBkaXJlY3Rpb25zLnB1c2goYOKaoO+4jyBXYXJuaW5nOiBFeHRyZW1lbHkgaGlnaCBjcm93ZCBkZW5zaXR5IGF0IHlvdXIgc3RhcnRpbmcgcG9pbnQgKCR7c3RhcnR9KWApO1xuICAgIH0gZWxzZSBpZiAoY29uZ2VzdGVkTG9jYXRpb25zLmluY2x1ZGVzKGRlc3RpbmF0aW9uKSAmJiBkZW5zaXR5TWFwLmdldChkZXN0aW5hdGlvbikgPT09ICdjcml0aWNhbCcpIHtcbiAgICAgIGRpcmVjdGlvbnMucHVzaChg4pqg77iPIFdhcm5pbmc6IEV4dHJlbWVseSBoaWdoIGNyb3dkIGRlbnNpdHkgYXQgeW91ciBkZXN0aW5hdGlvbiAoJHtkZXN0aW5hdGlvbn0pYCk7XG4gICAgfSBlbHNlIGlmIChyb3V0ZUNvbmdlc3Rpb24gPT09ICdjcml0aWNhbCcpIHtcbiAgICAgIGRpcmVjdGlvbnMucHVzaChg4pqg77iPIFdhcm5pbmc6IEV4dHJlbWVseSBoaWdoIGNyb3dkIGRlbnNpdHkgb24gdGhpcyByb3V0ZWApO1xuICAgIH0gZWxzZSB7XG4gICAgICBkaXJlY3Rpb25zLnB1c2goYOKaoO+4jyBXYXJuaW5nOiBIaWdoIGNyb3dkIGRlbnNpdHkgZGV0ZWN0ZWQgb24gdGhpcyByb3V0ZWApO1xuICAgIH1cbiAgICBcbiAgICBkaXJlY3Rpb25zLnB1c2goYFdlJ3ZlIGNhbGN1bGF0ZWQgYSByb3V0ZSB0aGF0IGF2b2lkcyB0aGUgbW9zdCBjcm93ZGVkIGFyZWFzIHdoZXJlIHBvc3NpYmxlYCk7XG4gICAgZGlyZWN0aW9ucy5wdXNoKGBDb25zaWRlciB0cmF2ZWxpbmcgZHVyaW5nIG9mZi1wZWFrIGhvdXJzIGlmIHBvc3NpYmxlYCk7XG4gIH0gZWxzZSB7XG4gICAgZGlyZWN0aW9ucy5wdXNoKGBUaGlzIHJvdXRlIGF2b2lkcyBoaWdoIGNyb3dkIGRlbnNpdHkgYXJlYXNgKTtcbiAgfVxuICBcbiAgLy8gQWRkIGRpcmVjdGlvbnMgZm9yIGludGVybWVkaWF0ZSBsb2NhdGlvbnMgaWYgYW55XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcGF0aE5vZGVzLmxlbmd0aCAtIDE7IGkrKykge1xuICAgIGNvbnN0IGN1cnJlbnRMb2MgPSBwYXRoTm9kZXNbaV07XG4gICAgY29uc3QgbmV4dExvYyA9IHBhdGhOb2Rlc1tpICsgMV07XG4gICAgY29uc3QgZGlzdGFuY2UgPSBESVNUQU5DRV9HUkFQSFtjdXJyZW50TG9jXT8uW25leHRMb2NdIHx8IDA7XG4gICAgY29uc3QgbG9jRGVuc2l0eSA9IGRlbnNpdHlNYXAuZ2V0KG5leHRMb2MpIHx8ICdsb3cnO1xuICAgIFxuICAgIGlmIChpID4gMCkgeyAvLyBTa2lwIGZpcnN0IG5vZGUsIGFscmVhZHkgY292ZXJlZCBieSBcIlN0YXJ0IGF0Li4uXCJcbiAgICAgIGRpcmVjdGlvbnMucHVzaChgQ29udGludWUgdG8gJHtuZXh0TG9jfSAoJHtsb2NEZW5zaXR5fSBjcm93ZCBkZW5zaXR5KSAtICR7ZGlzdGFuY2UudG9GaXhlZCgxKX0ga21gKTtcbiAgICB9XG4gIH1cbiAgXG4gIC8vIEFkZCBzcGVjaWZpYyBkaXJlY3Rpb25zIGJhc2VkIG9uIGxvY2F0aW9ucyBhbmQgdGhlaXIgYWN0dWFsIGNvbmdlc3Rpb24gd2l0aCBzdHJlZXQgbmFtZXNcbiAgaWYgKHBhdGhOb2Rlcy5sZW5ndGggPT09IDIpIHsgLy8gRGlyZWN0IHJvdXRlXG4gICAgaWYgKHN0YXJ0ID09PSAnTWluYScgJiYgZGVzdGluYXRpb24gPT09ICdKYW1hcmFhdCBCcmlkZ2UnKSB7XG4gICAgICBkaXJlY3Rpb25zLnB1c2goYEhlYWQgc291dGh3ZXN0IG9uIFRhcmlxIEFsLUpheXNoIFN0cmVldCBmb3IgMC41IGttYCk7XG4gICAgICBkaXJlY3Rpb25zLnB1c2goYFR1cm4gcmlnaHQgb250byBBbC1KYW1hcmF0IFJvYWQgYW5kIGNvbnRpbnVlIGZvciAxLjAga21gKTtcbiAgICAgIGRpcmVjdGlvbnMucHVzaChgRm9sbG93IHRoZSBkZXNpZ25hdGVkIHBhdGh3YXkgYWxvbmcgQWwtSmFtYXJhdCBSb2FkIGZvbGxvd2luZyB0aGUgY3Jvd2QgbWFuYWdlbWVudCBiYXJyaWVyc2ApO1xuICAgICAgXG4gICAgICBpZiAoZGVuc2l0eU1hcC5nZXQoJ0phbWFyYWF0IEJyaWRnZScpID09PSAnaGlnaCcgfHwgZGVuc2l0eU1hcC5nZXQoJ0phbWFyYWF0IEJyaWRnZScpID09PSAnY3JpdGljYWwnKSB7XG4gICAgICAgIGRpcmVjdGlvbnMucHVzaChgQXQgdGhlIEphbWFyYXQgQ29tcGxleCwgZm9sbG93IHNpZ25zIGZvciB5b3VyIGNhbXAncyBkZXNpZ25hdGVkIHRpbWUgc2xvdCBlbnRyYW5jZWApO1xuICAgICAgICBkaXJlY3Rpb25zLnB1c2goYFVzZSB0aGUgSmFtYXJhdCBCcmlkZ2UgRWFzdGVybiBFbnRyYW5jZSB0byBhdm9pZCB0aGUgbW9zdCBjb25nZXN0ZWQgYXJlYXNgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRpcmVjdGlvbnMucHVzaChgQ29udGludWUgb24gQWwtSmFtYXJhdCBSb2FkIHVudGlsIHlvdSByZWFjaCB0aGUgSmFtYXJhdCBDb21wbGV4YCk7XG4gICAgICB9XG4gICAgfSBcbiAgICBlbHNlIGlmIChzdGFydCA9PT0gJ01hc2ppZCBhbC1IYXJhbScgJiYgZGVzdGluYXRpb24gPT09ICdNaW5hJykge1xuICAgICAgZGlyZWN0aW9ucy5wdXNoKGBFeGl0IE1hc2ppZCBhbC1IYXJhbSB0aHJvdWdoIHRoZSBLaW5nIEZhaGQgZXhwYW5zaW9uIGdhdGUgKEdhdGUgNzkpYCk7XG4gICAgICBkaXJlY3Rpb25zLnB1c2goYEhlYWQgZWFzdCBvbiBJYnJhaGltIEFsIEtoYWxpbCBSb2FkIGZvciAxLjIga21gKTtcbiAgICAgIGRpcmVjdGlvbnMucHVzaChgQ29udGludWUgb250byBNYWtrYWgtTWluYSBSb2FkIGZvciA0LjUga21gKTtcbiAgICAgIFxuICAgICAgaWYgKGRlbnNpdHlNYXAuZ2V0KCdNYXNqaWQgYWwtSGFyYW0nKSA9PT0gJ2hpZ2gnIHx8IGRlbnNpdHlNYXAuZ2V0KCdNYXNqaWQgYWwtSGFyYW0nKSA9PT0gJ2NyaXRpY2FsJykge1xuICAgICAgICBkaXJlY3Rpb25zLnB1c2goYFRha2UgdGhlIGNvdmVyZWQgd2Fsa3dheSBwYXRoIG9uIFBlZGVzdHJpYW4gUm91dGUgNWApO1xuICAgICAgICBkaXJlY3Rpb25zLnB1c2goYEtlZXAgcmlnaHQgYXQgdGhlIEFsLU11YWlzZW0ganVuY3Rpb24gdG8gYXZvaWQgaGVhdmllciBjcm93ZHNgKTtcbiAgICAgICAgZGlyZWN0aW9ucy5wdXNoKGBGb2xsb3cgTWluYSBTdHJlZXQgMjA0IHRvIGVudGVyIHRoZSBNaW5hIFZhbGxleWApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGlyZWN0aW9ucy5wdXNoKGBGb2xsb3cgdGhlIG1haW4gcGVkZXN0cmlhbiBwYXRoIGFsb25nIE1ha2thaC1NaW5hIFJvYWRgKTtcbiAgICAgICAgZGlyZWN0aW9ucy5wdXNoKGBFbnRlciBNaW5hIHZpYSBTdHJlZXQgMjA2YCk7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKHN0YXJ0ID09PSAnTWFzamlkIGFsLUhhcmFtJyAmJiBkZXN0aW5hdGlvbiA9PT0gJ0FyYWZhdCcpIHtcbiAgICAgIGRpcmVjdGlvbnMucHVzaChgRXhpdCBNYXNqaWQgYWwtSGFyYW0gdGhyb3VnaCB0aGUgQWp5YWQgR2F0ZSAoR2F0ZSA1KWApO1xuICAgICAgZGlyZWN0aW9ucy5wdXNoKGBIZWFkIHNvdXRoZWFzdCBvbiBBbC1IYXJhbSBSb2FkIGZvciAxLjUga21gKTtcbiAgICAgIGRpcmVjdGlvbnMucHVzaChgQ29udGludWUgb250byBNYWtrYWgtQXJhZmF0IEhpZ2h3YXkgZm9yIDE0IGttYCk7XG4gICAgICBkaXJlY3Rpb25zLnB1c2goYEZvbGxvdyBzaWducyBmb3IgQXJhZmF0IFBsYWluIG9uIFJvdXRlIDE1YCk7XG4gICAgICBkaXJlY3Rpb25zLnB1c2goYEVudGVyIEFyYWZhdCB2aWEgTm9ydGhlcm4gRW50cmFuY2UgUm9hZGApO1xuICAgIH1cbiAgICBlbHNlIGlmIChzdGFydCA9PT0gJ0FyYWZhdCcgJiYgZGVzdGluYXRpb24gPT09ICdNdXpkYWxpZmFoJykge1xuICAgICAgZGlyZWN0aW9ucy5wdXNoKGBFeGl0IEFyYWZhdCB2aWEgdGhlIFdlc3Rlcm4gRXhpdCBSb2FkYCk7XG4gICAgICBkaXJlY3Rpb25zLnB1c2goYEhlYWQgd2VzdCBvbiBBcmFmYXQtTXV6ZGFsaWZhaCBSb2FkIGZvciA2IGttYCk7XG4gICAgICBkaXJlY3Rpb25zLnB1c2goYEZvbGxvdyB0aGUgcGVkZXN0cmlhbiBwYXRod2F5cyBtYXJrZWQgaW4gZ3JlZW5gKTtcbiAgICAgIGRpcmVjdGlvbnMucHVzaChgQ29udGludWUgc3RyYWlnaHQgb250byBNdXpkYWxpZmFoIFZhbGxleSBSb2FkYCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHN0YXJ0ID09PSAnTXV6ZGFsaWZhaCcgJiYgZGVzdGluYXRpb24gPT09ICdNaW5hJykge1xuICAgICAgZGlyZWN0aW9ucy5wdXNoKGBIZWFkIG5vcnRod2VzdCBvbiBNdXpkYWxpZmFoIFZhbGxleSBSb2FkYCk7XG4gICAgICBkaXJlY3Rpb25zLnB1c2goYENvbnRpbnVlIG9udG8gTXV6ZGFsaWZhaC1NaW5hIENvbm5lY3Rpb24gUm9hZCBmb3IgMi41IGttYCk7XG4gICAgICBkaXJlY3Rpb25zLnB1c2goYEZvbGxvdyB0aGUgcGVkZXN0cmlhbiByb3V0ZXMgbWFya2VkIHdpdGggeWVsbG93IHNpZ25zYCk7XG4gICAgICBkaXJlY3Rpb25zLnB1c2goYEVudGVyIE1pbmEgdGhyb3VnaCB0aGUgU291dGhlcm4gRW50cmFuY2VgKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoc3RhcnQgPT09ICdKYW1hcmFhdCBCcmlkZ2UnICYmIGRlc3RpbmF0aW9uID09PSAnTWFzamlkIGFsLUhhcmFtJykge1xuICAgICAgZGlyZWN0aW9ucy5wdXNoKGBFeGl0IHRoZSBKYW1hcmF0IENvbXBsZXggdmlhIHRoZSBXZXN0ZXJuIEV4aXRgKTtcbiAgICAgIGRpcmVjdGlvbnMucHVzaChgSGVhZCBzb3V0aHdlc3Qgb24gQWwtSmFtYXJhdCBSb2FkIGZvciAwLjgga21gKTtcbiAgICAgIGRpcmVjdGlvbnMucHVzaChgQ29udGludWUgb250byBNaW5hLU1ha2thaCBQZWRlc3RyaWFuIFdheSBmb3IgNSBrbWApO1xuICAgICAgZGlyZWN0aW9ucy5wdXNoKGBGb2xsb3cgSWJyYWhpbSBBbC1LaGFsaWwgUm9hZCB0byByZWFjaCBNYXNqaWQgYWwtSGFyYW1gKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAvLyBEZWZhdWx0IGRpcmVjdGlvbnMgZm9yIGFueSBvdGhlciBjb21iaW5hdGlvblxuICAgICAgZGlyZWN0aW9ucy5wdXNoKGBIZWFkIHRvd2FyZCAke2Rlc3RpbmF0aW9ufSBmb2xsb3dpbmcgdGhlIG1haW4gcGlsZ3JpbWFnZSByb3V0ZWApO1xuICAgICAgZGlyZWN0aW9ucy5wdXNoKGBGb2xsb3cgdGhlIG9mZmljaWFsIHNpZ25hZ2UgYW5kIGNyb3dkIG1hbmFnZW1lbnQgZGlyZWN0aW9uc2ApO1xuICAgIH1cbiAgfVxuICBcbiAgZGlyZWN0aW9ucy5wdXNoKGBBcnJpdmUgYXQgJHtkZXN0aW5hdGlvbn1gKTtcbiAgXG4gIC8vIEFkZGl0aW9uYWwgYWR2aWNlIGZvciBoaWdoIGNvbmdlc3Rpb24gcm91dGVzIGJhc2VkIG9uIGFjdHVhbCBkYXRhXG4gIGlmIChyb3V0ZUNvbmdlc3Rpb24gPT09ICdoaWdoJyB8fCByb3V0ZUNvbmdlc3Rpb24gPT09ICdjcml0aWNhbCcpIHtcbiAgICBkaXJlY3Rpb25zLnB1c2goYFN0YXkgaHlkcmF0ZWQgYW5kIGZvbGxvdyBjcm93ZCBtYW5hZ2VtZW50IG9mZmljaWFscycgaW5zdHJ1Y3Rpb25zYCk7XG4gICAgZGlyZWN0aW9ucy5wdXNoKGBLZWVwIHlvdXIgZ3JvdXAgdG9nZXRoZXIgYW5kIGZvbGxvdyB0aGUgZGVzaWduYXRlZCB3YWxraW5nIHBhdGhzYCk7XG4gIH1cbiAgXG4gIHJldHVybiB7XG4gICAgc3RhcnQsXG4gICAgZGVzdGluYXRpb24sXG4gICAgZGlzdGFuY2U6IGAke3RvdGFsRGlzdGFuY2UudG9GaXhlZCgxKX0ga21gLFxuICAgIGR1cmF0aW9uOiBgJHtkdXJhdGlvbk1pbnV0ZXN9IG1pbnV0ZXNgLFxuICAgIGNvbmdlc3Rpb25fbGV2ZWw6IHJvdXRlQ29uZ2VzdGlvbixcbiAgICBkaXJlY3Rpb25zLFxuICAgIHZpYTogcGF0aE5vZGVzLmxlbmd0aCA+IDIgPyBwYXRoTm9kZXMuc2xpY2UoMSwgLTEpIDogW10sXG4gICAgcGlsZ3JpbV9jb3VudF9yYW5nZTogXCIyNTAsMDAwLTM1MCwwMDBcIixcbiAgICBhZGp1c3RlZF93YWxraW5nX3NwZWVkOiBgJHthZGp1c3RlZFNwZWVkLnRvRml4ZWQoMSl9IGttL2hgLFxuICAgIGNyb3dkX2ltcGFjdDogc3BlZWRNdWx0aXBsaWVyIDwgMC44ID8gXCJzaWduaWZpY2FudFwiIDogXCJtb2RlcmF0ZVwiXG4gIH07XG59XG5cbi8vIEdFVCBoYW5kbGVyIHRvIGNhbGN1bGF0ZSByb3V0ZSBiZXR3ZWVuIHR3byBwb2ludHNcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogUmVxdWVzdCkge1xuICAvLyBSZXR1cm4gZXJyb3IgaWYgc3VwYWJhc2VBZG1pbiBpcyBub3QgYXZhaWxhYmxlXG4gIGlmICghc3VwYWJhc2VBZG1pbikge1xuICAgIGNvbnNvbGUud2FybignU2VydmljZSByb2xlIGtleSBub3QgY29uZmlndXJlZCwgc29tZSBmZWF0dXJlcyBtYXkgYmUgbGltaXRlZCcpO1xuICB9XG5cbiAgdHJ5IHtcbiAgICAvLyBHZXQgcGFyYW1ldGVycyBmcm9tIFVSTFxuICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcbiAgICBjb25zdCBzdGFydCA9IHNlYXJjaFBhcmFtcy5nZXQoJ3N0YXJ0Jyk7XG4gICAgY29uc3QgZGVzdGluYXRpb24gPSBzZWFyY2hQYXJhbXMuZ2V0KCdkZXN0aW5hdGlvbicpO1xuICAgIFxuICAgIGlmICghc3RhcnQgfHwgIWRlc3RpbmF0aW9uKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdNaXNzaW5nIHN0YXJ0IG9yIGRlc3RpbmF0aW9uIHBhcmFtZXRlcicgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHJvdXRlRGF0YSA9IGF3YWl0IGNhbGN1bGF0ZVJvdXRlV2l0aENyb3dkRGVuc2l0eShzdGFydCwgZGVzdGluYXRpb24pO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihyb3V0ZURhdGEpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNhbGN1bGF0aW5nIHJvdXRlOicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdFcnJvciBjYWxjdWxhdGluZyByb3V0ZScgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICk7XG4gIH1cbn0gIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsInN1cGFiYXNlQWRtaW4iLCJjYWxjdWxhdGVSZWFsaXN0aWNDcm93ZERlbnNpdGllcyIsIkRJU1RBTkNFX0dSQVBIIiwiQVZHX1dBTEtJTkdfU1BFRUQiLCJjYWxjdWxhdGVSb3V0ZVdpdGhDcm93ZERlbnNpdHkiLCJzdGFydCIsImRlc3RpbmF0aW9uIiwiY3Jvd2REYXRhIiwiZGF0YSIsImVycm9yIiwiZnJvbSIsInNlbGVjdCIsImxlbmd0aCIsImNvbnNvbGUiLCJkZW5zaXR5TWFwIiwiTWFwIiwiZm9yRWFjaCIsIml0ZW0iLCJzZXQiLCJsb2NhdGlvbl9uYW1lIiwiZGVuc2l0eV9sZXZlbCIsImRpcmVjdERpc3RhbmNlIiwiRXJyb3IiLCJzdGFydERlbnNpdHkiLCJnZXQiLCJkZXN0RGVuc2l0eSIsImxvZyIsImFsbExvY2F0aW9ucyIsIk9iamVjdCIsImtleXMiLCJ3ZWlnaHRlZEdyYXBoIiwiZGVuc2l0eVBlbmFsdHkiLCJmcm9tTG9jIiwiZW50cmllcyIsInRvTG9jIiwiZGlzdGFuY2UiLCJ0b0RlbnNpdHkiLCJmaW5kQmVzdFBhdGgiLCJncmFwaCIsInN0YXJ0Tm9kZSIsImVuZE5vZGUiLCJkaXN0YW5jZXMiLCJwcmV2aW91cyIsInZpc2l0ZWQiLCJTZXQiLCJub2RlcyIsIm5vZGUiLCJJbmZpbml0eSIsImZpbmRTbWFsbGVzdERpc3RhbmNlTm9kZSIsInNtYWxsZXN0Iiwic21hbGxlc3ROb2RlIiwiaGFzIiwiY3VycmVudE5vZGUiLCJuZWlnaGJvcnMiLCJuZWlnaGJvciIsIm5ld0Rpc3RhbmNlIiwiYWRkIiwicGF0aCIsImN1cnJlbnQiLCJ1bnNoaWZ0IiwicGF0aE5vZGVzIiwic3BsaWNlIiwibG9jYXRpb25zT25QYXRoIiwiZGVuc2l0eUxldmVscyIsImRlbnNpdHlWYWx1ZXMiLCJtYXAiLCJsb2MiLCJsZXZlbCIsImluZGV4T2YiLCJtYXhEZW5zaXR5VmFsdWUiLCJNYXRoIiwibWF4Iiwicm91dGVDb25nZXN0aW9uIiwic3BlZWRNdWx0aXBsaWVyIiwidG90YWxEaXN0YW5jZSIsImkiLCJ0byIsImFkanVzdGVkU3BlZWQiLCJkdXJhdGlvbkhvdXJzIiwiZHVyYXRpb25NaW51dGVzIiwiY2VpbCIsImRpcmVjdGlvbnMiLCJwdXNoIiwiY29uZ2VzdGVkTG9jYXRpb25zIiwiZmlsdGVyIiwiaW5jbHVkZXMiLCJjdXJyZW50TG9jIiwibmV4dExvYyIsImxvY0RlbnNpdHkiLCJ0b0ZpeGVkIiwiZHVyYXRpb24iLCJjb25nZXN0aW9uX2xldmVsIiwidmlhIiwic2xpY2UiLCJwaWxncmltX2NvdW50X3JhbmdlIiwiYWRqdXN0ZWRfd2Fsa2luZ19zcGVlZCIsImNyb3dkX2ltcGFjdCIsIkdFVCIsInJlcXVlc3QiLCJ3YXJuIiwic2VhcmNoUGFyYW1zIiwiVVJMIiwidXJsIiwianNvbiIsInN0YXR1cyIsInJvdXRlRGF0YSIsIm1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/routes/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/crowdSensors.ts":
/*!*********************************!*\
  !*** ./src/lib/crowdSensors.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   calculateRealisticCrowdDensities: () => (/* binding */ calculateRealisticCrowdDensities),\n/* harmony export */   updateCrowdDensityData: () => (/* binding */ updateCrowdDensityData)\n/* harmony export */ });\n/* harmony import */ var _supabase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./supabase */ \"(rsc)/./src/lib/supabase.ts\");\n// Simulated crowd density sensor network for Hajj sites\n\n// Total pilgrims range: 250,000 - 350,000\nconst TOTAL_PILGRIMS_MIN = 250000;\nconst TOTAL_PILGRIMS_MAX = 350000;\nconst TOTAL_PILGRIMS_AVG = Math.floor((TOTAL_PILGRIMS_MIN + TOTAL_PILGRIMS_MAX) / 2);\n// Define physical space characteristics for each location\nconst LOCATION_SIZES = {\n    \"Masjid al-Haram\": {\n        areaInSquareMeters: 356800,\n        capacity: 120000,\n        sections: [\n            {\n                id: \"mataf\",\n                name: \"Mataf Area\",\n                percentage: 0.15\n            },\n            {\n                id: \"ground\",\n                name: \"Ground Floor\",\n                percentage: 0.45\n            },\n            {\n                id: \"first\",\n                name: \"First Floor\",\n                percentage: 0.25\n            },\n            {\n                id: \"roof\",\n                name: \"Roof Area\",\n                percentage: 0.15\n            }\n        ]\n    },\n    \"Mina\": {\n        areaInSquareMeters: 812000,\n        capacity: 240000,\n        sections: [\n            {\n                id: \"tents-a\",\n                name: \"Tents Area A\",\n                percentage: 0.3\n            },\n            {\n                id: \"tents-b\",\n                name: \"Tents Area B\",\n                percentage: 0.3\n            },\n            {\n                id: \"tents-c\",\n                name: \"Tents Area C\",\n                percentage: 0.3\n            },\n            {\n                id: \"services\",\n                name: \"Services Area\",\n                percentage: 0.1\n            }\n        ]\n    },\n    \"Jamaraat Bridge\": {\n        areaInSquareMeters: 52000,\n        capacity: 100000,\n        sections: [\n            {\n                id: \"lower\",\n                name: \"Lower Level\",\n                percentage: 0.3\n            },\n            {\n                id: \"middle\",\n                name: \"Middle Level\",\n                percentage: 0.4\n            },\n            {\n                id: \"upper\",\n                name: \"Upper Level\",\n                percentage: 0.3\n            }\n        ]\n    },\n    \"Arafat\": {\n        areaInSquareMeters: 1456000,\n        capacity: 300000,\n        sections: [\n            {\n                id: \"jabal\",\n                name: \"Jabal al-Rahmah\",\n                percentage: 0.2\n            },\n            {\n                id: \"nimrah\",\n                name: \"Nimrah\",\n                percentage: 0.3\n            },\n            {\n                id: \"uranah\",\n                name: \"Uranah\",\n                percentage: 0.25\n            },\n            {\n                id: \"other\",\n                name: \"Other Areas\",\n                percentage: 0.25\n            }\n        ]\n    },\n    \"Muzdalifah\": {\n        areaInSquareMeters: 623000,\n        capacity: 250000,\n        sections: [\n            {\n                id: \"mash\",\n                name: \"Al-Mash'ar al-Haram\",\n                percentage: 0.3\n            },\n            {\n                id: \"north\",\n                name: \"Northern Area\",\n                percentage: 0.35\n            },\n            {\n                id: \"south\",\n                name: \"Southern Area\",\n                percentage: 0.35\n            }\n        ]\n    },\n    // Additional locations\n    \"Mina Entrance Gate 1\": {\n        areaInSquareMeters: 3000,\n        capacity: 15000,\n        sections: [\n            {\n                id: \"entry\",\n                name: \"Entry Points\",\n                percentage: 0.4\n            },\n            {\n                id: \"security\",\n                name: \"Security Check\",\n                percentage: 0.3\n            },\n            {\n                id: \"waiting\",\n                name: \"Waiting Area\",\n                percentage: 0.3\n            }\n        ]\n    },\n    \"Tent City Section A\": {\n        areaInSquareMeters: 120000,\n        capacity: 80000,\n        sections: [\n            {\n                id: \"a1\",\n                name: \"Block A1\",\n                percentage: 0.25\n            },\n            {\n                id: \"a2\",\n                name: \"Block A2\",\n                percentage: 0.25\n            },\n            {\n                id: \"a3\",\n                name: \"Block A3\",\n                percentage: 0.25\n            },\n            {\n                id: \"a4\",\n                name: \"Block A4\",\n                percentage: 0.25\n            }\n        ]\n    },\n    \"Jamarat Central Access\": {\n        areaInSquareMeters: 8000,\n        capacity: 30000,\n        sections: [\n            {\n                id: \"entry\",\n                name: \"Entry Zone\",\n                percentage: 0.4\n            },\n            {\n                id: \"corridor\",\n                name: \"Main Corridor\",\n                percentage: 0.4\n            },\n            {\n                id: \"exit\",\n                name: \"Exit Zone\",\n                percentage: 0.2\n            }\n        ]\n    }\n};\n// Calculate the sum of all location capacities to verify against total pilgrims\nconst TOTAL_CAPACITY = Object.values(LOCATION_SIZES).reduce((sum, location)=>sum + location.capacity, 0);\n// Define density threshold levels (people per square meter)\n// Adjusted for the pilgrims count of 250,000-350,000\nconst DENSITY_THRESHOLDS = {\n    low: 0.3,\n    medium: 0.8,\n    high: 1.5\n};\n// Time-based modifiers for various Hajj periods - increase/decrease multiplier\nconst TIME_MODIFIERS = {\n    beforePrayer: 2.0,\n    duringPrayer: 2.5,\n    afterPrayer: 1.8,\n    jamarat: 3.0,\n    tawaf: 2.5,\n    sayee: 2.0,\n    night: 0.7,\n    earlyMorning: 0.8,\n    hajjDay: 3.0\n};\n// Weather impacts on crowd behavior\nconst WEATHER_MODIFIERS = {\n    hot: 0.9,\n    rain: 0.7,\n    pleasant: 1.2\n};\n// Function to get realistic crowd densities based on various factors\nasync function calculateRealisticCrowdDensities() {\n    const now = new Date();\n    const hour = now.getHours();\n    const locations = Object.keys(LOCATION_SIZES);\n    // Determine current factors affecting density\n    let timeModifier = 1.0;\n    // Time of day adjustments\n    if (hour >= 22 || hour < 4) {\n        timeModifier = TIME_MODIFIERS.night;\n    } else if (hour >= 4 && hour < 6) {\n        timeModifier = TIME_MODIFIERS.earlyMorning;\n    } else if ([\n        5,\n        12,\n        15,\n        18,\n        20\n    ].includes(hour)) {\n        // Prayer times\n        timeModifier = TIME_MODIFIERS.duringPrayer;\n    } else if ([\n        6,\n        13,\n        16,\n        19,\n        21\n    ].includes(hour)) {\n        // After prayer\n        timeModifier = TIME_MODIFIERS.afterPrayer;\n    } else if ([\n        4,\n        11,\n        14,\n        17,\n        19\n    ].includes(hour)) {\n        // Before prayer\n        timeModifier = TIME_MODIFIERS.beforePrayer;\n    }\n    // Special time adjustments for specific locations\n    const jamarat_hours = [\n        6,\n        7,\n        8,\n        13,\n        14,\n        15,\n        16\n    ];\n    const tawaf_hours = [\n        5,\n        6,\n        7,\n        21,\n        22,\n        23\n    ];\n    // Hajj day simulation (based on month/day/hour)\n    // For demo purposes, we'll simulate one day of the week as Hajj day\n    const isHajjDay = now.getDay() === 5; // Friday for demo purposes\n    // For demo purposes, force \"Hajj day\" behavior when minutes are divisible by 3\n    const forcedHajjDay = now.getMinutes() % 3 === 0;\n    // Weather simulation (simplified)\n    // For demo, we'll base it on time of day in Mecca which is typically hot midday\n    let weatherModifier = 1.0;\n    if (hour >= 11 && hour <= 15) {\n        weatherModifier = WEATHER_MODIFIERS.hot;\n    } else if (hour >= 16 && hour <= 18) {\n        weatherModifier = WEATHER_MODIFIERS.pleasant;\n    }\n    // Determine current total pilgrim count - varies within the range\n    // Use minute of the hour to create some natural variation\n    const pilgrimVariation = now.getMinutes() / 60 * (TOTAL_PILGRIMS_MAX - TOTAL_PILGRIMS_MIN);\n    const currentTotalPilgrims = TOTAL_PILGRIMS_MIN + Math.floor(pilgrimVariation);\n    // Generate realistic crowd density for each location\n    const densityData = locations.map((locationName, index)=>{\n        const locationData = LOCATION_SIZES[locationName];\n        // Apply location-specific modifiers\n        let locationTimeModifier = timeModifier;\n        if (locationName === \"Jamaraat Bridge\" && jamarat_hours.includes(hour)) {\n            locationTimeModifier = TIME_MODIFIERS.jamarat;\n        } else if (locationName === \"Masjid al-Haram\" && tawaf_hours.includes(hour)) {\n            locationTimeModifier = TIME_MODIFIERS.tawaf;\n        } else if (locationName === \"Arafat\" && (isHajjDay || forcedHajjDay)) {\n            locationTimeModifier = TIME_MODIFIERS.hajjDay;\n        }\n        // Use deterministic calculations for density based on location and time\n        // instead of fully random to ensure consistent patterns\n        let baseOccupancyPercentage;\n        // Calculate location's portion of total pilgrims\n        const locationCapacityRatio = locationData.capacity / TOTAL_CAPACITY;\n        const baseExpectedPilgrims = currentTotalPilgrims * locationCapacityRatio;\n        // Each location has different baseline crowd patterns\n        switch(locationName){\n            case \"Masjid al-Haram\":\n                // Masjid al-Haram is consistently busier\n                baseOccupancyPercentage = 0.7 + hour % 3 * 0.1;\n                break;\n            case \"Jamaraat Bridge\":\n                // Jamarat is extremely busy during specific hours\n                if (jamarat_hours.includes(hour)) {\n                    baseOccupancyPercentage = 0.9;\n                } else {\n                    baseOccupancyPercentage = 0.5;\n                }\n                break;\n            case \"Mina\":\n                // Mina varies significantly by day\n                baseOccupancyPercentage = isHajjDay || forcedHajjDay ? 0.95 : 0.6;\n                break;\n            case \"Arafat\":\n                // Arafat is extremely busy on Hajj day, empty otherwise\n                baseOccupancyPercentage = isHajjDay || forcedHajjDay ? 0.98 : 0.3;\n                break;\n            case \"Muzdalifah\":\n                // Muzdalifah is busy in the evening\n                baseOccupancyPercentage = hour >= 18 && hour <= 23 ? 0.85 : 0.4;\n                break;\n            default:\n                // Use minutes/seconds as a seed for other locations to get variation\n                baseOccupancyPercentage = 0.4 + now.getMinutes() % 10 / 10;\n        }\n        // DEMO: For demonstration purposes, ensure we have a mix of all density levels\n        // Force some locations to specific density levels\n        if (index % 5 === 0) {\n            // Every 5th location (by order) is forced to high density\n            baseOccupancyPercentage = 0.9;\n            locationTimeModifier = 2.0;\n        } else if (index % 5 === 1) {\n            // Every 5th+1 location is forced to medium density\n            baseOccupancyPercentage = 0.7;\n            locationTimeModifier = 1.5;\n        } else if (index % 5 === 2) {\n            // Every 5th+2 location is forced to critical density\n            baseOccupancyPercentage = 1.0;\n            locationTimeModifier = 2.5;\n        } else if (index % 5 === 3) {\n            // Every 5th+3 location is forced to low density\n            baseOccupancyPercentage = 0.4;\n            locationTimeModifier = 1.0;\n        }\n        // Every 5th+4 location uses the natural calculation\n        // Apply all modifiers\n        const modifiedOccupancy = baseOccupancyPercentage * locationTimeModifier * weatherModifier;\n        // Add slight randomness (±5% instead of ±10% for more consistency)\n        const finalOccupancy = modifiedOccupancy * (0.95 + Math.random() * 0.1);\n        // Calculate actual crowd size based on occupancy percentage and capacity\n        const crowdSize = Math.floor(finalOccupancy * locationData.capacity);\n        // Calculate density (people per square meter)\n        const density = crowdSize / locationData.areaInSquareMeters;\n        // Determine density level based on thresholds\n        let densityLevel;\n        if (density <= DENSITY_THRESHOLDS.low) {\n            densityLevel = \"low\";\n        } else if (density <= DENSITY_THRESHOLDS.medium) {\n            densityLevel = \"medium\";\n        } else if (density <= DENSITY_THRESHOLDS.high) {\n            densityLevel = \"high\";\n        } else {\n            densityLevel = \"critical\";\n        }\n        // Generate section-specific data\n        const sectionData = locationData.sections.map((section)=>{\n            // Each section has slightly different occupancy\n            const sectionVariation = 0.9 + Math.random() * 0.2; // 90-110% of location average\n            const sectionDensity = density * sectionVariation;\n            // Determine section density level\n            let sectionDensityLevel;\n            if (sectionDensity <= DENSITY_THRESHOLDS.low) {\n                sectionDensityLevel = \"low\";\n            } else if (sectionDensity <= DENSITY_THRESHOLDS.medium) {\n                sectionDensityLevel = \"medium\";\n            } else if (sectionDensity <= DENSITY_THRESHOLDS.high) {\n                sectionDensityLevel = \"high\";\n            } else {\n                sectionDensityLevel = \"critical\";\n            }\n            return {\n                id: section.id,\n                name: section.name,\n                density: sectionDensity.toFixed(2),\n                density_level: sectionDensityLevel,\n                crowd_size: Math.floor(crowdSize * section.percentage)\n            };\n        });\n        // Add some randomness to the exact coordinates to represent different areas\n        const baseCoordinates = getBaseCoordinates(locationName);\n        const coordinates = {\n            lng: baseCoordinates.lng + (Math.random() * 0.0005 - 0.00025),\n            lat: baseCoordinates.lat + (Math.random() * 0.0005 - 0.00025)\n        };\n        return {\n            location_name: locationName,\n            coordinates: coordinates,\n            density: density.toFixed(2),\n            density_level: densityLevel,\n            crowd_size: crowdSize,\n            capacity: locationData.capacity,\n            occupancy_percentage: (finalOccupancy * 100).toFixed(1),\n            sections: sectionData,\n            timestamp: new Date().toISOString(),\n            meta_data: {\n                density: parseFloat(density.toFixed(2)),\n                capacity: locationData.capacity,\n                sections: sectionData,\n                current_total_pilgrims: currentTotalPilgrims\n            }\n        };\n    });\n    // Debug information about total pilgrim distribution\n    const totalCrowdSize = densityData.reduce((sum, location)=>sum + location.crowd_size, 0);\n    console.log(`Total pilgrims currently distributed: ${totalCrowdSize} (target: ${currentTotalPilgrims})`);\n    return densityData;\n}\n// Function to update database with calculated density\nasync function updateCrowdDensityData() {\n    try {\n        console.log(\"Starting updateCrowdDensityData\");\n        const densityData = await calculateRealisticCrowdDensities();\n        console.log(`Generated ${densityData.length} density data points`);\n        // Log density levels for debugging\n        console.log(\"Current density levels:\");\n        densityData.forEach((location)=>{\n            console.log(`${location.location_name}: ${location.density_level} (${location.density})`);\n        });\n        if (!_supabase__WEBPACK_IMPORTED_MODULE_0__.supabaseAdmin) {\n            console.log(\"Supabase admin client not available, returning calculated data directly\");\n            return {\n                success: true,\n                count: densityData.length,\n                data: densityData,\n                message: \"Database connection not available, using calculated data\"\n            };\n        }\n        // Clear existing data and insert new data\n        try {\n            console.log(\"Attempting to clear existing data\");\n            const { error: deleteError } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabaseAdmin.from(\"crowd_density\").delete().neq(\"id\", 0); // Delete all records\n            if (deleteError) {\n                console.error(\"Error clearing existing data:\", deleteError);\n                return {\n                    success: true,\n                    error: deleteError,\n                    data: densityData,\n                    count: densityData.length,\n                    message: \"Failed to clear existing data, but returning calculated data\"\n                };\n            }\n            // Insert new data\n            console.log(\"Preparing data for insertion\");\n            const upsertData = densityData.map((location)=>({\n                    location_name: location.location_name,\n                    coordinates: location.coordinates,\n                    density_level: location.density_level,\n                    updated_at: new Date().toISOString(),\n                    crowd_size: location.crowd_size,\n                    occupancy_percentage: location.occupancy_percentage,\n                    meta_data: {\n                        density: location.density,\n                        capacity: location.capacity,\n                        sections: location.sections,\n                        current_total_pilgrims: location.meta_data.current_total_pilgrims\n                    }\n                }));\n            console.log(\"Attempting to insert data into Supabase\");\n            const { error: insertError } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabaseAdmin.from(\"crowd_density\").insert(upsertData);\n            if (insertError) {\n                console.error(\"Error inserting crowd density data:\", insertError);\n                return {\n                    success: true,\n                    error: insertError,\n                    data: densityData,\n                    count: densityData.length,\n                    message: \"Failed to insert data, but returning calculated data\"\n                };\n            }\n            console.log(\"Successfully updated crowd density data\");\n            return {\n                success: true,\n                count: densityData.length,\n                data: densityData\n            };\n        } catch (dbError) {\n            console.error(\"Database operation error:\", dbError);\n            return {\n                success: true,\n                error: dbError,\n                data: densityData,\n                count: densityData.length,\n                message: \"Database error, but returning calculated data\"\n            };\n        }\n    } catch (error) {\n        console.error(\"Error in updateCrowdDensityData:\", error);\n        // Try to return calculated data directly as a fallback\n        try {\n            const directData = await calculateRealisticCrowdDensities();\n            return {\n                success: true,\n                error,\n                data: directData,\n                count: directData.length,\n                message: \"Error occurred but returning direct calculation\"\n            };\n        } catch (calcError) {\n            console.error(\"Failed even direct calculation:\", calcError);\n            return {\n                error: \"Complete calculation failure\"\n            };\n        }\n    }\n}\n// Helper function to get base coordinates for each location\nfunction getBaseCoordinates(locationName) {\n    const coordinatesMap = {\n        \"Masjid al-Haram\": {\n            lng: 39.826174,\n            lat: 21.422487\n        },\n        \"Mina\": {\n            lng: 39.892966,\n            lat: 21.413249\n        },\n        \"Jamaraat Bridge\": {\n            lng: 39.873485,\n            lat: 21.42365\n        },\n        \"Arafat\": {\n            lng: 39.984687,\n            lat: 21.355461\n        },\n        \"Muzdalifah\": {\n            lng: 39.936322,\n            lat: 21.383082\n        },\n        \"Mina Entrance Gate 1\": {\n            lng: 39.887235,\n            lat: 21.411856\n        },\n        \"Tent City Section A\": {\n            lng: 39.889124,\n            lat: 21.414501\n        },\n        \"Jamarat Central Access\": {\n            lng: 39.871952,\n            lat: 21.423850\n        }\n    };\n    return coordinatesMap[locationName] || {\n        lng: 39.826174,\n        lat: 21.422487\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixjQUFjLENBQUN2RCxhQUFhLElBQUk7UUFBRXdCLEtBQUs7UUFBV0MsS0FBSztJQUFVO0FBQzFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaGFqai1uYXZpZ2F0b3IvLi9zcmMvbGliL2Nyb3dkU2Vuc29ycy50cz9iZDRlIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFNpbXVsYXRlZCBjcm93ZCBkZW5zaXR5IHNlbnNvciBuZXR3b3JrIGZvciBIYWpqIHNpdGVzXG5pbXBvcnQgeyBzdXBhYmFzZUFkbWluIH0gZnJvbSAnLi9zdXBhYmFzZSc7XG5cbi8vIERlZmluZSB0eXBlcyBmb3Igb3VyIGxvY2F0aW9ucyBkYXRhXG50eXBlIExvY2F0aW9uU2VjdGlvbiA9IHtcbiAgaWQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBwZXJjZW50YWdlOiBudW1iZXI7XG59O1xuXG50eXBlIExvY2F0aW9uRGF0YSA9IHtcbiAgYXJlYUluU3F1YXJlTWV0ZXJzOiBudW1iZXI7XG4gIGNhcGFjaXR5OiBudW1iZXI7XG4gIHNlY3Rpb25zOiBMb2NhdGlvblNlY3Rpb25bXTtcbn07XG5cbnR5cGUgQ29vcmRpbmF0ZXMgPSB7XG4gIGxuZzogbnVtYmVyO1xuICBsYXQ6IG51bWJlcjtcbn07XG5cbnR5cGUgRGVuc2l0eUxldmVsID0gJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJyB8ICdjcml0aWNhbCc7XG5cbi8vIFRvdGFsIHBpbGdyaW1zIHJhbmdlOiAyNTAsMDAwIC0gMzUwLDAwMFxuY29uc3QgVE9UQUxfUElMR1JJTVNfTUlOID0gMjUwMDAwO1xuY29uc3QgVE9UQUxfUElMR1JJTVNfTUFYID0gMzUwMDAwO1xuY29uc3QgVE9UQUxfUElMR1JJTVNfQVZHID0gTWF0aC5mbG9vcigoVE9UQUxfUElMR1JJTVNfTUlOICsgVE9UQUxfUElMR1JJTVNfTUFYKSAvIDIpO1xuXG4vLyBEZWZpbmUgcGh5c2ljYWwgc3BhY2UgY2hhcmFjdGVyaXN0aWNzIGZvciBlYWNoIGxvY2F0aW9uXG5jb25zdCBMT0NBVElPTl9TSVpFUzogUmVjb3JkPHN0cmluZywgTG9jYXRpb25EYXRhPiA9IHtcbiAgJ01hc2ppZCBhbC1IYXJhbSc6IHtcbiAgICBhcmVhSW5TcXVhcmVNZXRlcnM6IDM1NjgwMCwgLy8gVG90YWwgYXJlYSBpbmNsdWRpbmcgZXhwYW5kZWQgcGFydHNcbiAgICBjYXBhY2l0eTogMTIwMDAwLCAvLyBNYXhpbXVtIGNhcGFjaXR5IGFkanVzdGVkIGZvciBwaWxncmltcyBjb3VudFxuICAgIHNlY3Rpb25zOiBbXG4gICAgICB7IGlkOiAnbWF0YWYnLCBuYW1lOiAnTWF0YWYgQXJlYScsIHBlcmNlbnRhZ2U6IDAuMTUgfSxcbiAgICAgIHsgaWQ6ICdncm91bmQnLCBuYW1lOiAnR3JvdW5kIEZsb29yJywgcGVyY2VudGFnZTogMC40NSB9LFxuICAgICAgeyBpZDogJ2ZpcnN0JywgbmFtZTogJ0ZpcnN0IEZsb29yJywgcGVyY2VudGFnZTogMC4yNSB9LFxuICAgICAgeyBpZDogJ3Jvb2YnLCBuYW1lOiAnUm9vZiBBcmVhJywgcGVyY2VudGFnZTogMC4xNSB9XG4gICAgXVxuICB9LFxuICAnTWluYSc6IHtcbiAgICBhcmVhSW5TcXVhcmVNZXRlcnM6IDgxMjAwMCxcbiAgICBjYXBhY2l0eTogMjQwMDAwLCAvLyBBZGp1c3RlZCBmb3IgcGlsZ3JpbXMgY291bnRcbiAgICBzZWN0aW9uczogW1xuICAgICAgeyBpZDogJ3RlbnRzLWEnLCBuYW1lOiAnVGVudHMgQXJlYSBBJywgcGVyY2VudGFnZTogMC4zIH0sXG4gICAgICB7IGlkOiAndGVudHMtYicsIG5hbWU6ICdUZW50cyBBcmVhIEInLCBwZXJjZW50YWdlOiAwLjMgfSxcbiAgICAgIHsgaWQ6ICd0ZW50cy1jJywgbmFtZTogJ1RlbnRzIEFyZWEgQycsIHBlcmNlbnRhZ2U6IDAuMyB9LFxuICAgICAgeyBpZDogJ3NlcnZpY2VzJywgbmFtZTogJ1NlcnZpY2VzIEFyZWEnLCBwZXJjZW50YWdlOiAwLjEgfVxuICAgIF1cbiAgfSxcbiAgJ0phbWFyYWF0IEJyaWRnZSc6IHtcbiAgICBhcmVhSW5TcXVhcmVNZXRlcnM6IDUyMDAwLFxuICAgIGNhcGFjaXR5OiAxMDAwMDAsIC8vIEhvdXJseSBjYXBhY2l0eSBhZGp1c3RlZFxuICAgIHNlY3Rpb25zOiBbXG4gICAgICB7IGlkOiAnbG93ZXInLCBuYW1lOiAnTG93ZXIgTGV2ZWwnLCBwZXJjZW50YWdlOiAwLjMgfSxcbiAgICAgIHsgaWQ6ICdtaWRkbGUnLCBuYW1lOiAnTWlkZGxlIExldmVsJywgcGVyY2VudGFnZTogMC40IH0sXG4gICAgICB7IGlkOiAndXBwZXInLCBuYW1lOiAnVXBwZXIgTGV2ZWwnLCBwZXJjZW50YWdlOiAwLjMgfVxuICAgIF1cbiAgfSxcbiAgJ0FyYWZhdCc6IHtcbiAgICBhcmVhSW5TcXVhcmVNZXRlcnM6IDE0NTYwMDAsXG4gICAgY2FwYWNpdHk6IDMwMDAwMCwgLy8gQWRqdXN0ZWQgZm9yIHBpbGdyaW1zIGNvdW50XG4gICAgc2VjdGlvbnM6IFtcbiAgICAgIHsgaWQ6ICdqYWJhbCcsIG5hbWU6ICdKYWJhbCBhbC1SYWhtYWgnLCBwZXJjZW50YWdlOiAwLjIgfSxcbiAgICAgIHsgaWQ6ICduaW1yYWgnLCBuYW1lOiAnTmltcmFoJywgcGVyY2VudGFnZTogMC4zIH0sXG4gICAgICB7IGlkOiAndXJhbmFoJywgbmFtZTogJ1VyYW5haCcsIHBlcmNlbnRhZ2U6IDAuMjUgfSxcbiAgICAgIHsgaWQ6ICdvdGhlcicsIG5hbWU6ICdPdGhlciBBcmVhcycsIHBlcmNlbnRhZ2U6IDAuMjUgfVxuICAgIF1cbiAgfSxcbiAgJ011emRhbGlmYWgnOiB7XG4gICAgYXJlYUluU3F1YXJlTWV0ZXJzOiA2MjMwMDAsXG4gICAgY2FwYWNpdHk6IDI1MDAwMCwgLy8gQWRqdXN0ZWQgZm9yIHBpbGdyaW1zIGNvdW50XG4gICAgc2VjdGlvbnM6IFtcbiAgICAgIHsgaWQ6ICdtYXNoJywgbmFtZTogJ0FsLU1hc2hcXCdhciBhbC1IYXJhbScsIHBlcmNlbnRhZ2U6IDAuMyB9LFxuICAgICAgeyBpZDogJ25vcnRoJywgbmFtZTogJ05vcnRoZXJuIEFyZWEnLCBwZXJjZW50YWdlOiAwLjM1IH0sXG4gICAgICB7IGlkOiAnc291dGgnLCBuYW1lOiAnU291dGhlcm4gQXJlYScsIHBlcmNlbnRhZ2U6IDAuMzUgfVxuICAgIF1cbiAgfSxcbiAgLy8gQWRkaXRpb25hbCBsb2NhdGlvbnNcbiAgJ01pbmEgRW50cmFuY2UgR2F0ZSAxJzoge1xuICAgIGFyZWFJblNxdWFyZU1ldGVyczogMzAwMCxcbiAgICBjYXBhY2l0eTogMTUwMDAsIC8vIEhvdXJseSBjYXBhY2l0eVxuICAgIHNlY3Rpb25zOiBbXG4gICAgICB7IGlkOiAnZW50cnknLCBuYW1lOiAnRW50cnkgUG9pbnRzJywgcGVyY2VudGFnZTogMC40IH0sXG4gICAgICB7IGlkOiAnc2VjdXJpdHknLCBuYW1lOiAnU2VjdXJpdHkgQ2hlY2snLCBwZXJjZW50YWdlOiAwLjMgfSxcbiAgICAgIHsgaWQ6ICd3YWl0aW5nJywgbmFtZTogJ1dhaXRpbmcgQXJlYScsIHBlcmNlbnRhZ2U6IDAuMyB9XG4gICAgXVxuICB9LFxuICAnVGVudCBDaXR5IFNlY3Rpb24gQSc6IHtcbiAgICBhcmVhSW5TcXVhcmVNZXRlcnM6IDEyMDAwMCxcbiAgICBjYXBhY2l0eTogODAwMDAsIC8vIEFkanVzdGVkIGZvciBwaWxncmltcyBjb3VudFxuICAgIHNlY3Rpb25zOiBbXG4gICAgICB7IGlkOiAnYTEnLCBuYW1lOiAnQmxvY2sgQTEnLCBwZXJjZW50YWdlOiAwLjI1IH0sXG4gICAgICB7IGlkOiAnYTInLCBuYW1lOiAnQmxvY2sgQTInLCBwZXJjZW50YWdlOiAwLjI1IH0sXG4gICAgICB7IGlkOiAnYTMnLCBuYW1lOiAnQmxvY2sgQTMnLCBwZXJjZW50YWdlOiAwLjI1IH0sXG4gICAgICB7IGlkOiAnYTQnLCBuYW1lOiAnQmxvY2sgQTQnLCBwZXJjZW50YWdlOiAwLjI1IH1cbiAgICBdXG4gIH0sXG4gICdKYW1hcmF0IENlbnRyYWwgQWNjZXNzJzoge1xuICAgIGFyZWFJblNxdWFyZU1ldGVyczogODAwMCxcbiAgICBjYXBhY2l0eTogMzAwMDAsIC8vIEhvdXJseSBjYXBhY2l0eVxuICAgIHNlY3Rpb25zOiBbXG4gICAgICB7IGlkOiAnZW50cnknLCBuYW1lOiAnRW50cnkgWm9uZScsIHBlcmNlbnRhZ2U6IDAuNCB9LFxuICAgICAgeyBpZDogJ2NvcnJpZG9yJywgbmFtZTogJ01haW4gQ29ycmlkb3InLCBwZXJjZW50YWdlOiAwLjQgfSxcbiAgICAgIHsgaWQ6ICdleGl0JywgbmFtZTogJ0V4aXQgWm9uZScsIHBlcmNlbnRhZ2U6IDAuMiB9XG4gICAgXVxuICB9LFxufTtcblxuLy8gQ2FsY3VsYXRlIHRoZSBzdW0gb2YgYWxsIGxvY2F0aW9uIGNhcGFjaXRpZXMgdG8gdmVyaWZ5IGFnYWluc3QgdG90YWwgcGlsZ3JpbXNcbmNvbnN0IFRPVEFMX0NBUEFDSVRZID0gT2JqZWN0LnZhbHVlcyhMT0NBVElPTl9TSVpFUykucmVkdWNlKFxuICAoc3VtLCBsb2NhdGlvbikgPT4gc3VtICsgbG9jYXRpb24uY2FwYWNpdHksIFxuICAwXG4pO1xuXG4vLyBEZWZpbmUgZGVuc2l0eSB0aHJlc2hvbGQgbGV2ZWxzIChwZW9wbGUgcGVyIHNxdWFyZSBtZXRlcilcbi8vIEFkanVzdGVkIGZvciB0aGUgcGlsZ3JpbXMgY291bnQgb2YgMjUwLDAwMC0zNTAsMDAwXG5jb25zdCBERU5TSVRZX1RIUkVTSE9MRFMgPSB7XG4gIGxvdzogMC4zLCAvLyAwLTAuMyBwZW9wbGUgcGVyIHNxdWFyZSBtZXRlciAtIGNvbWZvcnRhYmxlIG1vdmVtZW50XG4gIG1lZGl1bTogMC44LCAvLyAwLjMtMC44IHBlb3BsZSBwZXIgc3F1YXJlIG1ldGVyIC0gbW9kZXJhdGUgZGVuc2l0eVxuICBoaWdoOiAxLjUsIC8vIDAuOC0xLjUgcGVvcGxlIHBlciBzcXVhcmUgbWV0ZXIgLSBoaWdoIGRlbnNpdHkgYnV0IG1hbmFnZWFibGVcbiAgLy8gQWJvdmUgMS41IGlzIGNvbnNpZGVyZWQgY3JpdGljYWwgLSBkaWZmaWN1bHQgbW92ZW1lbnRcbn07XG5cbi8vIFRpbWUtYmFzZWQgbW9kaWZpZXJzIGZvciB2YXJpb3VzIEhhamogcGVyaW9kcyAtIGluY3JlYXNlL2RlY3JlYXNlIG11bHRpcGxpZXJcbmNvbnN0IFRJTUVfTU9ESUZJRVJTID0ge1xuICBiZWZvcmVQcmF5ZXI6IDIuMCwgLy8gQmVmb3JlIHByYXllciB0aW1lc1xuICBkdXJpbmdQcmF5ZXI6IDIuNSwgLy8gRHVyaW5nIHByYXllciB0aW1lcyBpbiBNYXNqaWQgYWwtSGFyYW1cbiAgYWZ0ZXJQcmF5ZXI6IDEuOCwgLy8gQWZ0ZXIgcHJheWVyIGRpc3BlcnNhbFxuICBqYW1hcmF0OiAzLjAsIC8vIER1cmluZyBzdG9uaW5nIHJpdHVhbCB0aW1lc1xuICB0YXdhZjogMi41LCAvLyBEdXJpbmcgcGVhayBUYXdhZiBob3Vyc1xuICBzYXllZTogMi4wLCAvLyBEdXJpbmcgcGVhayBTYSdlZSBob3Vyc1xuICBuaWdodDogMC43LCAvLyBMYXRlIG5pZ2h0IGhvdXJzXG4gIGVhcmx5TW9ybmluZzogMC44LCAvLyBFYXJseSBtb3JuaW5nIGhvdXJzXG4gIGhhampEYXk6IDMuMCwgLy8gTWFpbiBIYWpqIGRheSBhdCBBcmFmYXRcbn07XG5cbi8vIFdlYXRoZXIgaW1wYWN0cyBvbiBjcm93ZCBiZWhhdmlvclxuY29uc3QgV0VBVEhFUl9NT0RJRklFUlMgPSB7XG4gIGhvdDogMC45LCAvLyBWZXJ5IGhvdCB3ZWF0aGVyIHJlZHVjZXMgb3V0ZG9vciBkZW5zaXRpZXNcbiAgcmFpbjogMC43LCAvLyBSYWluIHJlZHVjZXMgb3V0ZG9vciBkZW5zaXRpZXMgXG4gIHBsZWFzYW50OiAxLjIsIC8vIFBsZWFzYW50IHdlYXRoZXIgaW5jcmVhc2VzIG1vdmVtZW50XG59O1xuXG4vLyBGdW5jdGlvbiB0byBnZXQgcmVhbGlzdGljIGNyb3dkIGRlbnNpdGllcyBiYXNlZCBvbiB2YXJpb3VzIGZhY3RvcnNcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjYWxjdWxhdGVSZWFsaXN0aWNDcm93ZERlbnNpdGllcygpIHtcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgY29uc3QgaG91ciA9IG5vdy5nZXRIb3VycygpO1xuICBjb25zdCBsb2NhdGlvbnMgPSBPYmplY3Qua2V5cyhMT0NBVElPTl9TSVpFUyk7XG4gIFxuICAvLyBEZXRlcm1pbmUgY3VycmVudCBmYWN0b3JzIGFmZmVjdGluZyBkZW5zaXR5XG4gIGxldCB0aW1lTW9kaWZpZXIgPSAxLjA7XG4gIFxuICAvLyBUaW1lIG9mIGRheSBhZGp1c3RtZW50c1xuICBpZiAoaG91ciA+PSAyMiB8fCBob3VyIDwgNCkge1xuICAgIHRpbWVNb2RpZmllciA9IFRJTUVfTU9ESUZJRVJTLm5pZ2h0O1xuICB9IGVsc2UgaWYgKGhvdXIgPj0gNCAmJiBob3VyIDwgNikge1xuICAgIHRpbWVNb2RpZmllciA9IFRJTUVfTU9ESUZJRVJTLmVhcmx5TW9ybmluZztcbiAgfSBlbHNlIGlmIChbNSwgMTIsIDE1LCAxOCwgMjBdLmluY2x1ZGVzKGhvdXIpKSB7XG4gICAgLy8gUHJheWVyIHRpbWVzXG4gICAgdGltZU1vZGlmaWVyID0gVElNRV9NT0RJRklFUlMuZHVyaW5nUHJheWVyO1xuICB9IGVsc2UgaWYgKFs2LCAxMywgMTYsIDE5LCAyMV0uaW5jbHVkZXMoaG91cikpIHtcbiAgICAvLyBBZnRlciBwcmF5ZXJcbiAgICB0aW1lTW9kaWZpZXIgPSBUSU1FX01PRElGSUVSUy5hZnRlclByYXllcjtcbiAgfSBlbHNlIGlmIChbNCwgMTEsIDE0LCAxNywgMTldLmluY2x1ZGVzKGhvdXIpKSB7XG4gICAgLy8gQmVmb3JlIHByYXllclxuICAgIHRpbWVNb2RpZmllciA9IFRJTUVfTU9ESUZJRVJTLmJlZm9yZVByYXllcjtcbiAgfVxuICBcbiAgLy8gU3BlY2lhbCB0aW1lIGFkanVzdG1lbnRzIGZvciBzcGVjaWZpYyBsb2NhdGlvbnNcbiAgY29uc3QgamFtYXJhdF9ob3VycyA9IFs2LCA3LCA4LCAxMywgMTQsIDE1LCAxNl07XG4gIGNvbnN0IHRhd2FmX2hvdXJzID0gWzUsIDYsIDcsIDIxLCAyMiwgMjNdO1xuICBcbiAgLy8gSGFqaiBkYXkgc2ltdWxhdGlvbiAoYmFzZWQgb24gbW9udGgvZGF5L2hvdXIpXG4gIC8vIEZvciBkZW1vIHB1cnBvc2VzLCB3ZSdsbCBzaW11bGF0ZSBvbmUgZGF5IG9mIHRoZSB3ZWVrIGFzIEhhamogZGF5XG4gIGNvbnN0IGlzSGFqakRheSA9IG5vdy5nZXREYXkoKSA9PT0gNTsgLy8gRnJpZGF5IGZvciBkZW1vIHB1cnBvc2VzXG4gIFxuICAvLyBGb3IgZGVtbyBwdXJwb3NlcywgZm9yY2UgXCJIYWpqIGRheVwiIGJlaGF2aW9yIHdoZW4gbWludXRlcyBhcmUgZGl2aXNpYmxlIGJ5IDNcbiAgY29uc3QgZm9yY2VkSGFqakRheSA9IG5vdy5nZXRNaW51dGVzKCkgJSAzID09PSAwO1xuICBcbiAgLy8gV2VhdGhlciBzaW11bGF0aW9uIChzaW1wbGlmaWVkKVxuICAvLyBGb3IgZGVtbywgd2UnbGwgYmFzZSBpdCBvbiB0aW1lIG9mIGRheSBpbiBNZWNjYSB3aGljaCBpcyB0eXBpY2FsbHkgaG90IG1pZGRheVxuICBsZXQgd2VhdGhlck1vZGlmaWVyID0gMS4wO1xuICBpZiAoaG91ciA+PSAxMSAmJiBob3VyIDw9IDE1KSB7XG4gICAgd2VhdGhlck1vZGlmaWVyID0gV0VBVEhFUl9NT0RJRklFUlMuaG90O1xuICB9IGVsc2UgaWYgKGhvdXIgPj0gMTYgJiYgaG91ciA8PSAxOCkge1xuICAgIHdlYXRoZXJNb2RpZmllciA9IFdFQVRIRVJfTU9ESUZJRVJTLnBsZWFzYW50O1xuICB9XG4gIFxuICAvLyBEZXRlcm1pbmUgY3VycmVudCB0b3RhbCBwaWxncmltIGNvdW50IC0gdmFyaWVzIHdpdGhpbiB0aGUgcmFuZ2VcbiAgLy8gVXNlIG1pbnV0ZSBvZiB0aGUgaG91ciB0byBjcmVhdGUgc29tZSBuYXR1cmFsIHZhcmlhdGlvblxuICBjb25zdCBwaWxncmltVmFyaWF0aW9uID0gKG5vdy5nZXRNaW51dGVzKCkgLyA2MCkgKiAoVE9UQUxfUElMR1JJTVNfTUFYIC0gVE9UQUxfUElMR1JJTVNfTUlOKTtcbiAgY29uc3QgY3VycmVudFRvdGFsUGlsZ3JpbXMgPSBUT1RBTF9QSUxHUklNU19NSU4gKyBNYXRoLmZsb29yKHBpbGdyaW1WYXJpYXRpb24pO1xuICBcbiAgLy8gR2VuZXJhdGUgcmVhbGlzdGljIGNyb3dkIGRlbnNpdHkgZm9yIGVhY2ggbG9jYXRpb25cbiAgY29uc3QgZGVuc2l0eURhdGEgPSBsb2NhdGlvbnMubWFwKChsb2NhdGlvbk5hbWUsIGluZGV4KSA9PiB7XG4gICAgY29uc3QgbG9jYXRpb25EYXRhID0gTE9DQVRJT05fU0laRVNbbG9jYXRpb25OYW1lXTtcbiAgICBcbiAgICAvLyBBcHBseSBsb2NhdGlvbi1zcGVjaWZpYyBtb2RpZmllcnNcbiAgICBsZXQgbG9jYXRpb25UaW1lTW9kaWZpZXIgPSB0aW1lTW9kaWZpZXI7XG4gICAgXG4gICAgaWYgKGxvY2F0aW9uTmFtZSA9PT0gJ0phbWFyYWF0IEJyaWRnZScgJiYgamFtYXJhdF9ob3Vycy5pbmNsdWRlcyhob3VyKSkge1xuICAgICAgbG9jYXRpb25UaW1lTW9kaWZpZXIgPSBUSU1FX01PRElGSUVSUy5qYW1hcmF0O1xuICAgIH0gZWxzZSBpZiAobG9jYXRpb25OYW1lID09PSAnTWFzamlkIGFsLUhhcmFtJyAmJiB0YXdhZl9ob3Vycy5pbmNsdWRlcyhob3VyKSkge1xuICAgICAgbG9jYXRpb25UaW1lTW9kaWZpZXIgPSBUSU1FX01PRElGSUVSUy50YXdhZjtcbiAgICB9IGVsc2UgaWYgKGxvY2F0aW9uTmFtZSA9PT0gJ0FyYWZhdCcgJiYgKGlzSGFqakRheSB8fCBmb3JjZWRIYWpqRGF5KSkge1xuICAgICAgbG9jYXRpb25UaW1lTW9kaWZpZXIgPSBUSU1FX01PRElGSUVSUy5oYWpqRGF5O1xuICAgIH1cbiAgICBcbiAgICAvLyBVc2UgZGV0ZXJtaW5pc3RpYyBjYWxjdWxhdGlvbnMgZm9yIGRlbnNpdHkgYmFzZWQgb24gbG9jYXRpb24gYW5kIHRpbWVcbiAgICAvLyBpbnN0ZWFkIG9mIGZ1bGx5IHJhbmRvbSB0byBlbnN1cmUgY29uc2lzdGVudCBwYXR0ZXJuc1xuICAgIGxldCBiYXNlT2NjdXBhbmN5UGVyY2VudGFnZTtcbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgbG9jYXRpb24ncyBwb3J0aW9uIG9mIHRvdGFsIHBpbGdyaW1zXG4gICAgY29uc3QgbG9jYXRpb25DYXBhY2l0eVJhdGlvID0gbG9jYXRpb25EYXRhLmNhcGFjaXR5IC8gVE9UQUxfQ0FQQUNJVFk7XG4gICAgY29uc3QgYmFzZUV4cGVjdGVkUGlsZ3JpbXMgPSBjdXJyZW50VG90YWxQaWxncmltcyAqIGxvY2F0aW9uQ2FwYWNpdHlSYXRpbztcbiAgICBcbiAgICAvLyBFYWNoIGxvY2F0aW9uIGhhcyBkaWZmZXJlbnQgYmFzZWxpbmUgY3Jvd2QgcGF0dGVybnNcbiAgICBzd2l0Y2ggKGxvY2F0aW9uTmFtZSkge1xuICAgICAgY2FzZSAnTWFzamlkIGFsLUhhcmFtJzpcbiAgICAgICAgLy8gTWFzamlkIGFsLUhhcmFtIGlzIGNvbnNpc3RlbnRseSBidXNpZXJcbiAgICAgICAgYmFzZU9jY3VwYW5jeVBlcmNlbnRhZ2UgPSAwLjcgKyAoaG91ciAlIDMpICogMC4xO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ0phbWFyYWF0IEJyaWRnZSc6XG4gICAgICAgIC8vIEphbWFyYXQgaXMgZXh0cmVtZWx5IGJ1c3kgZHVyaW5nIHNwZWNpZmljIGhvdXJzXG4gICAgICAgIGlmIChqYW1hcmF0X2hvdXJzLmluY2x1ZGVzKGhvdXIpKSB7XG4gICAgICAgICAgYmFzZU9jY3VwYW5jeVBlcmNlbnRhZ2UgPSAwLjk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYmFzZU9jY3VwYW5jeVBlcmNlbnRhZ2UgPSAwLjU7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdNaW5hJzpcbiAgICAgICAgLy8gTWluYSB2YXJpZXMgc2lnbmlmaWNhbnRseSBieSBkYXlcbiAgICAgICAgYmFzZU9jY3VwYW5jeVBlcmNlbnRhZ2UgPSAoaXNIYWpqRGF5IHx8IGZvcmNlZEhhampEYXkpID8gMC45NSA6IDAuNjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdBcmFmYXQnOlxuICAgICAgICAvLyBBcmFmYXQgaXMgZXh0cmVtZWx5IGJ1c3kgb24gSGFqaiBkYXksIGVtcHR5IG90aGVyd2lzZVxuICAgICAgICBiYXNlT2NjdXBhbmN5UGVyY2VudGFnZSA9IChpc0hhampEYXkgfHwgZm9yY2VkSGFqakRheSkgPyAwLjk4IDogMC4zO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ011emRhbGlmYWgnOlxuICAgICAgICAvLyBNdXpkYWxpZmFoIGlzIGJ1c3kgaW4gdGhlIGV2ZW5pbmdcbiAgICAgICAgYmFzZU9jY3VwYW5jeVBlcmNlbnRhZ2UgPSAoaG91ciA+PSAxOCAmJiBob3VyIDw9IDIzKSA/IDAuODUgOiAwLjQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgLy8gVXNlIG1pbnV0ZXMvc2Vjb25kcyBhcyBhIHNlZWQgZm9yIG90aGVyIGxvY2F0aW9ucyB0byBnZXQgdmFyaWF0aW9uXG4gICAgICAgIGJhc2VPY2N1cGFuY3lQZXJjZW50YWdlID0gMC40ICsgKG5vdy5nZXRNaW51dGVzKCkgJSAxMCkgLyAxMDtcbiAgICB9XG4gICAgXG4gICAgLy8gREVNTzogRm9yIGRlbW9uc3RyYXRpb24gcHVycG9zZXMsIGVuc3VyZSB3ZSBoYXZlIGEgbWl4IG9mIGFsbCBkZW5zaXR5IGxldmVsc1xuICAgIC8vIEZvcmNlIHNvbWUgbG9jYXRpb25zIHRvIHNwZWNpZmljIGRlbnNpdHkgbGV2ZWxzXG4gICAgaWYgKGluZGV4ICUgNSA9PT0gMCkge1xuICAgICAgLy8gRXZlcnkgNXRoIGxvY2F0aW9uIChieSBvcmRlcikgaXMgZm9yY2VkIHRvIGhpZ2ggZGVuc2l0eVxuICAgICAgYmFzZU9jY3VwYW5jeVBlcmNlbnRhZ2UgPSAwLjk7XG4gICAgICBsb2NhdGlvblRpbWVNb2RpZmllciA9IDIuMDtcbiAgICB9IGVsc2UgaWYgKGluZGV4ICUgNSA9PT0gMSkge1xuICAgICAgLy8gRXZlcnkgNXRoKzEgbG9jYXRpb24gaXMgZm9yY2VkIHRvIG1lZGl1bSBkZW5zaXR5XG4gICAgICBiYXNlT2NjdXBhbmN5UGVyY2VudGFnZSA9IDAuNztcbiAgICAgIGxvY2F0aW9uVGltZU1vZGlmaWVyID0gMS41O1xuICAgIH0gZWxzZSBpZiAoaW5kZXggJSA1ID09PSAyKSB7XG4gICAgICAvLyBFdmVyeSA1dGgrMiBsb2NhdGlvbiBpcyBmb3JjZWQgdG8gY3JpdGljYWwgZGVuc2l0eVxuICAgICAgYmFzZU9jY3VwYW5jeVBlcmNlbnRhZ2UgPSAxLjA7XG4gICAgICBsb2NhdGlvblRpbWVNb2RpZmllciA9IDIuNTtcbiAgICB9IGVsc2UgaWYgKGluZGV4ICUgNSA9PT0gMykge1xuICAgICAgLy8gRXZlcnkgNXRoKzMgbG9jYXRpb24gaXMgZm9yY2VkIHRvIGxvdyBkZW5zaXR5XG4gICAgICBiYXNlT2NjdXBhbmN5UGVyY2VudGFnZSA9IDAuNDtcbiAgICAgIGxvY2F0aW9uVGltZU1vZGlmaWVyID0gMS4wO1xuICAgIH1cbiAgICAvLyBFdmVyeSA1dGgrNCBsb2NhdGlvbiB1c2VzIHRoZSBuYXR1cmFsIGNhbGN1bGF0aW9uXG4gICAgXG4gICAgLy8gQXBwbHkgYWxsIG1vZGlmaWVyc1xuICAgIGNvbnN0IG1vZGlmaWVkT2NjdXBhbmN5ID0gYmFzZU9jY3VwYW5jeVBlcmNlbnRhZ2UgKiBsb2NhdGlvblRpbWVNb2RpZmllciAqIHdlYXRoZXJNb2RpZmllcjtcbiAgICBcbiAgICAvLyBBZGQgc2xpZ2h0IHJhbmRvbW5lc3MgKMKxNSUgaW5zdGVhZCBvZiDCsTEwJSBmb3IgbW9yZSBjb25zaXN0ZW5jeSlcbiAgICBjb25zdCBmaW5hbE9jY3VwYW5jeSA9IG1vZGlmaWVkT2NjdXBhbmN5ICogKDAuOTUgKyBNYXRoLnJhbmRvbSgpICogMC4xKTtcbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgYWN0dWFsIGNyb3dkIHNpemUgYmFzZWQgb24gb2NjdXBhbmN5IHBlcmNlbnRhZ2UgYW5kIGNhcGFjaXR5XG4gICAgY29uc3QgY3Jvd2RTaXplID0gTWF0aC5mbG9vcihmaW5hbE9jY3VwYW5jeSAqIGxvY2F0aW9uRGF0YS5jYXBhY2l0eSk7XG4gICAgXG4gICAgLy8gQ2FsY3VsYXRlIGRlbnNpdHkgKHBlb3BsZSBwZXIgc3F1YXJlIG1ldGVyKVxuICAgIGNvbnN0IGRlbnNpdHkgPSBjcm93ZFNpemUgLyBsb2NhdGlvbkRhdGEuYXJlYUluU3F1YXJlTWV0ZXJzO1xuICAgIFxuICAgIC8vIERldGVybWluZSBkZW5zaXR5IGxldmVsIGJhc2VkIG9uIHRocmVzaG9sZHNcbiAgICBsZXQgZGVuc2l0eUxldmVsOiBEZW5zaXR5TGV2ZWw7XG4gICAgaWYgKGRlbnNpdHkgPD0gREVOU0lUWV9USFJFU0hPTERTLmxvdykge1xuICAgICAgZGVuc2l0eUxldmVsID0gJ2xvdyc7XG4gICAgfSBlbHNlIGlmIChkZW5zaXR5IDw9IERFTlNJVFlfVEhSRVNIT0xEUy5tZWRpdW0pIHtcbiAgICAgIGRlbnNpdHlMZXZlbCA9ICdtZWRpdW0nO1xuICAgIH0gZWxzZSBpZiAoZGVuc2l0eSA8PSBERU5TSVRZX1RIUkVTSE9MRFMuaGlnaCkge1xuICAgICAgZGVuc2l0eUxldmVsID0gJ2hpZ2gnO1xuICAgIH0gZWxzZSB7XG4gICAgICBkZW5zaXR5TGV2ZWwgPSAnY3JpdGljYWwnO1xuICAgIH1cbiAgICBcbiAgICAvLyBHZW5lcmF0ZSBzZWN0aW9uLXNwZWNpZmljIGRhdGFcbiAgICBjb25zdCBzZWN0aW9uRGF0YSA9IGxvY2F0aW9uRGF0YS5zZWN0aW9ucy5tYXAoKHNlY3Rpb246IExvY2F0aW9uU2VjdGlvbikgPT4ge1xuICAgICAgLy8gRWFjaCBzZWN0aW9uIGhhcyBzbGlnaHRseSBkaWZmZXJlbnQgb2NjdXBhbmN5XG4gICAgICBjb25zdCBzZWN0aW9uVmFyaWF0aW9uID0gMC45ICsgTWF0aC5yYW5kb20oKSAqIDAuMjsgLy8gOTAtMTEwJSBvZiBsb2NhdGlvbiBhdmVyYWdlXG4gICAgICBjb25zdCBzZWN0aW9uRGVuc2l0eSA9IGRlbnNpdHkgKiBzZWN0aW9uVmFyaWF0aW9uO1xuICAgICAgXG4gICAgICAvLyBEZXRlcm1pbmUgc2VjdGlvbiBkZW5zaXR5IGxldmVsXG4gICAgICBsZXQgc2VjdGlvbkRlbnNpdHlMZXZlbDogRGVuc2l0eUxldmVsO1xuICAgICAgaWYgKHNlY3Rpb25EZW5zaXR5IDw9IERFTlNJVFlfVEhSRVNIT0xEUy5sb3cpIHtcbiAgICAgICAgc2VjdGlvbkRlbnNpdHlMZXZlbCA9ICdsb3cnO1xuICAgICAgfSBlbHNlIGlmIChzZWN0aW9uRGVuc2l0eSA8PSBERU5TSVRZX1RIUkVTSE9MRFMubWVkaXVtKSB7XG4gICAgICAgIHNlY3Rpb25EZW5zaXR5TGV2ZWwgPSAnbWVkaXVtJztcbiAgICAgIH0gZWxzZSBpZiAoc2VjdGlvbkRlbnNpdHkgPD0gREVOU0lUWV9USFJFU0hPTERTLmhpZ2gpIHtcbiAgICAgICAgc2VjdGlvbkRlbnNpdHlMZXZlbCA9ICdoaWdoJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNlY3Rpb25EZW5zaXR5TGV2ZWwgPSAnY3JpdGljYWwnO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpZDogc2VjdGlvbi5pZCxcbiAgICAgICAgbmFtZTogc2VjdGlvbi5uYW1lLFxuICAgICAgICBkZW5zaXR5OiBzZWN0aW9uRGVuc2l0eS50b0ZpeGVkKDIpLFxuICAgICAgICBkZW5zaXR5X2xldmVsOiBzZWN0aW9uRGVuc2l0eUxldmVsLFxuICAgICAgICBjcm93ZF9zaXplOiBNYXRoLmZsb29yKGNyb3dkU2l6ZSAqIHNlY3Rpb24ucGVyY2VudGFnZSksXG4gICAgICB9O1xuICAgIH0pO1xuICAgIFxuICAgIC8vIEFkZCBzb21lIHJhbmRvbW5lc3MgdG8gdGhlIGV4YWN0IGNvb3JkaW5hdGVzIHRvIHJlcHJlc2VudCBkaWZmZXJlbnQgYXJlYXNcbiAgICBjb25zdCBiYXNlQ29vcmRpbmF0ZXMgPSBnZXRCYXNlQ29vcmRpbmF0ZXMobG9jYXRpb25OYW1lKTtcbiAgICBjb25zdCBjb29yZGluYXRlcyA9IHtcbiAgICAgIGxuZzogYmFzZUNvb3JkaW5hdGVzLmxuZyArIChNYXRoLnJhbmRvbSgpICogMC4wMDA1IC0gMC4wMDAyNSksXG4gICAgICBsYXQ6IGJhc2VDb29yZGluYXRlcy5sYXQgKyAoTWF0aC5yYW5kb20oKSAqIDAuMDAwNSAtIDAuMDAwMjUpXG4gICAgfTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgbG9jYXRpb25fbmFtZTogbG9jYXRpb25OYW1lLFxuICAgICAgY29vcmRpbmF0ZXM6IGNvb3JkaW5hdGVzLFxuICAgICAgZGVuc2l0eTogZGVuc2l0eS50b0ZpeGVkKDIpLFxuICAgICAgZGVuc2l0eV9sZXZlbDogZGVuc2l0eUxldmVsLFxuICAgICAgY3Jvd2Rfc2l6ZTogY3Jvd2RTaXplLFxuICAgICAgY2FwYWNpdHk6IGxvY2F0aW9uRGF0YS5jYXBhY2l0eSxcbiAgICAgIG9jY3VwYW5jeV9wZXJjZW50YWdlOiAoZmluYWxPY2N1cGFuY3kgKiAxMDApLnRvRml4ZWQoMSksXG4gICAgICBzZWN0aW9uczogc2VjdGlvbkRhdGEsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIG1ldGFfZGF0YToge1xuICAgICAgICBkZW5zaXR5OiBwYXJzZUZsb2F0KGRlbnNpdHkudG9GaXhlZCgyKSksXG4gICAgICAgIGNhcGFjaXR5OiBsb2NhdGlvbkRhdGEuY2FwYWNpdHksXG4gICAgICAgIHNlY3Rpb25zOiBzZWN0aW9uRGF0YSxcbiAgICAgICAgY3VycmVudF90b3RhbF9waWxncmltczogY3VycmVudFRvdGFsUGlsZ3JpbXNcbiAgICAgIH1cbiAgICB9O1xuICB9KTtcbiAgXG4gIC8vIERlYnVnIGluZm9ybWF0aW9uIGFib3V0IHRvdGFsIHBpbGdyaW0gZGlzdHJpYnV0aW9uXG4gIGNvbnN0IHRvdGFsQ3Jvd2RTaXplID0gZGVuc2l0eURhdGEucmVkdWNlKChzdW0sIGxvY2F0aW9uKSA9PiBzdW0gKyBsb2NhdGlvbi5jcm93ZF9zaXplLCAwKTtcbiAgY29uc29sZS5sb2coYFRvdGFsIHBpbGdyaW1zIGN1cnJlbnRseSBkaXN0cmlidXRlZDogJHt0b3RhbENyb3dkU2l6ZX0gKHRhcmdldDogJHtjdXJyZW50VG90YWxQaWxncmltc30pYCk7XG4gIFxuICByZXR1cm4gZGVuc2l0eURhdGE7XG59XG5cbi8vIEZ1bmN0aW9uIHRvIHVwZGF0ZSBkYXRhYmFzZSB3aXRoIGNhbGN1bGF0ZWQgZGVuc2l0eVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUNyb3dkRGVuc2l0eURhdGEoKSB7XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coJ1N0YXJ0aW5nIHVwZGF0ZUNyb3dkRGVuc2l0eURhdGEnKTtcbiAgICBjb25zdCBkZW5zaXR5RGF0YSA9IGF3YWl0IGNhbGN1bGF0ZVJlYWxpc3RpY0Nyb3dkRGVuc2l0aWVzKCk7XG4gICAgY29uc29sZS5sb2coYEdlbmVyYXRlZCAke2RlbnNpdHlEYXRhLmxlbmd0aH0gZGVuc2l0eSBkYXRhIHBvaW50c2ApO1xuICAgIFxuICAgIC8vIExvZyBkZW5zaXR5IGxldmVscyBmb3IgZGVidWdnaW5nXG4gICAgY29uc29sZS5sb2coJ0N1cnJlbnQgZGVuc2l0eSBsZXZlbHM6Jyk7XG4gICAgZGVuc2l0eURhdGEuZm9yRWFjaChsb2NhdGlvbiA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhgJHtsb2NhdGlvbi5sb2NhdGlvbl9uYW1lfTogJHtsb2NhdGlvbi5kZW5zaXR5X2xldmVsfSAoJHtsb2NhdGlvbi5kZW5zaXR5fSlgKTtcbiAgICB9KTtcbiAgICBcbiAgICBpZiAoIXN1cGFiYXNlQWRtaW4pIHtcbiAgICAgIGNvbnNvbGUubG9nKCdTdXBhYmFzZSBhZG1pbiBjbGllbnQgbm90IGF2YWlsYWJsZSwgcmV0dXJuaW5nIGNhbGN1bGF0ZWQgZGF0YSBkaXJlY3RseScpO1xuICAgICAgcmV0dXJuIHsgXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsIFxuICAgICAgICBjb3VudDogZGVuc2l0eURhdGEubGVuZ3RoLCBcbiAgICAgICAgZGF0YTogZGVuc2l0eURhdGEsXG4gICAgICAgIG1lc3NhZ2U6ICdEYXRhYmFzZSBjb25uZWN0aW9uIG5vdCBhdmFpbGFibGUsIHVzaW5nIGNhbGN1bGF0ZWQgZGF0YScgXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICAvLyBDbGVhciBleGlzdGluZyBkYXRhIGFuZCBpbnNlcnQgbmV3IGRhdGFcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coJ0F0dGVtcHRpbmcgdG8gY2xlYXIgZXhpc3RpbmcgZGF0YScpO1xuICAgICAgY29uc3QgeyBlcnJvcjogZGVsZXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgICAgLmZyb20oJ2Nyb3dkX2RlbnNpdHknKVxuICAgICAgICAuZGVsZXRlKClcbiAgICAgICAgLm5lcSgnaWQnLCAwKTsgLy8gRGVsZXRlIGFsbCByZWNvcmRzXG4gICAgICBcbiAgICAgIGlmIChkZWxldGVFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjbGVhcmluZyBleGlzdGluZyBkYXRhOicsIGRlbGV0ZUVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgXG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSwgLy8gU3RpbGwgcmV0dXJuIHN1Y2Nlc3Mgd2l0aCB0aGUgY2FsY3VsYXRlZCBkYXRhXG4gICAgICAgICAgZXJyb3I6IGRlbGV0ZUVycm9yLCBcbiAgICAgICAgICBkYXRhOiBkZW5zaXR5RGF0YSxcbiAgICAgICAgICBjb3VudDogZGVuc2l0eURhdGEubGVuZ3RoLFxuICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gY2xlYXIgZXhpc3RpbmcgZGF0YSwgYnV0IHJldHVybmluZyBjYWxjdWxhdGVkIGRhdGEnXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEluc2VydCBuZXcgZGF0YVxuICAgICAgY29uc29sZS5sb2coJ1ByZXBhcmluZyBkYXRhIGZvciBpbnNlcnRpb24nKTtcbiAgICAgIGNvbnN0IHVwc2VydERhdGEgPSBkZW5zaXR5RGF0YS5tYXAobG9jYXRpb24gPT4gKHtcbiAgICAgICAgbG9jYXRpb25fbmFtZTogbG9jYXRpb24ubG9jYXRpb25fbmFtZSxcbiAgICAgICAgY29vcmRpbmF0ZXM6IGxvY2F0aW9uLmNvb3JkaW5hdGVzLFxuICAgICAgICBkZW5zaXR5X2xldmVsOiBsb2NhdGlvbi5kZW5zaXR5X2xldmVsLFxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIGNyb3dkX3NpemU6IGxvY2F0aW9uLmNyb3dkX3NpemUsXG4gICAgICAgIG9jY3VwYW5jeV9wZXJjZW50YWdlOiBsb2NhdGlvbi5vY2N1cGFuY3lfcGVyY2VudGFnZSxcbiAgICAgICAgbWV0YV9kYXRhOiB7XG4gICAgICAgICAgZGVuc2l0eTogbG9jYXRpb24uZGVuc2l0eSxcbiAgICAgICAgICBjYXBhY2l0eTogbG9jYXRpb24uY2FwYWNpdHksXG4gICAgICAgICAgc2VjdGlvbnM6IGxvY2F0aW9uLnNlY3Rpb25zLFxuICAgICAgICAgIGN1cnJlbnRfdG90YWxfcGlsZ3JpbXM6IGxvY2F0aW9uLm1ldGFfZGF0YS5jdXJyZW50X3RvdGFsX3BpbGdyaW1zXG4gICAgICAgIH1cbiAgICAgIH0pKTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ0F0dGVtcHRpbmcgdG8gaW5zZXJ0IGRhdGEgaW50byBTdXBhYmFzZScpO1xuICAgICAgY29uc3QgeyBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgICAgLmZyb20oJ2Nyb3dkX2RlbnNpdHknKVxuICAgICAgICAuaW5zZXJ0KHVwc2VydERhdGEpO1xuICAgICAgXG4gICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW5zZXJ0aW5nIGNyb3dkIGRlbnNpdHkgZGF0YTonLCBpbnNlcnRFcnJvcik7XG4gICAgICAgIHJldHVybiB7IFxuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsIC8vIFN0aWxsIHJldHVybiBzdWNjZXNzIHdpdGggdGhlIGNhbGN1bGF0ZWQgZGF0YVxuICAgICAgICAgIGVycm9yOiBpbnNlcnRFcnJvciwgXG4gICAgICAgICAgZGF0YTogZGVuc2l0eURhdGEsXG4gICAgICAgICAgY291bnQ6IGRlbnNpdHlEYXRhLmxlbmd0aCxcbiAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGluc2VydCBkYXRhLCBidXQgcmV0dXJuaW5nIGNhbGN1bGF0ZWQgZGF0YSdcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ1N1Y2Nlc3NmdWxseSB1cGRhdGVkIGNyb3dkIGRlbnNpdHkgZGF0YScpO1xuICAgICAgcmV0dXJuIHsgXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsIFxuICAgICAgICBjb3VudDogZGVuc2l0eURhdGEubGVuZ3RoLFxuICAgICAgICBkYXRhOiBkZW5zaXR5RGF0YVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChkYkVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdEYXRhYmFzZSBvcGVyYXRpb24gZXJyb3I6JywgZGJFcnJvcik7XG4gICAgICByZXR1cm4geyBcbiAgICAgICAgc3VjY2VzczogdHJ1ZSwgLy8gU3RpbGwgcmV0dXJuIHN1Y2Nlc3Mgd2l0aCB0aGUgY2FsY3VsYXRlZCBkYXRhXG4gICAgICAgIGVycm9yOiBkYkVycm9yLCBcbiAgICAgICAgZGF0YTogZGVuc2l0eURhdGEsXG4gICAgICAgIGNvdW50OiBkZW5zaXR5RGF0YS5sZW5ndGgsXG4gICAgICAgIG1lc3NhZ2U6ICdEYXRhYmFzZSBlcnJvciwgYnV0IHJldHVybmluZyBjYWxjdWxhdGVkIGRhdGEnXG4gICAgICB9O1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB1cGRhdGVDcm93ZERlbnNpdHlEYXRhOicsIGVycm9yKTtcbiAgICAvLyBUcnkgdG8gcmV0dXJuIGNhbGN1bGF0ZWQgZGF0YSBkaXJlY3RseSBhcyBhIGZhbGxiYWNrXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGRpcmVjdERhdGEgPSBhd2FpdCBjYWxjdWxhdGVSZWFsaXN0aWNDcm93ZERlbnNpdGllcygpO1xuICAgICAgcmV0dXJuIHsgXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsIFxuICAgICAgICBlcnJvciwgXG4gICAgICAgIGRhdGE6IGRpcmVjdERhdGEsXG4gICAgICAgIGNvdW50OiBkaXJlY3REYXRhLmxlbmd0aCxcbiAgICAgICAgbWVzc2FnZTogJ0Vycm9yIG9jY3VycmVkIGJ1dCByZXR1cm5pbmcgZGlyZWN0IGNhbGN1bGF0aW9uJyBcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoY2FsY0Vycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgZXZlbiBkaXJlY3QgY2FsY3VsYXRpb246JywgY2FsY0Vycm9yKTtcbiAgICAgIHJldHVybiB7IGVycm9yOiAnQ29tcGxldGUgY2FsY3VsYXRpb24gZmFpbHVyZScgfTtcbiAgICB9XG4gIH1cbn1cblxuLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGdldCBiYXNlIGNvb3JkaW5hdGVzIGZvciBlYWNoIGxvY2F0aW9uXG5mdW5jdGlvbiBnZXRCYXNlQ29vcmRpbmF0ZXMobG9jYXRpb25OYW1lOiBzdHJpbmcpOiBDb29yZGluYXRlcyB7XG4gIGNvbnN0IGNvb3JkaW5hdGVzTWFwOiBSZWNvcmQ8c3RyaW5nLCBDb29yZGluYXRlcz4gPSB7XG4gICAgJ01hc2ppZCBhbC1IYXJhbSc6IHsgbG5nOiAzOS44MjYxNzQsIGxhdDogMjEuNDIyNDg3IH0sXG4gICAgJ01pbmEnOiB7IGxuZzogMzkuODkyOTY2LCBsYXQ6IDIxLjQxMzI0OSB9LFxuICAgICdKYW1hcmFhdCBCcmlkZ2UnOiB7IGxuZzogMzkuODczNDg1LCBsYXQ6IDIxLjQyMzY1IH0sXG4gICAgJ0FyYWZhdCc6IHsgbG5nOiAzOS45ODQ2ODcsIGxhdDogMjEuMzU1NDYxIH0sXG4gICAgJ011emRhbGlmYWgnOiB7IGxuZzogMzkuOTM2MzIyLCBsYXQ6IDIxLjM4MzA4MiB9LFxuICAgICdNaW5hIEVudHJhbmNlIEdhdGUgMSc6IHsgbG5nOiAzOS44ODcyMzUsIGxhdDogMjEuNDExODU2IH0sXG4gICAgJ1RlbnQgQ2l0eSBTZWN0aW9uIEEnOiB7IGxuZzogMzkuODg5MTI0LCBsYXQ6IDIxLjQxNDUwMSB9LFxuICAgICdKYW1hcmF0IENlbnRyYWwgQWNjZXNzJzogeyBsbmc6IDM5Ljg3MTk1MiwgbGF0OiAyMS40MjM4NTAgfVxuICB9O1xuICBcbiAgcmV0dXJuIGNvb3JkaW5hdGVzTWFwW2xvY2F0aW9uTmFtZV0gfHwgeyBsbmc6IDM5LjgyNjE3NCwgbGF0OiAyMS40MjI0ODcgfTtcbn0gIl0sIm5hbWVzIjpbInN1cGFiYXNlQWRtaW4iLCJUT1RBTF9QSUxHUklNU19NSU4iLCJUT1RBTF9QSUxHUklNU19NQVgiLCJUT1RBTF9QSUxHUklNU19BVkciLCJNYXRoIiwiZmxvb3IiLCJMT0NBVElPTl9TSVpFUyIsImFyZWFJblNxdWFyZU1ldGVycyIsImNhcGFjaXR5Iiwic2VjdGlvbnMiLCJpZCIsIm5hbWUiLCJwZXJjZW50YWdlIiwiVE9UQUxfQ0FQQUNJVFkiLCJPYmplY3QiLCJ2YWx1ZXMiLCJyZWR1Y2UiLCJzdW0iLCJsb2NhdGlvbiIsIkRFTlNJVFlfVEhSRVNIT0xEUyIsImxvdyIsIm1lZGl1bSIsImhpZ2giLCJUSU1FX01PRElGSUVSUyIsImJlZm9yZVByYXllciIsImR1cmluZ1ByYXllciIsImFmdGVyUHJheWVyIiwiamFtYXJhdCIsInRhd2FmIiwic2F5ZWUiLCJuaWdodCIsImVhcmx5TW9ybmluZyIsImhhampEYXkiLCJXRUFUSEVSX01PRElGSUVSUyIsImhvdCIsInJhaW4iLCJwbGVhc2FudCIsImNhbGN1bGF0ZVJlYWxpc3RpY0Nyb3dkRGVuc2l0aWVzIiwibm93IiwiRGF0ZSIsImhvdXIiLCJnZXRIb3VycyIsImxvY2F0aW9ucyIsImtleXMiLCJ0aW1lTW9kaWZpZXIiLCJpbmNsdWRlcyIsImphbWFyYXRfaG91cnMiLCJ0YXdhZl9ob3VycyIsImlzSGFqakRheSIsImdldERheSIsImZvcmNlZEhhampEYXkiLCJnZXRNaW51dGVzIiwid2VhdGhlck1vZGlmaWVyIiwicGlsZ3JpbVZhcmlhdGlvbiIsImN1cnJlbnRUb3RhbFBpbGdyaW1zIiwiZGVuc2l0eURhdGEiLCJtYXAiLCJsb2NhdGlvbk5hbWUiLCJpbmRleCIsImxvY2F0aW9uRGF0YSIsImxvY2F0aW9uVGltZU1vZGlmaWVyIiwiYmFzZU9jY3VwYW5jeVBlcmNlbnRhZ2UiLCJsb2NhdGlvbkNhcGFjaXR5UmF0aW8iLCJiYXNlRXhwZWN0ZWRQaWxncmltcyIsIm1vZGlmaWVkT2NjdXBhbmN5IiwiZmluYWxPY2N1cGFuY3kiLCJyYW5kb20iLCJjcm93ZFNpemUiLCJkZW5zaXR5IiwiZGVuc2l0eUxldmVsIiwic2VjdGlvbkRhdGEiLCJzZWN0aW9uIiwic2VjdGlvblZhcmlhdGlvbiIsInNlY3Rpb25EZW5zaXR5Iiwic2VjdGlvbkRlbnNpdHlMZXZlbCIsInRvRml4ZWQiLCJkZW5zaXR5X2xldmVsIiwiY3Jvd2Rfc2l6ZSIsImJhc2VDb29yZGluYXRlcyIsImdldEJhc2VDb29yZGluYXRlcyIsImNvb3JkaW5hdGVzIiwibG5nIiwibGF0IiwibG9jYXRpb25fbmFtZSIsIm9jY3VwYW5jeV9wZXJjZW50YWdlIiwidGltZXN0YW1wIiwidG9JU09TdHJpbmciLCJtZXRhX2RhdGEiLCJwYXJzZUZsb2F0IiwiY3VycmVudF90b3RhbF9waWxncmltcyIsInRvdGFsQ3Jvd2RTaXplIiwiY29uc29sZSIsImxvZyIsInVwZGF0ZUNyb3dkRGVuc2l0eURhdGEiLCJsZW5ndGgiLCJmb3JFYWNoIiwic3VjY2VzcyIsImNvdW50IiwiZGF0YSIsIm1lc3NhZ2UiLCJlcnJvciIsImRlbGV0ZUVycm9yIiwiZnJvbSIsImRlbGV0ZSIsIm5lcSIsInVwc2VydERhdGEiLCJ1cGRhdGVkX2F0IiwiaW5zZXJ0RXJyb3IiLCJpbnNlcnQiLCJkYkVycm9yIiwiZGlyZWN0RGF0YSIsImNhbGNFcnJvciIsImNvb3JkaW5hdGVzTWFwIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/crowdSensors.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/supabase.ts":
/*!*****************************!*\
  !*** ./src/lib/supabase.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   fetchCrowdDensity: () => (/* binding */ fetchCrowdDensity),\n/* harmony export */   fetchSafetyAlerts: () => (/* binding */ fetchSafetyAlerts),\n/* harmony export */   getOptimalRoute: () => (/* binding */ getOptimalRoute),\n/* harmony export */   subscribeToCrowdDensity: () => (/* binding */ subscribeToCrowdDensity),\n/* harmony export */   supabase: () => (/* binding */ supabase),\n/* harmony export */   supabaseAdmin: () => (/* binding */ supabaseAdmin)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n// Environment variables\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || \"https://example.supabase.co\";\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVvd2ttc3Z0cXJzeWJsb2JzYXp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0Mzc2NTgsImV4cCI6MjA2MTAxMzY1OH0.EBQ3Pn9yvN2L6G5HTe5c10bGOF8xs28jQ-plE1g8HOc\";\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY || \"\";\n// Client for client-side and authenticated requests\n// Ensure we have a valid key\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey);\n// Service role client for server-side operations (only used in server components or API routes)\n// Only create if we have a valid service key\nconst supabaseAdmin = supabaseServiceKey && supabaseServiceKey.length > 0 ? (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseServiceKey, {\n    auth: {\n        autoRefreshToken: false,\n        persistSession: false\n    }\n}) : null;\n// Fetch crowd density data\nasync function fetchCrowdDensity() {\n    const { data, error } = await supabase.from(\"crowd_density\").select(\"*\").order(\"updated_at\", {\n        ascending: false\n    });\n    if (error) {\n        console.error(\"Error fetching crowd density:\", error);\n        return [];\n    }\n    return data;\n}\n// Subscribe to crowd density updates\nfunction subscribeToCrowdDensity(callback) {\n    const subscription = supabase.channel(\"crowd_density_updates\").on(\"postgres_changes\", {\n        event: \"*\",\n        schema: \"public\",\n        table: \"crowd_density\"\n    }, (payload)=>{\n        fetchCrowdDensity().then(callback);\n    }).subscribe();\n    return ()=>{\n        supabase.removeChannel(subscription);\n    };\n}\n// Fetch safety alerts\nasync function fetchSafetyAlerts() {\n    const { data, error } = await supabase.from(\"safety_alerts\").select(\"*\").gt(\"expires_at\", new Date().toISOString()).order(\"severity\", {\n        ascending: false\n    });\n    if (error) {\n        console.error(\"Error fetching safety alerts:\", error);\n        return [];\n    }\n    return data;\n}\n// For demo purposes, mock route calculation\nasync function getOptimalRoute(start, destination) {\n    // In a real app, this would call a serverless function or external API\n    // For the prototype, we'll return mock data\n    return {\n        distance: \"2.3 km\",\n        duration: \"30 minutes\",\n        congestion_level: \"medium\",\n        waypoints: []\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3N1cGFiYXNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBcUQ7QUFFckQsd0JBQXdCO0FBQ3hCLE1BQU1DLGNBQWNDLFFBQVFDLEdBQUcsQ0FBQ0Msd0JBQXdCLElBQUk7QUFDNUQsTUFBTUMsa0JBQWtCSCxRQUFRQyxHQUFHLENBQUNHLDZCQUE2QixJQUFJO0FBQ3JFLE1BQU1DLHFCQUFxQkwsUUFBUUMsR0FBRyxDQUFDSyx5QkFBeUIsSUFBSTtBQUVwRSxvREFBb0Q7QUFDcEQsNkJBQTZCO0FBQ3RCLE1BQU1DLFdBQVdULG1FQUFZQSxDQUFDQyxhQUFhSSxpQkFBaUI7QUFFbkUsZ0dBQWdHO0FBQ2hHLDZDQUE2QztBQUN0QyxNQUFNSyxnQkFBZ0JILHNCQUFzQkEsbUJBQW1CSSxNQUFNLEdBQUcsSUFDM0VYLG1FQUFZQSxDQUFDQyxhQUFhTSxvQkFBb0I7SUFDNUNLLE1BQU07UUFDSkMsa0JBQWtCO1FBQ2xCQyxnQkFBZ0I7SUFDbEI7QUFDRixLQUNBLEtBQUs7QUFvQ1QsMkJBQTJCO0FBQ3BCLGVBQWVDO0lBQ3BCLE1BQU0sRUFBRUMsSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNUixTQUMzQlMsSUFBSSxDQUFDLGlCQUNMQyxNQUFNLENBQUMsS0FDUEMsS0FBSyxDQUFDLGNBQWM7UUFBRUMsV0FBVztJQUFNO0lBRTFDLElBQUlKLE9BQU87UUFDVEssUUFBUUwsS0FBSyxDQUFDLGlDQUFpQ0E7UUFDL0MsT0FBTyxFQUFFO0lBQ1g7SUFDQSxPQUFPRDtBQUNUO0FBRUEscUNBQXFDO0FBQzlCLFNBQVNPLHdCQUF3QkMsUUFBd0M7SUFDOUUsTUFBTUMsZUFBZWhCLFNBQ2xCaUIsT0FBTyxDQUFDLHlCQUNSQyxFQUFFLENBQ0Qsb0JBQ0E7UUFBRUMsT0FBTztRQUFLQyxRQUFRO1FBQVVDLE9BQU87SUFBZ0IsR0FDdkQsQ0FBQ0M7UUFDQ2hCLG9CQUFvQmlCLElBQUksQ0FBQ1I7SUFDM0IsR0FFRFMsU0FBUztJQUVaLE9BQU87UUFDTHhCLFNBQVN5QixhQUFhLENBQUNUO0lBQ3pCO0FBQ0Y7QUFFQSxzQkFBc0I7QUFDZixlQUFlVTtJQUNwQixNQUFNLEVBQUVuQixJQUFJLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1SLFNBQzNCUyxJQUFJLENBQUMsaUJBQ0xDLE1BQU0sQ0FBQyxLQUNQaUIsRUFBRSxDQUFDLGNBQWMsSUFBSUMsT0FBT0MsV0FBVyxJQUN2Q2xCLEtBQUssQ0FBQyxZQUFZO1FBQUVDLFdBQVc7SUFBTTtJQUV4QyxJQUFJSixPQUFPO1FBQ1RLLFFBQVFMLEtBQUssQ0FBQyxpQ0FBaUNBO1FBQy9DLE9BQU8sRUFBRTtJQUNYO0lBQ0EsT0FBT0Q7QUFDVDtBQUVBLDRDQUE0QztBQUNyQyxlQUFldUIsZ0JBQWdCQyxLQUFhLEVBQUVDLFdBQW1CO0lBQ3RFLHVFQUF1RTtJQUN2RSw0Q0FBNEM7SUFDNUMsT0FBTztRQUNMQyxVQUFVO1FBQ1ZDLFVBQVU7UUFDVkMsa0JBQWtCO1FBQ2xCQyxXQUFXLEVBRVY7SUFDSDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaGFqai1uYXZpZ2F0b3IvLi9zcmMvbGliL3N1cGFiYXNlLnRzPzA2ZTEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcblxuLy8gRW52aXJvbm1lbnQgdmFyaWFibGVzXG5jb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCB8fCAnaHR0cHM6Ly9leGFtcGxlLnN1cGFiYXNlLmNvJztcbmNvbnN0IHN1cGFiYXNlQW5vbktleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIHx8ICdleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKcGMzTWlPaUp6ZFhCaFltRnpaU0lzSW5KbFppSTZJblZ2ZDJ0dGMzWjBjWEp6ZVdKc2IySnpZWHAzSWl3aWNtOXNaU0k2SW1GdWIyNGlMQ0pwWVhRaU9qRTNORFUwTXpjMk5UZ3NJbVY0Y0NJNk1qQTJNVEF4TXpZMU9IMC5FQlEzUG45eXZOMkw2RzVIVGU1YzEwYkdPRjh4czI4alEtcGxFMWc4SE9jJztcbmNvbnN0IHN1cGFiYXNlU2VydmljZUtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkgfHwgJyc7XG5cbi8vIENsaWVudCBmb3IgY2xpZW50LXNpZGUgYW5kIGF1dGhlbnRpY2F0ZWQgcmVxdWVzdHNcbi8vIEVuc3VyZSB3ZSBoYXZlIGEgdmFsaWQga2V5XG5leHBvcnQgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSk7XG5cbi8vIFNlcnZpY2Ugcm9sZSBjbGllbnQgZm9yIHNlcnZlci1zaWRlIG9wZXJhdGlvbnMgKG9ubHkgdXNlZCBpbiBzZXJ2ZXIgY29tcG9uZW50cyBvciBBUEkgcm91dGVzKVxuLy8gT25seSBjcmVhdGUgaWYgd2UgaGF2ZSBhIHZhbGlkIHNlcnZpY2Uga2V5XG5leHBvcnQgY29uc3Qgc3VwYWJhc2VBZG1pbiA9IHN1cGFiYXNlU2VydmljZUtleSAmJiBzdXBhYmFzZVNlcnZpY2VLZXkubGVuZ3RoID4gMFxuICA/IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VTZXJ2aWNlS2V5LCB7XG4gICAgICBhdXRoOiB7XG4gICAgICAgIGF1dG9SZWZyZXNoVG9rZW46IGZhbHNlLFxuICAgICAgICBwZXJzaXN0U2Vzc2lvbjogZmFsc2VcbiAgICAgIH1cbiAgICB9KVxuICA6IG51bGw7XG5cbi8vIFR5cGVzIGZvciBvdXIgZGF0YWJhc2VcbmV4cG9ydCB0eXBlIENyb3dkRGVuc2l0eSA9IHtcbiAgaWQ6IG51bWJlcjtcbiAgbG9jYXRpb25fbmFtZTogc3RyaW5nO1xuICBjb29yZGluYXRlczogeyBsbmc6IG51bWJlcjsgbGF0OiBudW1iZXIgfTtcbiAgZGVuc2l0eV9sZXZlbDogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJyB8ICdjcml0aWNhbCc7XG4gIHVwZGF0ZWRfYXQ6IHN0cmluZztcbiAgLy8gTmV3IGZpZWxkcyBmb3IgcmVhbGlzdGljIGNyb3dkIGRlbnNpdHlcbiAgY3Jvd2Rfc2l6ZT86IG51bWJlcjtcbiAgb2NjdXBhbmN5X3BlcmNlbnRhZ2U/OiBzdHJpbmc7XG4gIG1ldGFfZGF0YT86IHtcbiAgICBkZW5zaXR5OiBzdHJpbmc7XG4gICAgY2FwYWNpdHk6IG51bWJlcjtcbiAgICBzZWN0aW9uczogQXJyYXk8e1xuICAgICAgaWQ6IHN0cmluZztcbiAgICAgIG5hbWU6IHN0cmluZztcbiAgICAgIGRlbnNpdHk6IHN0cmluZztcbiAgICAgIGRlbnNpdHlfbGV2ZWw6ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCcgfCAnY3JpdGljYWwnO1xuICAgICAgY3Jvd2Rfc2l6ZTogbnVtYmVyO1xuICAgIH0+O1xuICB9O1xufTtcblxuZXhwb3J0IHR5cGUgU2FmZXR5QWxlcnQgPSB7XG4gIGlkOiBudW1iZXI7XG4gIHRpdGxlOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIGxvY2F0aW9uX25hbWU6IHN0cmluZztcbiAgY29vcmRpbmF0ZXM6IHsgbG5nOiBudW1iZXI7IGxhdDogbnVtYmVyIH07XG4gIHNldmVyaXR5OiAnaW5mbycgfCAnd2FybmluZycgfCAnZGFuZ2VyJztcbiAgY3JlYXRlZF9hdDogc3RyaW5nO1xuICBleHBpcmVzX2F0OiBzdHJpbmc7XG59O1xuXG4vLyBGZXRjaCBjcm93ZCBkZW5zaXR5IGRhdGFcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmZXRjaENyb3dkRGVuc2l0eSgpIHtcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbSgnY3Jvd2RfZGVuc2l0eScpXG4gICAgLnNlbGVjdCgnKicpXG4gICAgLm9yZGVyKCd1cGRhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xuXG4gIGlmIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGNyb3dkIGRlbnNpdHk6JywgZXJyb3IpO1xuICAgIHJldHVybiBbXTtcbiAgfVxuICByZXR1cm4gZGF0YSBhcyBDcm93ZERlbnNpdHlbXTtcbn1cblxuLy8gU3Vic2NyaWJlIHRvIGNyb3dkIGRlbnNpdHkgdXBkYXRlc1xuZXhwb3J0IGZ1bmN0aW9uIHN1YnNjcmliZVRvQ3Jvd2REZW5zaXR5KGNhbGxiYWNrOiAoZGF0YTogQ3Jvd2REZW5zaXR5W10pID0+IHZvaWQpIHtcbiAgY29uc3Qgc3Vic2NyaXB0aW9uID0gc3VwYWJhc2VcbiAgICAuY2hhbm5lbCgnY3Jvd2RfZGVuc2l0eV91cGRhdGVzJylcbiAgICAub24oXG4gICAgICAncG9zdGdyZXNfY2hhbmdlcycsXG4gICAgICB7IGV2ZW50OiAnKicsIHNjaGVtYTogJ3B1YmxpYycsIHRhYmxlOiAnY3Jvd2RfZGVuc2l0eScgfSxcbiAgICAgIChwYXlsb2FkKSA9PiB7XG4gICAgICAgIGZldGNoQ3Jvd2REZW5zaXR5KCkudGhlbihjYWxsYmFjayk7XG4gICAgICB9XG4gICAgKVxuICAgIC5zdWJzY3JpYmUoKTtcblxuICByZXR1cm4gKCkgPT4ge1xuICAgIHN1cGFiYXNlLnJlbW92ZUNoYW5uZWwoc3Vic2NyaXB0aW9uKTtcbiAgfTtcbn1cblxuLy8gRmV0Y2ggc2FmZXR5IGFsZXJ0c1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZldGNoU2FmZXR5QWxlcnRzKCkge1xuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCdzYWZldHlfYWxlcnRzJylcbiAgICAuc2VsZWN0KCcqJylcbiAgICAuZ3QoJ2V4cGlyZXNfYXQnLCBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkpXG4gICAgLm9yZGVyKCdzZXZlcml0eScsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcblxuICBpZiAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBzYWZldHkgYWxlcnRzOicsIGVycm9yKTtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgcmV0dXJuIGRhdGEgYXMgU2FmZXR5QWxlcnRbXTtcbn1cblxuLy8gRm9yIGRlbW8gcHVycG9zZXMsIG1vY2sgcm91dGUgY2FsY3VsYXRpb25cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRPcHRpbWFsUm91dGUoc3RhcnQ6IHN0cmluZywgZGVzdGluYXRpb246IHN0cmluZykge1xuICAvLyBJbiBhIHJlYWwgYXBwLCB0aGlzIHdvdWxkIGNhbGwgYSBzZXJ2ZXJsZXNzIGZ1bmN0aW9uIG9yIGV4dGVybmFsIEFQSVxuICAvLyBGb3IgdGhlIHByb3RvdHlwZSwgd2UnbGwgcmV0dXJuIG1vY2sgZGF0YVxuICByZXR1cm4ge1xuICAgIGRpc3RhbmNlOiAnMi4zIGttJyxcbiAgICBkdXJhdGlvbjogJzMwIG1pbnV0ZXMnLFxuICAgIGNvbmdlc3Rpb25fbGV2ZWw6ICdtZWRpdW0nLFxuICAgIHdheXBvaW50czogW1xuICAgICAgLy8gU2ltcGxpZmllZCByb3V0ZSBjb29yZGluYXRlcyB3b3VsZCBnbyBoZXJlXG4gICAgXVxuICB9O1xufSAiXSwibmFtZXMiOlsiY3JlYXRlQ2xpZW50Iiwic3VwYWJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwic3VwYWJhc2VBbm9uS2V5IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJzdXBhYmFzZVNlcnZpY2VLZXkiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwic3VwYWJhc2UiLCJzdXBhYmFzZUFkbWluIiwibGVuZ3RoIiwiYXV0aCIsImF1dG9SZWZyZXNoVG9rZW4iLCJwZXJzaXN0U2Vzc2lvbiIsImZldGNoQ3Jvd2REZW5zaXR5IiwiZGF0YSIsImVycm9yIiwiZnJvbSIsInNlbGVjdCIsIm9yZGVyIiwiYXNjZW5kaW5nIiwiY29uc29sZSIsInN1YnNjcmliZVRvQ3Jvd2REZW5zaXR5IiwiY2FsbGJhY2siLCJzdWJzY3JpcHRpb24iLCJjaGFubmVsIiwib24iLCJldmVudCIsInNjaGVtYSIsInRhYmxlIiwicGF5bG9hZCIsInRoZW4iLCJzdWJzY3JpYmUiLCJyZW1vdmVDaGFubmVsIiwiZmV0Y2hTYWZldHlBbGVydHMiLCJndCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImdldE9wdGltYWxSb3V0ZSIsInN0YXJ0IiwiZGVzdGluYXRpb24iLCJkaXN0YW5jZSIsImR1cmF0aW9uIiwiY29uZ2VzdGlvbl9sZXZlbCIsIndheXBvaW50cyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/supabase.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/next","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Froutes%2Froute&page=%2Fapi%2Froutes%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Froutes%2Froute.ts&appDir=C%3A%5CUsers%5Calghm%5COneDrive%5CDesktop%5CGitHub%5Ctafweej_Hajj%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Calghm%5COneDrive%5CDesktop%5CGitHub%5Ctafweej_Hajj&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();