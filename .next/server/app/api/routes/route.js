"use strict";(()=>{var e={};e.id=545,e.ids=[545],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},8216:e=>{e.exports=require("net")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},2452:e=>{e.exports=require("tls")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},7743:(e,a,t)=>{t.r(a),t.d(a,{originalPathname:()=>f,patchFetch:()=>w,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>y,staticGenerationAsyncStorage:()=>h});var r={};t.r(r),t.d(r,{GET:()=>p});var i=t(9303),n=t(8716),o=t(670),s=t(7070),c=t(1926),l=t(1463);let d={"Masjid al-Haram":{Mina:6.2,Arafat:20.5,Muzdalifah:12.8,"Jamaraat Bridge":7.1},Mina:{"Masjid al-Haram":6.2,Arafat:14.3,Muzdalifah:3.5,"Jamaraat Bridge":1.8},Arafat:{"Masjid al-Haram":20.5,Mina:14.3,Muzdalifah:8.2,"Jamaraat Bridge":16.1},Muzdalifah:{"Masjid al-Haram":12.8,Mina:3.5,Arafat:8.2,"Jamaraat Bridge":5.3},"Jamaraat Bridge":{"Masjid al-Haram":7.1,Mina:1.8,Arafat:16.1,Muzdalifah:5.3}};async function u(e,a){let t;try{if(c.pR){let{data:e,error:a}=await c.pR.from("crowd_density").select("*");t=!a&&e&&e.length>0?e:await (0,l.X)()}else t=await (0,l.X)()}catch(e){console.error("Error getting crowd density for route calculation:",e),t=await (0,l.X)()}let r=new Map;t.forEach(e=>{r.set(e.location_name,e.density_level)});let i=d[e]?.[a]||0;if(0===i)throw Error("No direct route available between these locations");let n=r.get(e)||"low",o=r.get(a)||"low";console.log(`Route calculation: ${e} (${n}) to ${a} (${o})`);let s=[e,a],u=["low","medium","high","critical"],p=u[Math.max(...s.map(e=>{let a=r.get(e)||"low";return u.indexOf(a)}))];console.log(`Route congestion determined to be: ${p}`);let g=1;switch(p){case"low":default:g=1;break;case"medium":g=.8;break;case"high":g=.6;break;case"critical":g=.4}let m=4*g,h=[];h.push(`Start at ${e}`);let y=s.filter(e=>{let a=r.get(e)||"low";return"high"===a||"critical"===a});return y.length>0&&(y.includes(e)&&"critical"===r.get(e)?h.push(`⚠️ Warning: Extremely high crowd density at your starting point (${e})`):y.includes(a)&&"critical"===r.get(a)?h.push(`⚠️ Warning: Extremely high crowd density at your destination (${a})`):"critical"===p?h.push(`⚠️ Warning: Extremely high crowd density on this route`):h.push(`⚠️ Warning: High crowd density detected on this route`),h.push("Consider traveling during off-peak hours if possible")),h.push(`Head toward ${a}`),"Mina"===e&&"Jamaraat Bridge"===a?(h.push("Take the designated pathway following the crowd management barriers"),("high"===r.get("Jamaraat Bridge")||"critical"===r.get("Jamaraat Bridge"))&&h.push("Follow signs for your camp's designated time slot to avoid peak congestion")):"Masjid al-Haram"===e&&"Mina"===a&&(h.push("Exit through the King Fahd expansion gate"),"high"===r.get("Masjid al-Haram")||"critical"===r.get("Masjid al-Haram")?(h.push("Follow the covered walkway path to Mina"),h.push("Keep right at the main junction to avoid heavier crowds")):h.push("Follow the main path to Mina")),h.push(`Arrive at ${a}`),("high"===p||"critical"===p)&&h.push("Stay hydrated and follow crowd management officials' instructions"),{start:e,destination:a,distance:`${i.toFixed(1)} km`,duration:`${Math.ceil(i/m*60)} minutes`,congestion_level:p,directions:h}}async function p(e){c.pR||console.warn("Service role key not configured, some features may be limited");try{let{searchParams:a}=new URL(e.url),t=a.get("start"),r=a.get("destination");if(!t||!r)return s.NextResponse.json({error:"Missing start or destination parameter"},{status:400});let i=await u(t,r);return s.NextResponse.json(i)}catch(e){return console.error("Error calculating route:",e),s.NextResponse.json({error:e instanceof Error?e.message:"Error calculating route"},{status:500})}}let g=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/routes/route",pathname:"/api/routes",filename:"route",bundlePath:"app/api/routes/route"},resolvedPagePath:"C:\\Users\\kiing\\Documents\\GitHub\\tafweej_Hajj\\src\\app\\api\\routes\\route.ts",nextConfigOutput:"export",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:y}=g,f="/api/routes/route";function w(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:h})}},1463:(e,a,t)=>{t.d(a,{X:()=>c,Z:()=>l});var r=t(1926);let i={"Masjid al-Haram":{areaInSquareMeters:356800,capacity:15e5,sections:[{id:"mataf",name:"Mataf Area",percentage:.15},{id:"ground",name:"Ground Floor",percentage:.45},{id:"first",name:"First Floor",percentage:.25},{id:"roof",name:"Roof Area",percentage:.15}]},Mina:{areaInSquareMeters:812e3,capacity:12e5,sections:[{id:"tents-a",name:"Tents Area A",percentage:.3},{id:"tents-b",name:"Tents Area B",percentage:.3},{id:"tents-c",name:"Tents Area C",percentage:.3},{id:"services",name:"Services Area",percentage:.1}]},"Jamaraat Bridge":{areaInSquareMeters:52e3,capacity:3e5,sections:[{id:"lower",name:"Lower Level",percentage:.3},{id:"middle",name:"Middle Level",percentage:.4},{id:"upper",name:"Upper Level",percentage:.3}]},Arafat:{areaInSquareMeters:1456e3,capacity:25e5,sections:[{id:"jabal",name:"Jabal al-Rahmah",percentage:.2},{id:"nimrah",name:"Nimrah",percentage:.3},{id:"uranah",name:"Uranah",percentage:.25},{id:"other",name:"Other Areas",percentage:.25}]},Muzdalifah:{areaInSquareMeters:623e3,capacity:1e6,sections:[{id:"mash",name:"Al-Mash'ar al-Haram",percentage:.3},{id:"north",name:"Northern Area",percentage:.35},{id:"south",name:"Southern Area",percentage:.35}]},"Mina Entrance Gate 1":{areaInSquareMeters:3e3,capacity:2e4,sections:[{id:"entry",name:"Entry Points",percentage:.4},{id:"security",name:"Security Check",percentage:.3},{id:"waiting",name:"Waiting Area",percentage:.3}]},"Tent City Section A":{areaInSquareMeters:12e4,capacity:18e4,sections:[{id:"a1",name:"Block A1",percentage:.25},{id:"a2",name:"Block A2",percentage:.25},{id:"a3",name:"Block A3",percentage:.25},{id:"a4",name:"Block A4",percentage:.25}]},"Jamarat Central Access":{areaInSquareMeters:8e3,capacity:5e4,sections:[{id:"entry",name:"Entry Zone",percentage:.4},{id:"corridor",name:"Main Corridor",percentage:.4},{id:"exit",name:"Exit Zone",percentage:.2}]}},n={low:.5,medium:1,high:2},o={beforePrayer:2,duringPrayer:2.5,afterPrayer:1.8,jamarat:3,tawaf:2.5,night:.7,earlyMorning:.8,hajjDay:3},s={hot:.9,pleasant:1.2};async function c(){let e=new Date,a=e.getHours(),t=Object.keys(i),r=1;a>=22||a<4?r=o.night:a>=4&&a<6?r=o.earlyMorning:[5,12,15,18,20].includes(a)?r=o.duringPrayer:[6,13,16,19,21].includes(a)?r=o.afterPrayer:[4,11,14,17,19].includes(a)&&(r=o.beforePrayer);let c=[6,7,8,13,14,15,16],l=[5,6,7,21,22,23],d=5===e.getDay(),u=e.getMinutes()%3==0,p=1;return a>=11&&a<=15?p=s.hot:a>=16&&a<=18&&(p=s.pleasant),t.map((t,s)=>{let g,m;let h=i[t],y=r;switch("Jamaraat Bridge"===t&&c.includes(a)?y=o.jamarat:"Masjid al-Haram"===t&&l.includes(a)?y=o.tawaf:"Arafat"===t&&(d||u)&&(y=o.hajjDay),t){case"Masjid al-Haram":g=.7+a%3*.1;break;case"Jamaraat Bridge":g=c.includes(a)?.9:.5;break;case"Mina":g=d||u?.95:.6;break;case"Arafat":g=d||u?.98:.3;break;case"Muzdalifah":g=a>=18&&a<=23?.85:.4;break;default:g=.4+e.getMinutes()%10/10}s%5==0?(g=.9,y=2):s%5==1?(g=.7,y=1.5):s%5==2?(g=1,y=2.5):s%5==3&&(g=.4,y=1);let f=g*y*p*(.95+.1*Math.random()),w=Math.floor(f*h.capacity),M=w/h.areaInSquareMeters;m=M<=n.low?"low":M<=n.medium?"medium":M<=n.high?"high":"critical";let x=h.sections.map(e=>{let a;let t=M*(.9+.2*Math.random());return a=t<=n.low?"low":t<=n.medium?"medium":t<=n.high?"high":"critical",{id:e.id,name:e.name,density:t.toFixed(2),density_level:a,crowd_size:Math.floor(w*e.percentage)}}),A={"Masjid al-Haram":{lng:39.826174,lat:21.422487},Mina:{lng:39.892966,lat:21.413249},"Jamaraat Bridge":{lng:39.873485,lat:21.42365},Arafat:{lng:39.984687,lat:21.355461},Muzdalifah:{lng:39.936322,lat:21.383082},"Mina Entrance Gate 1":{lng:39.887235,lat:21.411856},"Tent City Section A":{lng:39.889124,lat:21.414501},"Jamarat Central Access":{lng:39.871952,lat:21.42385}}[t]||{lng:39.826174,lat:21.422487};return{location_name:t,coordinates:{lng:A.lng+(5e-4*Math.random()-25e-5),lat:A.lat+(5e-4*Math.random()-25e-5)},density:M.toFixed(2),density_level:m,crowd_size:w,capacity:h.capacity,occupancy_percentage:(100*f).toFixed(1),sections:x,timestamp:new Date().toISOString()}})}async function l(){try{console.log("Starting updateCrowdDensityData");let e=await c();if(console.log(`Generated ${e.length} density data points`),console.log("Current density levels:"),e.forEach(e=>{console.log(`${e.location_name}: ${e.density_level} (${e.density})`)}),!r.pR)return console.error("Supabase admin client not available"),{error:"Supabase admin client not available"};console.log("Attempting to clear existing data");let{error:a}=await r.pR.from("crowd_density").delete().neq("id",0);if(a)return console.error("Error clearing existing data:",a),{error:a};console.log("Preparing data for insertion");let t=e.map(e=>({location_name:e.location_name,coordinates:e.coordinates,density_level:e.density_level,updated_at:new Date().toISOString(),crowd_size:e.crowd_size,occupancy_percentage:e.occupancy_percentage,meta_data:{density:e.density,capacity:e.capacity,sections:e.sections}}));console.log("Attempting to insert data into Supabase");let{error:i}=await r.pR.from("crowd_density").insert(t);if(i)return console.error("Error inserting crowd density data:",i),{error:i};return console.log("Successfully updated crowd density data"),{success:!0,count:e.length}}catch(e){return console.error("Error in updateCrowdDensityData:",e),{error:e}}}},1926:(e,a,t)=>{t.d(a,{pR:()=>o});var r=t(1518);let i="https://uowkmsvtqrsyblobsazw.supabase.co",n=process.env.SUPABASE_SERVICE_ROLE_KEY,o=((0,r.eI)(i,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVvd2ttc3Z0cXJzeWJsb2JzYXp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0Mzc2NTgsImV4cCI6MjA2MTAxMzY1OH0.EBQ3Pn9yvN2L6G5HTe5c10bGOF8xs28jQ-plE1g8HOc"),n?(0,r.eI)(i,n,{auth:{autoRefreshToken:!1,persistSession:!1}}):null)}};var a=require("../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),r=a.X(0,[276,135],()=>t(7743));module.exports=r})();